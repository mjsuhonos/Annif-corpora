A NEW ALGORITHM FOR TIME-DELAY ESTIMATION IN ULTRASONIC ECHO SIGNALS AND A COMPARATIVE STUDY OF ITS PERFORMANCE EVALUATION IN ULTRASOUND ELASTOGRAPHY IMAGING
By Elyas Shaswary Bachelor of Science in Medical Physics, Ryerson University, 2010

A thesis present to Ryerson University

in partial fulfillment of the requirements for the degree of Master of Science in the Program of Biomedical Physics

Toronto, Ontario, Canada, 2014 © Elyas Shaswary, 2014

AUTHOR'S DECLARATION
I hereby declare that I am the sole author of this thesis. This is a true copy of the thesis, including any required final revisions, as accepted by my examiners.

I authorize Ryerson University to lend this thesis to other institutions or individuals for the purpose of scholarly research.

I further authorize Ryerson University to reproduce this thesis by photocopying or by other means, in total or in part, at the request of other institutions or individuals for the purpose of scholarly research.

I understand that my thesis may be made electronically available to the public

ii

A NEW ALGORITHM FOR TIME-DELAY ESTIMATION IN ULTRASONIC ECHO SIGNALS AND A COMPARATIVE STUDY OF ITS PERFORMANCE EVALUATION IN ULTRASOUND ELASTOGRAPHY IMAGING Master of Science 2014 Elyas Shaswary Biomedical Physics Ryerson University

ABSTRACT

Time-delay estimation is a widely used signal processing task in many areas of ultrasound medical imaging and the performance of many applications is highly dependent on the accuracy and efficiency of the time-delay estimates. Time-delay estimation determines the displacement between two ultrasond echo signals. In this thesis, we propose a new timedelay estimation algorithm, which generates a zero-crossing curve to compute the timedelay estimate between two ultrasound echo signals. A comparative study, using statistical analysis and quantitative measurement of image quality in simulated and experimental ultrasound elastography, was done to compare the performance of the proposed algorithm with other established algorithms, such as normalized cross-correlation (NCC) and sum squared differences (SSD). The results of comparsion of various algorithms using signalto-noise and contrast-to-noise ratios indicated that the new algorithm only marginally improved the quality of the images in ultrasound elastography. In addition, a novel strain map normalization method was implemented to enhance target visualization in ultrasound elastography by compansating for strain decay with depth.

iii

ACKNOWLEDGEMENTS
I would like to thank my supervisors Dr. Yuan Xu and Dr. Jahan Tavakkoli for their guidance and patient throughout my research study. I would like to thank my supervisory committee members Dr. J. Carl Kumaradas and Dr. Richard R. S. Cobbold for their valuable guidance. I would also like to thank Dr. Raffi Karshafian for being on my examination committee. Special thanks go to Pooya SobheBidari for his assistant during experiments and to Dr. Mostafa Atri (of Toronto General Hospital) for allowing me to use his elastography tissue phantom. I would like to thank my friends Borna, Mosa, and Valentin for their friendship. Many thanks also go to my fellow graduate students, support staff, and other faculty member at the Physics Department. This work was partially supported by the Ontario Research Fund- Research Excellence (ORF-RE) grant and the Natural Science and Engineering Research Council of Canada (NSERC Discovery grant) that were awarded to J. Tavakkoli. Last but not least, I would like to thank family for their support.

iv

TABLE OF CONTENTS
Author's Declaration ........................................................................................................... ii Abstract .............................................................................................................................. iii Acknowledgements ............................................................................................................ iv Table of Contents ................................................................................................................ v List of Tables .................................................................................................................... vii List of Figures .................................................................................................................. viii List of Abbreviations ......................................................................................................... xi List of Symbols ................................................................................................................. xii List of Appendices ........................................................................................................... xiv Chapter 1: General Introduction ......................................................................................... 1 1.1 1.2 1.3 1.4 Introduction ....................................................................................................... 1 Literature Review .............................................................................................. 6 Research Hypothesis And Specific Aims........................................................ 14 Thesis Organization......................................................................................... 14 References For Chapter 1 ................................................................................ 15 Chapter 2: A New Algorithm for Time-Delay Estimation in Ultrasonic Echo Signals and Its Application in Ultrasound Elastography ...................................................................... 19 I. II. III. IV. V. VI. Introduction .................................................................................................... 21 Proposed Algorithm........................................................................................ 24 Simulation Methods ....................................................................................... 27 Simulation Results And Discussion ............................................................... 30 Experimental Performance ............................................................................. 38 Conclusions .................................................................................................... 45 Acknowledgements ........................................................................................ 46 References For Chapter 2 ............................................................................... 46 Chapter 3: Conclusions and Suggestions for Further Work ............................................. 51 3.1 3.2 3.3 Summary ......................................................................................................... 51 Conclusions ..................................................................................................... 51 Suggestion For Further Work .......................................................................... 53

v

Appendix A: Performance Evaluation of Various Time-Delay Estimation Algorithm in Simulated Elastography Phantoms ................................................................................... 54 Appendix B: A Study of Computational Efficiency of Various Time-Delay Estimation Algorithms ........................................................................................................................ 65 References For Appendix B ............................................................................ 67

vi

LIST OF TABLES
Table 2.1: Parameters and their assigned values used in Field II ultrasound simulation software for generation of ultrasound echo signal to perform statistical analysis. ........... 29 Table 2.2: Specifications of the CIRS breast elastography tissue phantom.................... 38 Table 2.3: SNRe and CNRe of the original and the normalized strain maps of the CIRS breast elastography tissue phantom. From each strain map, sample points (about 60 samples) were taken from the region of small inclusions and from the background at the same axial.......................................................................................................................... 43 Table A.1: Parameters and their assigned values used in Field II ultrasound simulation software for construction of a computer simulated tissue phantom for strain elastography. ........................................................................................................................................... 56 Table A.2: SNRe and CNRe of the first and second simulated phantoms. From each strain map, sample points (about 50 samples) were taken from the inclusions which was located at the center elastogram (axially and laterally), and from the background at the same axial depth to compute SNRe and CNRe. ................................................................................. 64

vii

LIST OF FIGURES
Figure 1.1: A schematic illustration of a correlation coefficient based motion estimation method. A reference window is compared with a shifted window to find the location where correlation coefficient between them is maximum. The location of maximum correlation coefficient corresponds to the time-shift between the two windows. (Figure modified and adopted from [25]). ............................................................................................................. 9 Figure 1.2: Illustration of curve-fitting to three sample points (0, 1, and 2) around the peak of cross-correlation. The dashed line represents continuous-time cross-correlation and the solid line represents the fitted curve. (Figure modified and adopted from [31]). ....... 12 Figure 2.1: Most common time-delay estimation schemes. (a) Time-delay estimation without interpolation. (b) Time-delay estimation with interpolation of the reference and delayed signals before computing a pattern-matching function. (c) Time-delay estimation with interpolation of the pattern-matching function. (d) Time-delay estimation with interpolation of the reference and delayed signals, and interpolation of the pattern-matching function. ............................................................................................................................ 23 Figure 2.2: (a) Representation of positive shifting. (b) Representation of negative shifting. ........................................................................................................................................... 25 Figure 2.3: Visualization of Eq. 2.2 to generate a pattern-matching function to obtain a zero-crossing. .................................................................................................................... 26 Figure 2.4: Standard deviation, bias, and standard deviation of the jitter error as a function of sub-sample delay. For each sub-sample delay 200 A-lines were used and each A-line was divided by window length of 10 wavelengths (with 50% overlaps) which resulted in 9000 time-delay estimates. Sampling frequency was 100 MHz, center frequency was 5 MHz, and SNR was 45 dB. ............................................................................................... 32 Figure 2.5: Standard deviation, bias, and standard deviation of the jitter errors as a function of SNR. For each SNR 200 A-lines were used and each A-line was divided by window length of 10 wavelengths (with 50% overlaps) which resulted in 9000 time-delay estimates. Sub-sample delay between the reference and delayed signals were 0.25 samples. Sampling frequency was 100 MHz and center frequency was 5 MHz. ............................ 35

viii

Figure 2.6: Standard deviation, bias, and standard deviation of the jitter errors as a function of window length. For each window length 200 A-lines were used. Sub-sample delay between the reference and delayed signals were 0.25 samples. Sampling frequency was 100 MHz, center frequency was 5 MHz, SNR was 45 dB, and window overlap was 50%. .................................................................................................................................. 37 Figure 2.7: B-mode images of the RF frames acquired from the CIRS breast elastography tissue phantom at (a) pre-compression state and at (b) post-compression state. .............. 40 Figure 2.8: The strain maps of the CIRS breast elastography tissue phantom. Time-delay estimates were computed by all considered algorithms (using window length of 10 wavelengths with 75% window overlap). The corresponding strain was computed using the SGDD method (with filter length of 9 samples, polynomial fitting of second degree, and differentiation of first order). The strain maps were also filtered by a 5×5 median and mean filters........................................................................................................................ 42 Figure 2.9: (a) Plot of a single strain line along the axial direction. (b) Plot of the strain trend (shown by the dotted line) by which strain line was normalized. (c) Plot of a strain line after normalization. .................................................................................................... 43 Figure 2.10: The normalized strain map of the CIRS breast elastography tissue phantom. Time-delay estimates were computed by all considered algorithms (using window length of 10 wavelengths with 75% window overlap). The corresponding strain was computed using the SGDD method (with filter length of 9 samples, polynomial fitting of second degree, and differentiation of first order). The strain maps were filtered by a 5×5 median and mean filters. ................................................................................................................ 44 Figure A.1: (a) First phantom which contained cylindrical inclusions of 2 mm, 3 mm, and 5 mm diameter at 10 mm, 30 mm, and 50 mm axial distances. (b) Second phantom which contained cylindrical inclusions of 4 mm, 6 mm, and 8 mm diameter at 10 mm, 30 mm, and 50 mm axial distances. ............................................................................................... 55 Figure A.2: Only 500 scatterers out of a total of 390,000 scatterers are shown in both of these subfigure for better illustration. (a) Illustration of the scatterers distribution used by Field II to generate RF frame at pre-compression state. (b) Illustration of the displaced scatterers distribution, simulating a compressional force being applied by the transducer, used by Field II to generate RF frame at post-compressional state. ................................. 57 Figure A.3: B-mode images of the first phantom. (a) Pre-compression state. (b) Postcompression state. ............................................................................................................. 59 Figure A.4: B-mode images of the second phantom. (a) Pre-compression state. (b) Postcompression state. ............................................................................................................. 59

ix

Figure A.5: (a) Plot of a pre-compression and post-compression RF signals from the center (i.e., at 0 lateral distance) of the second simulated phantom. (b) A zoom in section of (a). (c) Plot of the corresponding time-delay estimates between the reference and delayed RF signals. (d) Plot of the corresponding strain. The boxes with dashed lines indicate the locations of the inclusions................................................................................................. 60 Figure A.6: The strain maps of the first simulated phantom. Time-delay estimates were computed by all considered algorithms (using window length of 8 wavelengths with 75% window overlap). The corresponding strain was computed using the SGDD method (with filter length of 9 samples, polynomial fitting of second degree, and differentiation of first order). The strain maps were also filtered by a 5×5 median and mean filters. ................ 62 Figure A.7: The strain maps of the second simulated phantom. Time-delay estimates were computed by all considered algorithms (using window length of 8 wavelengths with 75% window overlap). The corresponding strain was computed using the SGDD method (with filter length of 9 samples, polynomial fitting of second degree, and differentiation of first order). The strain maps were also filtered by a 5×5 median and mean filters. ................ 63 Figure B.1: The average processing time of each algorithm to produce a displacement map. 10 displacement maps were produced. The RF data was also interpolated by a factor of 2, 5 and 10. The transmit central frequency was 5 MHz, sampling frequency was 40 MHz, and window length was 20 wavelengths (4 s  3.1 mm) with 75% window overlap. The size of the RF frames was 2393×256 samples and the size of the displacement maps was 51×256 samples. .............................................................................................. 67

x

LIST OF ABBREVIATIONS
CC CNR CNRe CPU CV fps MRE MRI NCC NCV OCE OCT RAM RF SAD SGDD SNR SNRe SSD Cross-correlation Contrast-to-noise-ratio Elastographic contrast-to-noise-ratio Central processing unit Covariance Frames per second Magnetic resonance elastography Magnetic resonance imaging Normalized cross-correlation Normalized covariance Optical coherence elastography Optical coherence tomography Random access memory Radio-frequency Sum absolute differences Savitzky-Golay digital differentiator Signal-to-noise-ratio Elastographic signal-to-noise-ratio Sum squared differences

xi

LIST OF SYMBOLS
                          Bias Curve fitting bias Shear wave speed Peak offset between discrete and continuous-time cross-correlation Peak offset between discrete cross-correlation and fitted curve True time delay estimate Estimated time delay estimate Sampling period/interval Young's modulus Force Shear modulus Index In-phase component of the Doppler signal Bulk modulus Wavelength Emission number Total number of pulse emissions Mean Window length Angular frequency Pressure Phase Quadrature component of the Doppler signal Origin of a window

xii

   1 2    1
 1

Complex demodulated signal Tissue mass density Standard deviation Reference signal Shifted/delayed signal Repetition interval between each transmitted pulse Search lag Volume Reference signal Instantaneous time derivative of the reference signal Delayed signal

2

xiii

LIST OF APPENDICES
Appendix A: Performance Evaluation of Various Time-Delay Estimation Algorithm in Simulated Elastography Phantoms ....................................................................................54 Appendix B: A Study of Computational Efficiency of Various Time-Delay Estimation Algorithms .........................................................................................................................65

xiv

Chapter 1
General Introduction
1.1 INTRODUCTION

For thousands of years [1] palpation has been used as a diagnostic tool to detect soft tissue abnormalities. It has been known that diseases change the mechanical properties of tissues. For example, ductal and scirrhous carcinomas of the breast [2], [3], tumours of the prostate gland [2], and fibrosis and cirrhosis of the liver [4] are typically much stiffer than the normal surrounding tissues. Palpation is essentially the assessment of the elasticity of soft tissues which is sensed by deformation of tissues (i.e., strain) due to application of pressure (i.e., stress). However, palpation is a subjective and an unreliable method for the assessment of tissue elasticity because tissue abnormalities which are smaller in size and deeper beneath the skin surface cannot be generally detected. Although rates of falsenegative and false-positive of palpation are high, the benefits of early diagnosis and treatment can far surpass the cost of false-positives [1]. There has been a continuous search for alternative to physical examinations and diagnostic imaging has revolutionized the field of medicine, since Wilhelm Roentgen 1

produced the first x-ray image of his wife's hand in 1895. Diagnostic imaging has become an indispensable part of the care system. A medical image reveals many different kinds of indications, including changes in shape of a certain structure, changes in image intensity within a certain structure compared to a normal tissue, and/or the appearance of features (e.g., lesions) that are not normally visible [5]. With the continous advancements in science and technology, improvements are made to the diagnostic imaging instrumentations and each improvement must be assessed in a quantitative fashion. Typically, the quality of medical images are evaluated by criteria, such as signal-to-noise ratio (SNR), contrast-tonoise-ratio (CNR), and spatial resolution [5]. Conventional imaging modalities are not able to detect all types of cancers and for this reason needle biopsies are widely performed to histologically detect certain type of cancer, such as breast [2], [6], prostate [2], [7], liver [4], [8], thyroid [9], kidney [10], etc. Needle biopsy is an invasive single point examination and has many shortcomings, such as patient discomfort, relative high cost and minuscule size of the biopsy specimen [1], [8]. One very promising modality for detection of abnormal tissues is elasticity imaging, which is also known as elastography. Essentially, elastography replicates the process of manual palpation to produce a quantitative map of tissue stiffness. Stiffness is an intrinsic property of tissues, which is characterized by the elastic moduli, such as Young's modulus, shear modulus and bulk modulus [11], [12]. Young's modulus (E) describes longitudinal deformation which is defined as:  = stress strain (1.1)

2

where stress is force per unit cross-sectional area, which has units of N/m2 or Pa, (as shown in Eq. 1.2), and strain is the change in length of the material divided by the length of the material prior application of force, which has no units, (as shown in Eq. 1.3). stress = force area (1.2)

strain =

length after - length before length before

(1.3)

Shear modulus ( ) describes deformation caused by a shear force (as shown in eq. 1.4). When a force is applied to an object from one of the sides, which is parallel to the direction of force, the object will be pulled over to one side by . Bulk modulus ( ) describes volumetric deformation in response to externally applied pressure (as shown in Eq. 1.5). The minus sign in Eq. 1.5 shows that the volume decreases when pressure increases.  = shear stress / = shear strain tan  (1.4)

 =

-change in pressure - = fractional change in volume /

(1.5)

All elastography techniques involve a method of tissue excitation, which can be by direct mechanical means (i.e. compressional force) or by indirect means (e.g. by an acoustic radiation force) to cause quasi-static or dynamic tissue displacement [1], [12]. The response of tissue to excitation is monitored by various means, such as ultrasound, MRI and optical coherence tomography (OCT). Ultrasound methods mainly rely on estimation of tissue displacement using radiofrequency (RF) data or Doppler effects [11]. MRI methods, also known as magnetic resonance elastography (MRE), mainly rely on dynamic tissue displacement, which is accompanied by generation of shear waves. MRE tracks shear wave propagation to obtain information about the phase shift of the MR images [13], [14].OCT 3

methods, also known as optical coherence elastography (OCE), is analogous to ultrasonic methods, except tissue displacements are estimated using intensity of reflected light [15]. While OCE has intrinsically higher spatial resolution compared to ultrasound elastography and MRE, its penetration depth is lower than ultrasound elastography and MRE. In comparsion to MRE, ultrasound elastography generally provides more accurate and precise results [1]. In addition, ultrasound elastography, in general, is faster, inexpensive, and more convenient for the patients compared to MRE [1]. Thus, ultrasound elastography is generally more suitable for many clinical applications. Numerous techniques of ultrasound elastography have been proposed over the year and they generally fall into two main categories: strain elastography and shear-wave elastography. In strain elastography, a force (i.e., stress) is applied--usually to the skin surface with an array probe--to cause tissue deformation and the changes in dimensions of the tissue (i.e., strain) is measured from the time-shift between backscattered ultrasound signals. Since hard lesions are less compliant to stress than soft lesions, hard lesions will experience less strain than soft lesions and it is the variation of strain that are mapped in strain elastography. It has been reported that the strain must be less than 1%, otherwise the correlation coefficient between backscattered signals falls below 0.9 which will significantly affect the accuracy of the time-delay estimation [16]. Strain elastography relies on relative strain estimation; therefore this is a qualitative method. However, this method still provides valuable clinical information [1]. In shear-wave elastography, acoustic radiation force, which is generated by a focused ultrasound beam, is used to cause a localized displacement deep inside tissues [1]. Acoustic radiation force is accompanied by generation of low frequency (50-500 Hz) shear wave which propagate through the tissue

4

at speed of 1-10 m/s. Low frequency shear waves are able to propagate over an increased area compare to high frequency shear wave which are attenuated more rapidly. High frame rate (>1000 fps) imaging system is used to capture shear wave speed ( ), which is related to Young's modulus ( ) and shear modulus ( ) by [1]:
2  = 3 = 3

(1.6)

where  is tissue mass density. Tissue displacement is estimated from consecutive backscattered signals by algorithms, which are referred to time-delay estimator. The quality of images of ultrasound elastography is highly dependent on the quality of the displacement estimates [17]. The most commonly used and well-known time-delay estimation methods are normalized cross-correlation (NCC) and sum squared differences (SSD). (Refer to Section 1.2 for

literature review.) It has been reported in literature that overall the performance of NCC and SSD is optimum (in terms of accuracy and precision) relative to other time-delay estimation methods [18]. However, their main shortcoming is high computational cost (especially, for the NCC) [18], [19]. Usually, in commercial ultrasound scanners, a computationally efficient version of NCC and SSD algorithms are implemented. For example, a modified version of NCC [20] has been implemented in Sonix® RP (Ultrasonix Medical Corp., Richmond, BC, Canada), and a modified version of SSD [21] has been implemented in SONOLINE® Elegra (Siemens Medical Solutions, Mountain View, CA, USA). In this work, a new time-delay estimation algorithm is proposed. The performance of the proposed algorithm will be evaluated using statistical analysis and quantitative analysis of image quality in ultrasound elastography.

5

1.2

LITERATURE REVIEW

In ultrasound elastography, a key role of an imaging system is to accurately estimate tissue motion between two radio-frequency (RF) frames. In ultrasound imaging, tissue motion is typically estimated by either Doppler (phase-domain) methods or time-domain methods. Doppler methods are commonly used in blood flow imaging, which determine average phase-shift from the Doppler frequency shift signals [22]. In pulsed Doppler ultrasound, backscattered echo signals are recorded from a specific depth in the tissue and they undergo through a process called phase quadrature demodulation [22]. Phase quadrature demodulation (which is usually implemented in hardware) is a two channel processing where in the first channel a reflected RF signal is mixed (i.e., multiplied) with a reference RF signal, and in the second channel a reflected RF signal is mixed with a reference RF signal which is phase shifted by /2 [23]. Each channel also undergoes a low-pass filtering. The resultant signal from the first channel is called in-phase component of the Doppler signal ( ) and the resultant signal from the second channel is called quadrature component of the Doppler signal () [23]. Doppler methods of tissue motion estimation typically rely on an autocorrelation algorithms, which estimate the rate of change of phase between two adjacent Doppler signal (i.e.,  () = () + () and  ( - 1) = ( - 1) + ( - 1)). Angular frequency () can be approximated from the rate of change of phase () as following [24]:  =  () - ( - 1)   

(1.7)

6

where  is the time between two pulse emissions. Autocorrrelation techniques uses a series of Doppler signal pairs to estimate their mean angular frequency which can be written as [24]:  = 1  tan
-1

 =1 ()( - 1) - ()( - 1) (  ) =1 ()( - 1) + ()( - 1)

(1.8)

where  is the total number of pulse emissions. Time-domain methods (also known as time-delay estimation) estimate the relative time-shift between sequences of RF echo signals. Generally, time-delay estimation methods act as feature matching (or pattern-matching) operators, in which a feature (small segment) of a signal is selected and a search is performed to find the best match for it in another signals. Time-delay estimation can be performed on either the RF echo signals or the envelope of the RF echo signals. Time-delay estimation has been extensively studied over the years and numerous algorithms have been proposed. Some of the well-known algorithms include, but are not limited to, cross-correlation (CC), normalized crosscorrelation (NCC), sum squared differences (SSD), sum absolute differences (SAD), covariance (CV), and normalized covariance (NCV). Time-domain methods are more widely used and in many application they are more advantageous compared to phase-domain methods [25]. The primary difference between phase-domain methods and time-domain methods is that phase-domain methods estimate velocity of a group of scatterers, whereas time-domain methods estimate displacement of a group of scatterers [25]. Estimating the displacement of a group of scatterers is preferred because motion of scatterers can be tracked with time and scatterers do not have to be in motion at the time of data acquisition to estimate their motion [25]. In addition, time-

7

domain methods do not suffer from aliasing artifact unlike phase-domain methods. In phase-domain methods, the maximum measurable velocity is determined by the Nyquist criterion (which states that the maximum Doppler frequency must be half the pulse repetition frequency) otherwise high velocities will be switched to low velocities [25]. Moreover, time-domain methods has been reported to have higher precision compared to phase-domain methods [25]. NCC has been used for tissue motion estimation for a long time and its relative performance is generally considered to be superlative [18]. NCC take a segment (window) of data from a reference echo signal and searches for the best match for it in a shifted echo signal by computing correlation coefficient (i.e., pattern-matching function) between the two segments at each search step. NCC between a reference 1 [] and a shifted 2 [] windows is defined as [26], [27]:  [] = +-1 (1 []  2 [ + ]) =
2 2 +-1 1 []  +-1 2 [ + ] = =

(1.9)

where  is the origin of the reference window,  is the length of the windows,  is the search lag (i.e., shift between the reference and shifted windows). The term in the numerator is the non-normalized cross-correlation between 1 [] and 2 [], and the terms in the denominator are the energy of 1 [] and 2 [] by which the numerator is normalized. By taking into account the energy of the reference and shifted windows is beneficial because the local variations in the standard deviation and mean of the windows get compensated [28]. The location (i.e., ) where Eq. 1.9 is maximum corresponds to the timeshift between a reference and shifted windows. The general procedure of a correlation coefficient based motion estimation method is illustrated in Figure 1.1.

8

Figure 1.1: A schematic illustration of a correlation coefficient based motion estimation method. A reference window is compared with a shifted window to find the location where correlation coefficient between them is maximum. The location of maximum correlation coefficient corresponds to the time-shift between the two windows. (Figure modified and adopted from [25]).

SSD is also widely used in motion estimation as it has performed comparable to NCC [18]. SSD compares a reference and a shifted window by computing the least difference (i.e., pattern-matching function) between them. The location of minimum difference between the reference and shifted windows is the corresponding time-shift between them. SSD sums the squared difference between a reference window 1 [] and a shifted window 2 [] as defined by [18], [26]:
+-1

 [] = 

=

(1 [] - 2 [ + ])2

(1.10)

where  is the origin of the reference window signal,  is the length of the windows,  is the search lag. Unlike NCC, SSD does not take into account the energy of the reference and shifted windows and as a result it does not compensate for the local variations of the

9

mean and standard deviation of the data. On the other hand, SSD is more computationally efficient compared to NCC. The main disadvantage of NCC is its high computational cost, which can be problematic for real-time implementations [18], [29]. A few novel implementations of NCC and SSD have been reported to increase their computational efficiency [20], [21], [27]. For example, in [24] and [25] time-delay estimates of the previous window was used to reduce the search range in the current window. In addition to using RF data, time-delay estimation can be performed using envelop-detected data. Envelop-detected signals are obtained from the absolute value of the analytic signals, which are extracted from the RF signals by using Hilbert transform [30]. Envelop-detected signals contain less information, relative to RF signals, because Hilbert transform removes the phase information of the signals [25]. The phase information is a factor in the distinctiveness of the speckle pattern and retaining this information increases the likelihood of locating an accurate match [25]. The performance of all time-delay estimation algorithms can be deteriorated by many factors [18], [19]. Practically, time-delay estimation is computed using discrete-time ultrasonic echo signals which restricts the time-delay estimates to be an integer multiple of the sampling interval. When discrete-time signals are used in time-delay estimation, the outputs can potentially suffer from high bias (i.e., average difference between true and esimated time-delays) and variance (i.e., average squared difference of time-delay estimates from mean of the time-delay esimates) [18]. However, if the discrete-time signals are sampled above the Nyquist rate, then by using interpolation the time-delay estimates will be as precise and accurate as continuous-time signals [18]. Interpolation can be performed before and/or after computation of a pattern-matching function. Interpolation of

10

the data before computation of a pattern-matching function simply increases the sampling rate of the data, which allows for finer and more accurate time-delay estimates [26]. On the other hand, interpolation of the data post computation of a pattern-matching function usually fits a predetermined type of curve or a polynomial to a number of sample points in the pattern-matching function to describe the pattern-matching function as if they are continuous-time functions [31]. This approach does not restrict the time-delay estimates to be an integer multiple of the sampling interval. A number of interpolation methods have been described in literature, such as cosine-curve fitting [32], parabolic curve-fitting [33], [34], grid slope [35], [36], and spline fitting [37]. However, even with implementations of these methods, time-delay estimates suffer high bias and variance [26], [31]. Figure 1.2 illustrates curve-fitting of the cross-correlation function. Without curvefitting or interpolation, the time-delay estimate would be restricted to the sample point where cross-correlation is maximum (i.e., 1 in Error! Reference source not found.). owever, if the cross-correlation was computed using continuous-time signals, then the peak of cross-correlation function would be offset from the 1 by  . If a curve is fitted to a few sample points around the peak of cross-correlation function (i.e., 0 , 1 , and 2 ), then the  ) can be determined analytically. location where the fitted curve is maximum (i.e., 

11

Figure 1.2: Illustration of curve-fitting to three sample points (0 , 1 , and 2 ) around the peak of crosscorrelation. The dashed line represents continuous-time cross-correlation and the solid line represents the fitted curve. (Figure modified and adopted from [31]).

Cosine-curve fitting fits a cosine shaped curve to the three sample points (0 , 1 , and 2 ) around the peak of cross-correlation function and it is defined as [31], [38]: =  where  and  are defined as:  = cos -1 (  = tan-1 ( 0 + 2 ) 21 (1.12)   (1.11)

0 - 2 ) 21 sin()

(1.13)

Like all curve-fitting methods, cosine-curve fitting suffers from some degree of bias (i.e.,  -  , as shown in Figure 1.2). Nonetheless, the amount of bias from curve-fitting is  =  significantly smaller than from without implementation of curve-fitting. Cosine-curve fitting has been reported to perform better (in term of bias and standard deviation) than other curve-fitting methods, such as parabolic curve-fitting [26], [31], [39]. 12

Recently, many new time-delay estimation algorithms have been proposed, such as sample tracking [39], and spline-based continuous time-delay estimators [26], [40]. These methods use polynomial spline interpolation to represent either the reference and delayed signals or the reference signal only by polynomials. The coefficients of the polynomial spline are then used to analytically compute the time-delay estimates. These methods have been shown to outperform NCC and SSD, in terms of bias and standard deviation, but at the cost of increased computation time. However, these methods are not optimum for realtime ultrasound elastography. For example, sample tracking [39] uses NCC to obtain coarse time-delay estimates because it cannot estimate time-delays larger than /4, and spline-based continuous time-delay estimators [26], [40] are computationally inefficient. In literature, the performance of most time-delay estimation algorithms have been, generally, evaluated using RF echo data which have been generated by a simple simulation model. For example, in [18], [19], [26], [39]­[41] a sinc-enveloped sinusoid point spread function was convolved by Gaussian distributed white noise to construct a reference RF signals. This model assumes that a line of scatterers (i.e., white noise) moves axially towards a single element transducer. A delayed version of a reference signal was constructed by simply translating a replica of a reference signal in axial direction. This model is not an accurate representative of a real ultrasound RF echo singal. There are more realistic ultrasound simulation softwares, such as Field II [42], [43], for generation of ultrasound signals and images. However, to the author's knowledge, Field II ultrasound simulation was never used to generate RF signals to compare the performance of the timedelay estimators.

13

1.3

RESEARCH HYPOTHESIS AND SPECIFIC AIMS

The hypothesis of this research is that the proposed new time-delay estimation algorithm improves the quality of the images in ultrasound elastography. The specific aims of this research are to: I. Implement the new algorithm and compare its performance with NCC and SSD using simulated data generated by Field II ultrasound simulation software and experimental data acquired from a calibrated ultrasound elastography tissue phantom. II. Apply the new algorithm to improve signal-to-noise ratio, and contrast-to-noise ratio of images in ultrasound elastography. III. Apply a new strain map normalization method to enhance target visualization in ultrasound elastography.

1.4

THESIS ORGANIZATION

The remainder of this thesis is organized as follows:  Chapter 2 presents the manuscript: "A new algorithm for time-delay estimation in ultrasonic echo signals and its application in ultrasound elastography", which was submitted to the journal of IEEE transactions on ultrasonics, ferroelectrics, and frequency control.   Chapter 3 presents conclusion of the thesis and suggestion for future works. Appendix A presents performance evaluation of various time-delay estimation algorithms in simulated elastography phantoms.

14



Appendix B presents a study on computational efficiency of the various time-delay estimation algorithms.

REFERENCES FOR CHAPTER 1
[1] P. Wells, "Medical ultrasound: imaging of soft tissue strain and elasticity," J. R. Soc., vol. 8, no. 64, pp. 1521­49, Nov. 2011. D. Ginat, S. Destounis, R. Barr, C. Benjamin, J. Strang, and D. Rubens, "US Elastography of Breast and Prostate Lesions," Radiographics, vol. 29, no. 7, pp. 2007­2017, 2009. A. B. Wolbarst, P. Capasso, and A. R. Wyant, Medical imaging: essentials for physicians, 1st ed. Hoboken, New Jersey: John Wiley & Sons, Inc., 2013, pp. 302­303. L. Sandrin, B. Fourquet, J.-M. Hasquenoph, S. Yon, C. Fournier, F. Mal, C. Christidis, M. Ziol, B. Poulet, F. Kazemi, M. Beaugrand, and R. Palau, "Transient elastography: a new noninvasive method for assessment of hepatic fibrosis," Ultrasound Med. Biol., vol. 29, no. 12, pp. 1705­1713, Dec. 2003. N. B. Smith and A. Webb, Introduction to Medical Imaging: Physics, Engineering and Clinical Applications. Cambridge University Press, 2011. W. Svensson, "Ultrasound elasticity imaging," Breast Cancer Online, vol. 9, no. 06, pp. 1­7, May 2006. T. Miyagawa, M. Tsutsumi, T. Matsumura, N. Kawazoe, S. Ishikawa, T. Shimokama, N. Miyanaga, and H. Akaza, "Real-time elastography for the diagnosis of prostate cancer: evaluation of elastographic moving images.," Jpn. J. Clin. Oncol., vol. 39, no. 6, pp. 394­ 398, Jun. 2009. A. Bravo, S. Sheth, and S. Chopra, "Liver biopsy," N. Engl. J. Med., vol. 344, no. 7, pp. 495­500, 2001. C. Asteria, A. Giovanardi, A. Pizzocaro, L. Cozzaglio, A. Morabito, F. Somalvvico, and A. Zoppa, "US-elastography in the differential diagnosis of benign and malignant thyroid nodules," Thyroid, vol. 18, no. 5, pp. 523­531, 2008. Z. L. Tabatabai and G. a Staerkel, "Distinguishing primary and metastatic conventional renal cell carcinoma from other malignant neoplasms in fine-needle aspiration biopsy specimens.," Arch. Pathol. Lab. Med., vol. 129, no. 8, pp. 1017­21, Aug. 2005. P. Hoskins, K. Martin, and A. Thrush, Diagnostic ultrasound: physics and equipment, 2nd ed. Cambridge: Cambridge University Press, 2010. J. F. Greenleaf, M. Fatemi, and M. Insana, "Selected methods for imaging elastic properties of biological tissues.," Annu. Rev. Biomed. Eng., vol. 5, pp. 57­78, Jan. 2003.

[2]

[3]

[4]

[5]

[6]

[7]

[8]

[9]

[10]

[11]

[12]

15

[13]

Y. K. Mariappan, K. J. Glaser, and R. L. Ehman, "Magnetic resonance elastography: a review.," Clin. Anat., vol. 23, no. 5, pp. 497­511, Jul. 2010. A. Manduca, T. Oliphant, M. Dresner, J. Mahowald, S. Kruse, E. Amromin, J. Felmlee, J. Greenleaf, and R. Ehman, "Magnetic resonance elastography: non-invasive mapping of tissue elasticity," Med. Image Anal., vol. 5, no. 4, pp. 237­54, Dec. 2001. C. Sun, B. Standish, and V. X. D. Yang, "Optical coherence elastography: current status and future applications.," J. Biomed. Opt., vol. 16, no. 4, p. 043001, Apr. 2011. J. E. Lindop, G. M. Treece, A. H. Gee, and R. W. Prager, "An intelligent interface for freehand strain imaging.," Ultrasound Med. Biol., vol. 34, no. 7, pp. 1117­28, Jul. 2008. J. Ophir, S. K. Alam, B. S. Garra, F. Kallel, E. E. Konofagou, T. Krouskop, C. R. B. Merritt, R. Righetti, R. Souchon, S. Srinivasan, and T. Varghese, "Elastography: Imaging the elastic properties of soft tissues with ultrasound," J. Med. Ultrason., vol. 29, no. 4, pp. 155­171, Dec. 2002. F. Viola and W. Walker, "A comparison of the performance of time-delay estimators in medical ultrasound," IEEE Trans. Ultrason. Ferroelectr. Freq. Control, vol. 50, no. 4, pp. 392­401, Apr. 2003. W. F. Walker and G. E. Trahey, "A fundamental limit on delay estimation using partially correlated speckle signals," IEEE Trans. Ultrason. Ferroelectr. Freq. Control, vol. 42, no. 2, pp. 301­308, Mar. 1995. R. Zahiri-azar and S. E. Salcudean, "Motion Estimation in Ultrasound Images Using Time Domain Cross Correlation with Prior Estimates," IEEE Trans. Biomed. Eng., vol. 53, no. 10, pp. 1990­2000, 2006. Y. Zhu and T. J. Hall, "A Modified Block Matching Method for Real-Time Freehand Strain Imaging," Ultrason. Imaging, vol. 24, no. 3, pp. 161­176, Jul. 2002. T. Loupas, J. T. Powers, and R. W. Gill, "An axial velocity estimator for ultrasound blood flow imaging, based on a full evaluation of the Doppler equation by means of a twodimensional autocorrelation approach," IEEE Trans. Ultrason. Ferroelectr. Freq. Control, vol. 42, no. 4, pp. 672­688, Jul. 1995. C. R. Hill, J. C. Bamber, and G. Ter Haar, Physical principles of medical ultrasonics, 2nd ed. Chichester, UK: John Wiley & Sons, Ltd, 2004, pp. 310­317. D. H. Evans, J. A. Jensen, and M. B. Nielsen, "Ultrasonic colour Doppler imaging," Interface Focus, vol. 1, no. 4, pp. 490­502, 2011. I. A. Hein and W. R. O'Brien, "Current time-domain methods for assessing tissue motion by analysis from reflected ultrasound echoes-a review.," IEEE Trans. Ultrason. Ferroelectr. Freq. Control, vol. 40, no. 2, pp. 84­102, Jan. 1993.

[14]

[15]

[16]

[17]

[18]

[19]

[20]

[21]

[22]

[23]

[24]

[25]

16

[26]

F. Viola and W. Walker, "A spline-based algorithm for continuous time-delay estimation using sampled data.," IEEE Trans. Ultrason. Ferroelectr. Freq. Control, vol. 52, no. 1, p. 80, Jan. 2005. J. Luo and E. Konofagou, "A fast normalized cross-correlation calculation method for motion estimation," IEEE Trans. Ultrason. Ferroelectr. Freq. Control. Ferroelectr. Freq. Control, vol. 57, no. 6, pp. 1347­1357, Jun. 2010. B. H. Friemel, L. N. Bohs, and G. E. Trahey, "Relative performance of two-dimensional speckle-tracking techniques: normalized correlation, non-normalized correlation and sumabsolute-difference," 1995 IEEE Ultrason. Symp. Proceedings. An Int. Symp., pp. 1481­ 1484, 1995. F. Viola and W. Walker, "A comparison between spline-based and phase-domain timedelay estimators," IEEE Trans. Ultrason. Ferroelectr. Freq. Control, vol. 53, no. 3, pp. 515­7, Mar. 2006. H. Azhari, Basics of biomedical ultrasound for engineers. New Jersey: John Wiley & Sons, Ltd, 2010, p. 208. I. Céspedes, Y. Huang, J. Ophir, and S. Spratt, "Methods for estimation of subsample time delays of digitized echo signals," Ultrason. Imaging, vol. 17, no. 2, pp. 142­171, 1995. P. De Jong, T. Arts, A. Hoeks, and R. Reneman, "Determination of tissue motion velocity by correlation interpolation of pulsed ultrasonic echo signals," Ultrason. Imaging, vol. 12, no. 2, pp. 84­98, Apr. 1990. X. Lai and H. Torp, "Interpolation methods for time-delay estimation using crosscorrelation method for blood velocity measurement," IEEE Trans. Ultrason. Ferroelectr. Freq. Control, vol. 46, no. 2, pp. 277­90, Jan. 1999. S. G. Foster, P. Embree, and W. O'Brien Jr, "Flow velocity profile via time-domain correlation: error analysis and computer simulation," Ultrason. Ferroelectr. Freq. Control. IEEE Trans., vol. 37, no. 3, pp. 164­175, 1990. B. Gelman, L. Bohs, M. Czenszak, M. Anderson, and G. Trahey, "Initial experimental results using ensemble tracking for 2D vector velocity measurement," 1996 IEEE Ultrason. Symp., vol. 2, pp. 1241­1244, 1996. L. N. Bohs, B. J. Geiman, M. E. Anderson, S. M. Breit, and G. E. Trahey, "Ensemble tracking for 2D vector velocity measurement: Experimental and initial clinical results.," IEEE Trans. Ultrason. Ferroelectr. Freq. Control, vol. 45, no. 4, pp. 912­24, Jan. 1998. B. Geiman, L. Bohs, M. Anderson, S. Breit, and G. Trahey, "A comparison of algorithms for tracking sub-pixel speckle motion," in 1997 IEEE Ultrasonics Symposium, 1997, vol. 2, no. x, pp. 1239­1242.

[27]

[28]

[29]

[30]

[31]

[32]

[33]

[34]

[35]

[36]

[37]

17

[38]

P. De Jong, T. Arts, A. Hoeks, and R. Reneman, "Experimental evaluation of the correlation interpolation technique to measure regional tissue velocity," Ultrason. Imaging, vol. 161, pp. 145­161, 1991. R. Zahiri-Azar and S. Salcudean, "Time-delay estimation in ultrasound echo signals using individual sample tracking," IEEE Trans. Ultrason. Ferroelectr. Freq. Control, vol. 55, no. 12, pp. 2640­2650, Dec. 2008. G. Pinton and G. Trahey, "Continuous delay estimation with polynomial splines," IEEE Trans. Ultrason. Ferroelectr. Freq. Control, vol. 53, no. 11, pp. 2026­2035, 2006. G. Pinton, J. Dahl, and G. Trahey, "Rapid tracking of small displacements with ultrasound," IEEE Trans. Ultrason. Ferroelectr. Freq. Control, vol. 53, no. 6, pp. 1103­ 1117, Jun. 2006. J. A. Jensen, "Field: A program for simulating ultrasound systems," Pap. Present. 10th Nord. Conf. Biomed. Imaging Publ. Med. Biol. Eng. Comput., vol. 34, no. 1, pp. 351­353, 1996. J. A. Jensen and N. B. Svendsen, "Calculation of pressure fields from arbitrarily shaped, apodized, and excited ultrasound transducers," IEEE Trans. Ultrason. Ferroelectr. Freq. Control, vol. 39, no. 2, pp. 262­267, 1992.

[39]

[40]

[41]

[42]

[43]

18

Chapter 2
A New Algorithm for Time-Delay Estimation in Ultrasonic Echo Signals and Its Application in Ultrasound Elastography
This chapter is a manuscript which was submitted to the journal of IEEE transactions on ultrasonics, ferroelectrics, and frequency control on November 25, 2013.

19

A New Algorithm for Time-Delay Estimation in Ultrasonic Echo Signals and Its Application in Ultrasound Elastography
Elyas Shaswary, Student Member, IEEE, Jahan Tavakkoli, Senior Member, IEEE, and Yuan Xu

Abstract--Time-delay estimation determines the relative displacement between two ultrasound echo signals. In this paper, we propose a new time-delay estimation algorithm, which uses only the sign function to obtain the corresponding time-delay estimate. The performance of the proposed algorithm was compared with two established algorithms, i.e., normalized cross-correlation (NCC) and sum squared differences (SSD), using both statistical analysis and quantitative measurement of image quality in ultrasound elastography. All simulated ultrasound echo signals were generated using Field II ultrasound simulation software. The results indicated that in overall the proposed algorithm had similar accuracy and precision compared to NCC and SSD algorithms. On the other hand, the proposed algorithm produced images with marginally higher signal-to-noise and contrast-to-noise ratios compared to NCC and SSD in ultrasound elastography. Index Terms--Time-delay estimation, ultrasound elastography, strain imaging, crosscorrelation, sum squared differences.

20

I.

INTRODUCTION

Time-delay estimation is a key task in many signal processing applications and it is used in many fields, such as radar, sonar, communication, medical imaging, acoustics, and speech processing [1]. In ultrasound medical imaging, the performance of many signal processing applications is dependent on the accurate estimation of the relative time-delay between a reference and a delayed echo signals. Time-delay estimation, in medical ultrasound imaging, has applications in areas such as tissue elasticity imaging [2], [3], [4], [5], blood flow imaging [6], [7], [8], [9], [10], [11], acoustic radiation force imaging (ARFI) [12], [13], [14], motion compensation for synthetic receive aperture imaging [15], phase-aberration correction [16], [17], [18], noninvasive temperature estimation [19], and so on. Time-delay estimation has been extensively studied and a number of methods have been proposed. Time-delay estimation calculates the displacement between a sequence of backscattered ultrasound signals, where the displacement appears as time shift or phase shift. Time-delay estimation can be performed in different domains such as time, phase, or frequency. However, time-domain methods are more extensively used due to their high accuracy, precision, and spatial resolution [20], [21], [22], [23], [24]. Time-domain methods are primarily used in tissue motion estimation. Generally, a segment of radiofrequency (RF) data in a reference echo signal is compared with a segment of RF data in a delayed echo signal. At each window a pattern-matching function is calculated to find the location where the two windows resemble each other the most. Most common patternmatching functions calculate correlation coefficients or squared difference values between the two windows.

21

Many time-delay estimation algorithms have been proposed over the years, each offers trade-offs between accuracy, spatial resolution, and computational time [21], [24], [25], [26]. Some of the well-known algorithms include cross-correlation (CC), normalized cross-correlation (NCC), covariance (CV), normalized covariance (NCV), sum squared differences (SSD) and sum absolute differences (SAD). CC, NCC, CV and NCV methods computes correlation coefficient function and the location where the correlation coefficient is maximum is the corresponding time-delay. SSD and SAD methods compute squared and absolulte difference functions, respectively and the location where the squared or absolute difference functions is minimum is the corresponding time-delay. NCC, NCV, and SSD methods are generally considered to be the gold standard methods as they yield optimal results under different testing conditions [21]. NCC and NCV are computationally very similar with the exception that NCV considers the mean of the reference and the delay signals. NCC and NCV differ from CC and CV in their algorithmic operations by considering the energy of the reference and the delayed signal [21]. Considering the energy of the reference and the delayed signal is beneficial because it compensates for the local variations in the standard deviations and mean of the signals [27]. NCC and NCV suffer from high computational cost, which can be problematic for real-time implementation [21], [24]. A few novel implementations of NCC and SSD have been reported to reduce their computational cost [25], [28], [29]. Many factors can deteriorate the performance of the all these algorithms [21], [24]. Practically, time-delay estimation is computed using discrete-time ultrasonic echo signals. When discrete-time signals are used to compute time-delay estimation the output is an integer multiple of the sampling period, which could be a potential source of error (i.e.,

22

high bias and variance) in time-delay estimation [21]. However, if the discrete-time signals are sampled beyond the Nyquist rate, then by using interpolation the time-delay estimates will be as precise and accurate as continuous-time signals [21]. The reference and delayed signals can be interpolated before and/or after computing the pattern-matching function, as shown in Figure 2.1.

Figure 2.1: Most common time-delay estimation schemes. (a) Time-delay estimation without interpolation. (b) Time-delay estimation with interpolation of the reference and delayed signals before computing a pattern-matching function. (c) Time-delay estimation with interpolation of the patternmatching function. (d) Time-delay estimation with interpolation of the reference and delayed signals, and interpolation of the pattern-matching function.

Interpolation of the signals before computing the pattern-matching function simply increases the sampling rate, which enables more accurate time-delay estimates [1]. Interpolation of the signals after computing the pattern-matching functions usually fits a predetermined type of curve or a polynomial to a number of samples points in the patternmatching functions to describe the pattern-matching functions as if they are continuoustime functions [30]. This approach does not restrict the time-delay estimates to be integer multiple of the sampling period. A number of interpolation techniques have been described in literature which include, but not limited to, cosine-curve fitting [31], parabolic-curve fitting [32], [33], grid slope [34], [35] and spline fitting [36].

23

In addition, the performance of the time-delay estimators are deteriorated when the finite length reference and delayed signals are corrupted by electronic and/or acoustic noises and decorrelated by physical processes [21], [24]. These factors can cause two type of errors in the time-delay estimates, which are referred to as false peak and jitter errors [21], [24]. False peak error ensues when there is another peak in cross-correlation function which has higher amplitude than the true peak. In the case of SSD and SAD estimators, false peak error occurs when another peak in least difference function has lower amplitude than the true peak. Thus, false peak error occurs when an incorrect peak is selected in the pattern-matching function. Jitter error occurs when the true peak of the pattern-matching function is shifted from its true position [21], [24]. False peak errors can be easily identified in the time-delay estimates and they can be filtered out using nonlinear signal processing, such as median filtering [21]. On the other hand, jitter errors cannot be filtered out and as a result the performance of the time-delay estimators is fundamentally limited by the jitter errors [21]. In this work, we propose a new time-domain time-delay estimation method. The proposed method generates a zero-crossing in the pattern-matching function. The location of the zero-crossing corresponds to the best match between a reference and a delayed signal.

II.

PROPOSED ALGORITHM

The new algorithm is based on finding the location of a zero-crossing at a specific window using the equation:

24

  ( )) 0 =  sign(2 ( ) - 1 ( )) & sign(1  =1

(2.1)

where 1 () is the reference signal, 2 () is the delayed signal, 1 () is the instantaneous time derivative of 1 (), & is the logical operator AND,  is number of sample point within the window, and  is the sample point. At each sample point, Eq. 2.1 takes the difference between 1 () and 2 (), multiplies it by the instantaneous time derivative of 1 (), and determines the sign of them. Then, sum the signs as values of either +1 or 1 from all the sample points. If 2 () is shifted to the left of 1 () then Eq. 2.1 will yield positive signs (+1), as shown in Figure 2.2(a). If 2 () is shifted to the right of 1 () then Eq. 2.1 will yield negative signs (-1), as shown in Figure 2.2(b). If 2 () is aligned with 1 () then Eq. 2.1 will yield zero. The trend (i.e., change in mean) of 1 () and 2 () was removed by subtracting their respective means before applying Eq. 1.
15 10
Echo Amplitude (AU) Echo Amplitude (AU)

Reference Signal (w1)

15 10 5 0 -5 -10

Shifted Signal (w2)

5 0 -5 -10 (w2(tk - ) - w1(tk))  w1(tk) -15

(w2(tk - ) - w1(tk))  w1(tk) -15 10.1 9.8 9.9 10 Time ( s) (b) 10.1

9.8

9.9

10 Time ( s) (a)

Figure 2.2: (a) Representation of positive shifting. (b) Representation of negative shifting.

In order to find out the location of zero-crossing we use the general form of Eq. 2.1, as:

25

  ( )) () =  sign(2 ( - ) - 1 ( )) & sign(1  =1

(2.2)

where  is search lag (i.e., time-shift while searching for a zero-crossing). Eq. 2.2 slides 2 () over 1 () from -max to +max . Eq. 2.2 slides 2 () over 1 () from the left side (i.e. -max ) to the right side (i.e. +max ) to obtain a zero-crossing point. In other words, a zero-crossing is obtained when Eq. 2.2 goes from positive sign to negative sign, as shown in Figure 2.3. The location of zero-crossing corresponds to the location where 1 () and 2 () are at their closest match. The location of the closest match also corresponds to the time-delay between them.
200 150 100

Sum of Signs

50 0 -50 -100 -150 -200 1 2 3 4 5 6 Search Lag () 7 8 9

Figure 2.3: Visualization of Eq. 2.2 to generate a pattern-matching function to obtain a zero-crossing.

Keeping -max and +max at a minimum, increases efficiency of the method by avoiding the unnecessary search for a zero-crossing. This is only possible if one has a priori information about the range over which the search for a zero-crossing should be done. However, in most applications the time-delay from one window to the next window does not vary significantly and we can use the time-delay estimation of the previous window to guide the search for a zero-crossing in the current window. If the time-delay estimation in

26

previous window is erroneous (e.g., in scenarios when there is multiple zero-crossings or when there is no zero-crossing) then either the window proceeding the previous window or an alternative backup method, e.g., NCC or SSD, can be used to guide the search in the current window.

III.

SIMULATION METHODS

A series of simulation was carried out to investigate the performance of the proposed algorithm. The performance of the proposed algorithm was investigated in terms of standard deviation (i.e., a measurement of precision), bias (i.e., a measurement of accuracy) and standard deviation of the jitter error (i.e., standard deviation of time-delay estimate error) as a function of sub-sample delay, signal-to-noise-ratio (SNR), and kernel window length. The performance of the proposed algorithm was compared with NCC, SSD with and without cosine curve fittings algorithms. The effect of interpolation on the performance of the time-delay estimation methods was also examined by interpolating the reference and delayed signals before computing a pattern-matching function. Field II ultrasound simulation software [37], [38] was used to generate a series of ultrasound RF echo signals. Field II can accurately simulate a typical array-based ultrasound scanner to generate RF signals. To this end, it generates RF echo signals from a collection of point scatterers, which are distributed uniformly in the region of interest and their scattering strength are set by a Gaussian distribution [39]. Thus, different types of Bmode images can be constructed by adjusting the scatterers distribution and scatterers strength.

27

In order to simulate time-delay in ultrasound RF signal, first a reference signal was generated by uniformly distributing a number of scatterers within a volume and then Field II was used to construct the corresponding RF echo signal. A delayed version of the reference signal was generated by shifting the same scatterers distribution (which was used for the construction of the reference echo signal) in the axial direction and then Field II was used to construct the corresponding RF echo signal. A linear array transducer with 192 elements, utilising 64 active elements with a Hanning apodization in transmit and receive, was used to scan the 160,000 scatterers within a 40×40×10 mm (axial, lateral, elevation) volume. Main parameters and their values which were used in Field II are listed in Table 2.1. The scatterers were displaced by sub-sample amount (i.e., displacement which corresponds to a fraction of the sampling period) and the displacement of the scatterers was varied from 0 to 1 samples, in increment of 0.05 samples, to generate a total of 21 sets of delayed signals. A set of 200 reference and delayed signals were generated for statistical analysis, where each signal included about 5000 samples point (equivelent to 50 ). In addition, narrowband noise (i.e., noise which had the same bandwidth as the signals) was added to the reference and delayed signals to generate signals with varying SNR in the range of 10 to 60 dB.

28

PARAMETER Transducer type Element height Element weight Inter-element spacing Transmit focus Receive focus Apodization Dimension of the tissue phantom Number of scatterers Density of scatterers Sampling frequency Transmit centre frequency Speed of Sound Attenuation coefficient Number of A-lines per frame

VALUE Linear array with 192 elements and 64 active elements 5 mm 1 wavelength (equivalent to 0.15 mm) 0.05 mm 20 mm 10 mm and 30 mm Hanning 40 mm × 40 mm × 10 mm (axial, lateral, elevation) 160,000 scatterers 10 scatterers/mm3 100 MHz 5 MHz 1510 m/s 0.75 dB/(cm MHz) 200

Table 2.1: Parameters and their assigned values used in Field II ultrasound simulation software for generation of ultrasound echo signal to perform statistical analysis.

The reference and delayed signals were segmented into small windows with overlapping and time-delay estimation was performed between each window. Once, timedelay estimates for all windows were estimated then their bias (), standard deviation () and standard deviation of the jitter error were computed using the following equations [1], [24]: 1 ) = ( [] - []) ( 
=1 

(2.3)

1 1 ) =   ( [] -   []) (  
=1 =1





2

(2.4)

1 ) =  ([i] -  [])2 ( -  
=1



(2.5)

29

[] is the estimated time-delays, and  is the number where [] are the true time-delays,  of time-delay estimates.

IV.

SIMULATION RESULTS AND DISCUSSION

A series of simulated ultrasonic RF echo signals were generated using Field II. All calculations were carried out in MATLAB (MathWorks Inc., Natick, MA). The performance of the proposed algorithm was evaluated without interpolation (as depicted in Figure 2.1(a)) and with interpolation of the RF signals by a factor of 10 (equivalent to 1 GHz sampling frequency) before computing a pattern-matching function (as depicted in Figure 2.1(b)). NCC and SSD algorithms were implemented in all possible methods, as shown in Figure 2.1(a)-(d). Simulation results are shown in Figure 2.4 through Figure 2.6. The vertical axes of standard deviation and standard deviation of the jitter errors are shown in logarithmic scales to enhance their visualization. Figure 2.4 shows the standard deviation, bias, and standard deviation of the jitter errors as a function of sub-sample delays. The reference and delayed signals had SNR of 45 dB and the window length was set to 10 wavelengths (equivalent to 2  1.51 mm) with 50% overlap. The sub-sample delays were varied from 0 samples to 1 samples in increment of 0.05 samples. The new algorithm without pre-pattern-matching interpolation of the reference and delayed signals (as shown by five-pointed star in Figure 2.4) had its lowest bias at sub-sample delay of 0 samples and 0.5 samples. In addition, it had its lowest standard deviation and standard deviation of the jitter errors as the sub-sample delays approached 0.5 samples. This indicates that the proposed algorithm is biased towards timedelays of 0.5 samples. On the other hand, the standard deviation, bias, and standard

30

deviation of the jitter errors of NCC and SSD, without pre-pattern matching interpolation of the reference and delayed signals (as shown by circle and diamond in Figure 2.4, respectively), were lowest close to sub-sample delay of 0 and 1 samples. This shows that NCC and SSD algorithms, without interpolation of the data, can only estimate time-delays at an integer multiple of the sampling period and they do not have sub-sample accuracy. NCC with cosine curve fitting (as shown by the dot in Figure 2.4) and SSD (as shown by the square in Figure 2.4) with cosine curve fitting had relatively lower standard deviation, bias, and standard deviation of the jitter errors compared to NCC and SSD without interpolation. This indicates that NCC and SSD can achieve sub-sample accuracy with cosine curve fitting. For all sub-sample delays, NCC with cosine curve fitting had lower standard deviation, bias, and standard deviation of the jitter errors compared to SSD with cosine curve fitting.

31

NCC NCC w / CosFit SSD SSD w / CosFit Proposed Algo. 10
1

NCC w / Int10 NCC w / Int10 & CosFit SSD w / Int10 SSD w / Int10 & CosFit Proposed Algo. w / Int10

Standard Deviation (ns)

10

0

10

-1

10

-2

0

0.1

0.2

0.3

0.4 0.5 0.6 Sub-Sample Delay (Samples) (a)

0.7

0.8

0.9

1

5 3

Bias (ns)

1 0 -1 -3 -5 0 0.1 0.2 0.3 0.4 0.5 0.6 Sub-Sample Delay (Samples) (b) 0.7 0.8 0.9 1

10

1

Standard Deviation of the Jitter Errors (ns)

10

0

10

-1

10

-2

0

0.1

0.2

0.3

0.4 0.5 0.6 Sub-Sample Delay (Samples) (c)

0.7

0.8

0.9

1

Figure 2.4: Standard deviation, bias, and standard deviation of the jitter error as a function of sub-sample delay. For each sub-sample delay 200 A-lines were used and each A-line was divided by window length of 10 wavelengths (with 50% overlaps) which resulted in 9000 time-delay estimates. Sampling frequency was 100 MHz, center frequency was 5 MHz, and SNR was 45 dB.

Interpolation of the reference and delayed signals prior to computing a patternmatching function generally reduced the standard deviation, bias, and standard deviation

32

of the jitter errors of all time-delay estimation methods, except the NCC with cosine curve fitting, for all sub-sample delays. When the reference and delayed signals were interpolated by a factor of 10, NCC (as shown by the triangle in Figure 2.4) and SSD (as shown by the inverted triangle in Figure 2.4) had slightly higher standard deviation and standard deviation of the jitter errors compared to the proposed algorithm (as shown by the asterisk in Figure 2.4), NCC with cosine curve fitting (as shown by the left pointing triangle in Figure 2.4), and SSD with cosine curve fitting (as shown by the right pointing triangle in Figure 2.4) for sub-sample delays of 0.05 samples to 0.95 samples in steps of 0.1 samples. On the other hand, for sub-sample delays of 0 samples to 1 samples in step of 0.1 samples the standard deviation, bias, and standard deviation of the jitter errors of all methods were about the same. In addition, SSD with interpolation of the data in most cases had lower standard deviation, bias, and standard deviation of the jitter errors relative to SSD with cosine curve fitting for all sub-sample delays. On contrary, NCC with interpolation of the data had marginally higher standard deviation, bias, and standard deviation of the jitter compared to NCC with cosine curve fitting. Thus, NCC benefits more from cosine curve fitting than from interpolation of the data and SSD generally benefits more from interpolation of the data than from cosine curve fitting. The proposed new algorithm with interpolation of the data had about the standard deviation, bias, and standard deviation of the jitter errors as NCC with cosine curve fitting, NCC with interpolation of the data and cosine curve fitting, and SSD with interpolation of the data and cosine curve fitting for all sub-sample delays. Figure 2.5 shows standard deviation, bias, and standard deviation of the jitter errors as a function of SNR. The sub-sample delay was set to 0.25 samples and window length

33

was set to 10 wavelengths with 50% overlap. The SNR was varied from 10 dB to 60 dB. As expected, the standard deviation and standard deviation of the jitter errors of all methods generally decreased as SNR increased. The proposed new algorithm without interpolation of the data had about the same magnitude of bias and standard deviation of the jitter errors as the NCC and SSD algorithms without interpolation of the data for all values of SNR. Without interpolation of the data, the proposed algorithm had positive biases whereas NCC and SSD had negative biases. When the sub-sample delay was 0.25 samples the proposed method was biased toward a sub-sample delay of 0.5 samples and on the other hand, NCC and SSD were biased toward a sub-sample delay of 0 samples. Thus, the proposed algorithm yielded positive biases (i.e., difference between estimated and true time-delays were positive) and NCC and SSD yielded negative biases (i.e., difference between estimated and true time-delays were negative). NCC with cosine curve fitting and SSD with cosine curve fitting had lower bias compared to proposed algorithm, NCC, and SSD without interpolation of the data for all levels of SNR. Moreover, the bias of all method remained about the same for all amount of SNR, with exception of the proposed algorithm without interpolation of the data which increased slightly as SNR increased. This increase in bias of the proposed algorithm, without interpolation of the data, is because the proposed algorithm becomes more stable as SNR increases as it is evident from its decrease of standard deviation.

34

NCC NCC w / CosFit SSD SSD w / CosFit Proposed Algo. 10
3 2 1 0 -1 -2

NCC w / Int10 NCC w / Int10 & CosFit SSD w / Int10 SSD w / Int10 & CosFit Proposed Algo. w / Int10

Standard Deviation (ns)

10 10 10 10 10

10

15

20

25

30

35 SNR (dB) (a)

40

45

50

55

60

4 2

Bias (ns)

0 -2 -4 -6 -8 10 15 20 25 30 35 SNR (dB) (b) 40 45 50 55 60

10

3 2 1 0 -1 -2

Standard Deviation of the Jitter Errors (ns)

10 10 10 10 10

10

15

20

25

30

35 SNR (dB) (c)

40

45

50

55

60

Figure 2.5: Standard deviation, bias, and standard deviation of the jitter errors as a function of SNR. For each SNR 200 A-lines were used and each A-line was divided by window length of 10 wavelengths (with 50% overlaps) which resulted in 9000 time-delay estimates. Sub-sample delay between the reference and delayed signals were 0.25 samples. Sampling frequency was 100 MHz and center frequency was 5 MHz.

With interpolation of the data, the proposed new algorithm, NCC with cosine curve fitting, SSD with cosine curve fitting, and NCC with cosine curve fitting but without

35

interpolation of the data had about the same and lowest standard deviation, bias, and standard deviation of the jitter errors for all levels of SNR. SSD with interpolation of the data had lower bias and standard deviation of the jitter errors compared to SSD with cosine curve fitting. On the other hand, NCC with cosine curve fitting had lower standard deviation, bias, and standard deviation of the jitter errors compared to NCC with interpolation alone for all levels of SNR. Figure 2.6 shows the standard deviation, bias, and standard deviation of the jitter errors as a function of window length. The reference and delayed signals had SNR of 45 dB and the sub-sample delay was set to 0.25 samples. The window length was varied from 1 wavelength (equivalent to 0.2   0.151 mm) to 40 wavelengths (equivalent to 8   6.04 mm). The standard deviation of all methods generally decreased as window length increased and the bias of all methods remained nearly the same as window length increased. This was expected because as sample points within a window increases the time-delay estimation becomes more precise; however more sample points within a window do not affect the accuracy of the time-delay estimation. Without interpolation of the data, the proposed new algorithm, NCC, and SSD had highest bias magnitude and standard deviation of the jitter errors compared to other methods for all window lengths. With interpolation of the data, the proposed algorithm, NCC with cosine curve fitting, SSD with cosine curve fitting, and NCC with cosine curve fitting but without interpolation of the data had relatively the lowest standard deviation, bias, and standard deviation of the jitter errors for all considered window lengths. In addition, the standard deviation of the jitter errors of the proposed algorithm with interpolation of the data, SSD with cosine curve fitting and interpolation of the data, NCC with cosine curve fitting and interpolation of the data, and

36

NCC with cosine curve fitting but without interpolation of the data decreased with increased in window length.
NCC NCC w / CosFit SSD SSD w / CosFit Proposed Algo. 10
0

NCC w / Int10 NCC w / Int10 & CosFit SSD w / Int10 SSD w / Int10 & CosFit Proposed Algo. w / Int10

Standard Deviation (ns)

10

-1

10

-2

0 1 2

5

10

15 20 25 Window Length (Wavelength) (a)

30

35

40

3 2

Bias (ns)

1 0 -1 -2 -3 0 1 2 5 10 15 20 25 Window Length (Wavelength) (b) 30 35 40

10

1

Standard Deviation of the Jitter Errors (ns)

10

0

10

-1

10

-2

0 1 2

5

10

15 20 25 Window Length (Wavelength) (c)

30

35

40

Figure 2.6: Standard deviation, bias, and standard deviation of the jitter errors as a function of window length. For each window length 200 A-lines were used. Sub-sample delay between the reference and delayed signals were 0.25 samples. Sampling frequency was 100 MHz, center frequency was 5 MHz, SNR was 45 dB, and window overlap was 50%.

37

V.

EXPERIMENTAL PERFORMANCE

An experiment was carried out to study the performance of the proposed new algorithm using data acquired from an ultrasound scanner. The perforamcne of the proposed algorithm was evaluated in terms of target detectiabilty (i.e., visual apperance of target to the observer), elastographic signal-to-noise ratio (SNR e ) and elastographic contrast-tonoise ratio (CNR e ). A commerical ultrasound breast elastography phantom (Model #059, CIRS Inc., Nortfolk, VA, USA) was scanned using Sonix RP ultrasound scanner (Ultrasonix Medical Corp., Richmond, BC, Canada) with a 128 element linear array transducer. The phantom contained several spherical inclusions which were about 4.6 times stiffer than the background according to the manufacturer's specificaitons. Some of key specifications of the phantom are tabulated in Table 2.2.
Parameter Elasticity Speed of sound Contrast Attenuation Inclusions 89 kPa 1560 m/s -1.66 dB 0.5 dB/(cm MHz) Background 19.3 kPa 1534 m/s -1.44 dB 0.46 dB/(cm MHz)

Table 2.2: Specifications of the CIRS breast elastography tissue phantom.

The ultrasound scanner was set to 5 MHz transmit central frequency and 40 MHz sampling freqency. The transducer was held by hand while it is pressed in and out by small compressional force against the phantom's top surface. At the same time, RF frames were stored for post-processing. All post-processing calculations were performed in MATLAB (MathWorks, Inc., Natick, MA, USA). 5 consecutive RF frames were randomly selected out of over 100 acquired RF frames and then processed. Figure 2.7 depicts the B-mode images of two consective frame as an example. In the acquired RF frames two stiff inclusions were present, one at about 15 mm axial depth with diamter of about 15 mm and

38

another one at about 32 mm axial depth with diameter of about 7 mm. The time-delay estimates between two consective RF frames were computed pair-wise by dividing each A-line into small windows of 10 wavelengths (equivalent to 1.51 mm) with 75% overlap. The time-delay estimation algorithms which were used included the proposed algorithm, NCC, NCC with cosine curve fitting, SSD, and SSD with cosine curve fitting. The effects of interpolation was also considered by interpolating the RF frames by a factor of 10-fold (equivalent to 400 MHz sampling frequency). The strain map was generated by the numerical differentiation of the time-delay estimates, using the 1D Savitzky-Golay digital differentiator (SGDD) [40]. SGDD is a moving least-squares polynomial fitting technique, which is performed by the convolution of an input signal with the filter coefficients. The filter coefficients depend on the order of differentiation, degree of the polynomial and length of the filter [40], [41]. SGDD with first or second degree of polynomial fitting is more suitable in ultrasound elastography as it can produce strain maps with high SNRe and CNRe [42], which are defined as follows [43], [44]:  =  
2

(2.6)

2(background - lesion )  = 2 2 (background + lesion )

(2.7)

where  is the mean and  is the standard deviation of a region of uniform strain in the strain map. In this work, SGDD with filter length of 9 samples, ploynomail fitting of second degree, and differentiation of first order was used. Moreover, the strain maps were filtered using 5×5 median and mean filters to further increase the SNR e because the gradient operator introduces extra noise amplification in the strain maps [45].

39

Pre-Compression B-Mode Image 5 10 5 10

Post-Compression B-Mode Image 128

Axial Distance (mm)

20 25 30 35 40 45 -20 -10 0 10 Lateral Distance (mm) (a) 20

Axial Distance (mm)

15

15 20 25 30 35 40 45 -20 -10 0 10 Lateral Distance (mm) (b) 20 0

Figure 2.7: B-mode images of the RF frames acquired from the CIRS breast elastography tissue phantom at (a) pre-compression state and at (b) post-compression state.

Figure 2.8 shows the filtered strain maps generated using various algorithms studied. Without interpolation of the data, NCC, SSD, and the proposed algorithm were not able to clearly show the two inclusions. With interpolation of the data and/or cosine curve fitting all algorithms were able to show the inclusions. The larger inclusion was clearly standing out from the background; however, the smaller inclusion was somewhat concealed in the background (e.g., the colour shading of the inclusion was very similar to the surrounding medium). This type of artifacts in the elastograms are called "target hardening", which arises from non-uniform distribution of stress in the medium [2], [46]. Stress is depth dependent and it decreases as depth increases. When a compressional force is applied to a medium, the stress near top surface of the medium is greater compared to the stress near the bottom end of the medium. Moreover, the scatterers near the top surface of the medium, where the force is applied, are displaced the most and the scatterers at the deepest end are displaced the least. Therefore, the strain in the elastograms decreases as

40

depth increases. Figure 2.9(a) shows the strain of a single line (passing through the middle of the large inclusions as shown in Figure 2.8). It can be seen that the strain decreases as depth increases, which makes the detection of deep inclusions problamatic. We attempt to solve the strain dependence on depth by a process called strain map normalization. First, the strain trend was determined by taking the average of several strain lines (e.g., 10 lines) from random lateral distances and it was filtered out to make it smooth. The filtering of the strain trend was done by 1×20 median and moving average filters. Figure 2.9(b) shows a strain line along with the strain trend. Then, each strain line in the elastogram was normalized by the magnitude of the strain trend to obtain a normalized elastogram. Figure 2.9(c) depicts a normalized strain line in which the dependence of strain on depth is compansated. Figure 2.10 shows normalized strain maps corresponding to those shown shown in Figure 2.8. The SNRe and CNRe of each strain map shown in Figure 2.8 and Figure 2.10 are listed in Table 2.3. Without interpolation of the data, the proposed algorithm had higher SNRe and CNRe compared to NCC and SSD, but it had lower SNRe and CNRe compared to NCC and SSD with cosine curve fittings. With interpolation of the data, the proposed new algorithm had the highest SNRe and CNRe . NCC with interpolation of the data and/or cosine curve fitting, SSD with interpolation of the data, and SSD with interpolaiton of the data and cosine curve fitting had about the same SNRe and CNRe . Moreover, interpolation of the data and/or cosine curve fitting significently improve the quality of the strain maps in terms of SNRe and CNRe . Furthermore, strain map normalization did not affect the SNRe and CNRe of the elastograms even though it compansated for strain decay with depth.

41

Soft

Figure 2.8: The strain maps of the CIRS breast elastography tissue phantom. Time-delay estimates were computed by all considered algorithms (using window length of 10 wavelengths with 75% window overlap). The corresponding strain was computed using the SGDD method (with filter length of 9 samples, polynomial fitting of second degree, and differentiation of first order). The strain maps were also filtered by a 5×5 median and mean filters.

42

Figure 2.9: (a) Plot of a single strain line along the axial direction. (b) Plot of the strain trend (shown by the dotted line) by which strain line was normalized. (c) Plot of a strain line after normalization.

Original Strain Map Algorithm NCC NCC w/ CosFit SSD SSD w/ CosFit Proposed Algorithm NCC w/ Int10 NCC w/ Int10 & CosFit SSD w/ Int10 SSD w/ Int10 & CosFit Proposed Algorithm w/ Int10 SNRe (dB) 4.10 19.13 4.09 17.62 9.11 19.51 18.99 19.53 19.04 19.99 CNRe (dB) -2.20 21.77 -2.23 8.32 1.21 21.95 21.89 21.97 21.91 23.36

Normalized Strain Map SNRe (dB) 3.99 19.48 3.99 17.04 9.48 19.36 19.40 19.39 19.38 20.63 CNRe (dB) -2.52 21.82 -2.54 9.29 1.25 21.66 21.87 21.67 21.85 23.48

Table 2.3: SNRe and CNRe of the original and the normalized strain maps of the CIRS breast elastography tissue phantom. From each strain map, sample points (about 60 samples) were taken from the region of small inclusions and from the background at the same axial.

43

Soft

Figure 2.10: The normalized strain map of the CIRS breast elastography tissue phantom. Time-delay estimates were computed by all considered algorithms (using window length of 10 wavelengths with 75% window overlap). The corresponding strain was computed using the SGDD method (with filter length of 9 samples, polynomial fitting of second degree, and differentiation of first order). The strain maps were filtered by a 5×5 median and mean filters.

44

VI.

CONCLUSIONS

The results of the statistical analysis indicate that the proposed algorithm performs comparable to NCC and SSD. However, the proposed algorithm performs inferior compared to NCC and SSD with cosine curve fitting. The results also indicates that NCC benefits more from curve fitting than from interpolation of the RF data and on contrary SSD benefits more from interpolation of the RF data than from cosine curve fitting. In ultrasound elastography, the proposed algorithm produced higher quality strain maps (in terms of SNRe and CNRe) compared to NCC and SSD but lower quality strain maps compared to NCC and SSD with cosine curve fitting. On the other hand, with interpolation of the data the proposed algorithm produced strain map of the highest quality relative to NCC and SSD with interpolation of the data and/or cosine curve fitting. Thus, the proposed algorithm is an optimal time-delay estimator for applications in ultrasound elastography. The proposed method provides an alternative to the curent eastablished TDE methods. One important feature of the proposed algorithm is that Eq. 2 can be implemented by comparing two numbers and using the sign function, and a counter after the sign of the derivative of the signal is determined. No mathematic operation such as summmation and multiplication is needed. Therefore, it can be potentially implemented on hardware with high efficiency. Even though, the computational efficiency of the proposed new algorithm has not been studied in the paper, it is anticipated that it is not more computationally burdensome than NCC and SSD as it uses the time-delay estimates of the previous windows to significantly reduce the searching range of the current window. A possible future work can be to compare the computational efficiency of the proposed new algorithm

45

with NCC and SSD algorithms in a realistic situation (e.g., real-time). In addition, the proposed algorithm was not implemented with curve fitting because a suitable curve fitting method was not found. It is anticipated that its performance could improve with implementation of curve fitting.

ACKNOWLEDGEMENTS
The authors gratefully thank Dr. Richard S. C. Cobbold (University of Toronto) and Dr. Joseph Carl Kumaradas (Ryerson University) for providing valuable guidance on this work. The authors also thank Dr. Mostafa Atri (Toronto General Hospital) for lending his elastography tissue phantom. This work was partially supported by the Ontario Research Fund- Research Excellence (ORF-RE) grant and the Natural Science and Engineering Research Council of Canada (NSERC Discovery grant) that were awarded to J. Tavakkoli, and the Natural Science and Engineering Research Council of Canada (NSERC Discovery grant) that was awarded to Y. Xu.

REFERENCES FOR CHAPTER 2
[1] F. Viola and W. Walker, "A spline-based algorithm for continuous time-delay estimation using sampled data.," IEEE transactions on ultrasonics, ferroelectrics, and frequency control, vol. 52, no. 1, p. 80, Jan. 2005. J. Ophir, I. Cespedes, H. Ponnekanti, Y. Yazdi, and X. Li, "Elastography: a quantitative method for imaging the elasticity of biological tissues," Ultrasonic imaging, vol. 13, no. 2, pp. 111­134, 1991. J. Ophir, S. K. Alam, B. S. Garra, F. Kallel, E. E. Konofagou, T. Krouskop, C. R. B. Merritt, R. Righetti, R. Souchon, S. Srinivasan, and T. Varghese, "Elastography: Imaging the elastic properties of soft tissues with ultrasound," Journal of Medical Ultrasonics, vol. 29, no. 4, pp. 155­171, Dec. 2002.

[2]

[3]

46

[4] [5] [6]

G. Treece, J. Lindop, and L. Chen, "Real-time quasi-static ultrasound elastography," Interface Focus, vol. 1, no. 4, pp. 540­52, Aug. 2011. P. Wells, "Medical ultrasound: imaging of soft tissue strain and elasticity," Journal of The Royal Society, vol. 8, no. 64, pp. 1521­49, Nov. 2011. P. Embree and W. O'Brien, "Volumetric blood flow via time-domain correlation: experimental verification," IEEE Transactions on Ultrasonics, Ferroelectrics and Frequency Control, vol. 37, no. 2, pp. 176­189, 1990. L. Bohs, B. Friemel, and G. Trahey, "Experimental velocity profiles and volumetric flow via two-dimensional speckle tracking," Ultrasound in medicine & biology, vol. 21, no. 7, 1995. L. N. Bohs, B. J. Geiman, M. E. Anderson, S. C. Gebhart, and G. E. Trahey, "Speckle tracking for multi-dimensional flow estimation.," Ultrasonics, vol. 38, no. 1­8, pp. 369­75, Mar. 2000. C. Kasai, K. Namekawa, a. Koyano, and R. Omoto, "Real-Time Two-Dimensional Blood Flow Imaging Using an Autocorrelation Technique," IEEE Transactions on Sonics and Ultrasonics, vol. 32, no. 3, pp. 458­464, May 1985. T. Loupas, J. T. Powers, and R. W. Gill, "An axial velocity estimator for ultrasound blood flow imaging, based on a full evaluation of the Doppler equation by means of a twodimensional autocorrelation approach," IEEE Transactions on Ultrasonics, Ferroelectrics and Frequency Control, vol. 42, no. 4, pp. 672­688, Jul. 1995. T. Loupas, R. B. Peterson, and R. W. Gill, "Experimental evaluation of velocity and power estimation for ultrasound blood flow imaging, by means of a two-dimensional autocorrelation approach," IEEE Transactions on Ultrasonics, Ferroelectrics and Frequency Control, vol. 42, no. 4, pp. 689­699, Jul. 1995. K. R. Nightingale, M. L. Palmeri, R. W. Nightingale, and G. E. Trahey, "On the feasibility of remote palpation using acoustic radiation force," The Journal of the Acoustical Society of America, vol. 110, no. 1, p. 625, 2001. K. Nightingale, M. Soo, and R. Nightingale, "Acoustic radiation force impulse imaging: in vivo demonstration of clinical feasibility," Ultrasound in medicine & biology, vol. 28, no. 2, pp. 227­235, 2002. M. L. Palmeri and K. R. Nightingale, "Acoustic radiation force-based elasticity imaging methods," Interface Focus, vol. 1, no. 4, pp. 553­564, Jun. 2011. G. Trahey and L. Nock, "Synthetic receive aperture imaging with phase correction for motion and for tissue inhomogeneities. II. Effects of and correction for motion," IEEE Transactions on Ultrasonics Ferroelectrics and Frequency Control, pp. 496­501, 1992. S. W. Flax and M. O'Donnell, "Phase-aberration correction using signals from point reflectors and diffuse scatterers: basic principles.," IEEE transactions on ultrasonics, ferroelectrics, and frequency control, vol. 35, no. 6, pp. 758­67, Jan. 1988.

[7]

[8]

[9]

[10]

[11]

[12]

[13]

[14] [15]

[16]

47

[17]

G. C. Ng, S. S. Worrell, P. D. Freiburger, and G. E. Trahey, "A comparative evaluation of several algorithms for phase aberration correction," IEEE Transactions on Ultrasonics Ferroelectrics and Frequency Control, vol. 41, no. 5, pp. 631­643, 1994. M. Karaman, a Atalar, H. Koymen, and M. O'Donnell, "A phase aberration correction method for ultrasound imaging.," IEEE transactions on ultrasonics, ferroelectrics, and frequency control, vol. 40, no. 4, pp. 275­82, Jan. 1993. C. Simon, P. VanBaren, and E. Ebbini, "Two-dimensional temperature estimation using diagnostic ultrasound," IEEE Transactions on Ultrasonics, Ferroelectrics and Frequency Control, vol. 45, no. 4, pp. 1088­1099, Jan. 1998. I. A. Hein and W. R. O'Brien, "Current time-domain methods for assessing tissue motion by analysis from reflected ultrasound echoes-a review.," IEEE transactions on ultrasonics, ferroelectrics, and frequency control, vol. 40, no. 2, pp. 84­102, Jan. 1993. F. Viola and W. Walker, "A comparison of the performance of time-delay estimators in medical ultrasound," IEEE Transactions on Ultrasonics, Ferroelectrics and Frequency Control, vol. 50, no. 4, pp. 392­401, Apr. 2003. G. Pinton and G. Trahey, "Continuous delay estimation with polynomial splines," IEEE Transactions on Ultrasonics, Ferroelectrics and Frequency Control, vol. 53, no. 11, pp. 2026­2035, 2006. F. Viola and W. Walker, "A comparison between spline-based and phase-domain timedelay estimators," IEEE Transactions on Ultrasonics, Ferroelectrics and Frequency Control, vol. 53, no. 3, pp. 515­7, Mar. 2006. W. Walker and G. Trahey, "A fundamental limit on delay estimation using partially correlated speckle signals," IEEE Transactions on Ultrasonics, Ferroelectrics and Frequency Control, vol. 42, no. 2, pp. 301­308, 1995. J. Luo and E. Konofagou, "A fast normalized cross-correlation calculation method for motion estimation," IEEE Transactions on Ultrasonics, Ferroelectrics and Frequency Control, vol. 57, no. 6, pp. 1347­1357, Jun. 2010. R. Zahiri-Azar and S. Salcudean, "Time-delay estimation in ultrasound echo signals using individual sample tracking," IEEE Transactions on Ultrasonics, Ferroelectrics and Frequency Control, vol. 55, no. 12, pp. 2640­2650, Dec. 2008. B. H. Friemel, L. N. Bohs, and G. E. Trahey, "Relative performance of two-dimensional speckle-tracking techniques: normalized correlation, non-normalized correlation and sumabsolute-difference," 1995 IEEE Ultrasonics Symposium. Proceedings. An International Symposium, pp. 1481­1484, 1995. R. Zahiri-azar and S. E. Salcudean, "Motion Estimation in Ultrasound Images Using Time Domain Cross Correlation with Prior Estimates," IEEE transactions on Biomedical Engineering, vol. 53, no. 10, pp. 1990­2000, 2006.

[18]

[19]

[20]

[21]

[22]

[23]

[24]

[25]

[26]

[27]

[28]

48

[29] [30] [31]

Y. Zhu and T. J. Hall, "A Modified Block Matching Method for Real-Time Freehand Strain Imaging," Ultrasonic Imaging, vol. 24, no. 3, pp. 161­176, Jul. 2002. I. Cespedes, Y. Huang, J. Ophir, and S. Spratt, "Methods for estimation of subsample time delays of digitized echo signals.," Ultrasonic Imaging, vol. 17, no. 2, p. 142, Apr. 1995. P. De Jong, T. Arts, A. Hoeks, and R. Reneman, "Determination of tissue motion velocity by correlation interpolation of pulsed ultrasonic echo signals," Ultrasonic imaging, vol. 12, no. 2, pp. 84­98, Apr. 1990. X. Lai and H. Torp, "Interpolation methods for time-delay estimation using crosscorrelation method for blood velocity measurement," IEEE transactions on ultrasonics, ferroelectrics, and frequency control, vol. 46, no. 2, pp. 277­90, Jan. 1999. S. G. Foster, P. Embree, and W. O'Brien Jr, "Flow velocity profile via time-domain correlation: error analysis and computer simulation," Ultrasonics, Ferroelectrics and Frequency Control, IEEE Transactions on, vol. 37, no. 3, pp. 164­175, 1990. B. Gelman, L. Bohs, M. Czenszak, M. Anderson, and G. Trahey, "Initial experimental results using ensemble tracking for 2D vector velocity measurement," 1996 IEEE Ultrasonics Symposium, vol. 2, pp. 1241­1244, 1996. L. N. Bohs, B. J. Geiman, M. E. Anderson, S. M. Breit, and G. E. Trahey, "Ensemble tracking for 2D vector velocity measurement: Experimental and initial clinical results.," IEEE transactions on ultrasonics, ferroelectrics, and frequency control, vol. 45, no. 4, pp. 912­24, Jan. 1998. B. Geiman, L. Bohs, M. Anderson, S. Breit, and G. Trahey, "A comparison of algorithms for tracking sub-pixel speckle motion," in 1997 IEEE Ultrasonics Symposium, 1997, vol. 2, no. x, pp. 1239­1242. J. A. Jensen, "Field: A program for simulating ultrasound systems," Paper presented at the 10th Nordic-Baltic Conference on Biomedical Imaging Published in Medical & Biological Engineering & Computing, vol. 34, no. 1, pp. 351­353, 1996. J. A. Jensen and N. B. Svendsen, "Calculation of pressure fields from arbitrarily shaped, apodized, and excited ultrasound transducers," IEEE Transactions on Ultrasonics Ferroelectrics and Frequency Control, vol. 39, no. 2, pp. 262­267, 1992. J. A. Jensen and P. Munk, "Computer phantoms for simulating ultrasound B-mode and cfm images," Acoustical Imaging, vol. 23, pp. 75­80, 1997. A. Savitzky and M. J. E. Golay, "Smoothing and differentiation of data by simplified least squares procedures.," Analytical chemistry, vol. 36, no. 8, pp. 1627­1639, 1964. J. Luo, K. Ying, P. He, and J. Bai, "Properties of Savitzky­Golay digital differentiators," Digital Signal Processing, vol. 15, no. 2, pp. 122­136, Mar. 2005.

[32]

[33]

[34]

[35]

[36]

[37]

[38]

[39] [40] [41]

49

[42]

J. Luo, J. Bai, P. He, and K. Ying, "Axial strain calculation using a low-pass digital differentiator in ultrasound elastography," IEEE Transactions on Ultrasonics, Ferroelectrics and Frequency Control, vol. 51, no. 9, pp. 1119­27, Sep. 2004. J. Ophir and I. Cespedes, "Reduction of Image Noise in Elastography," Ultrasonic, vol. 15, pp. 89­102, 1993. M. Bilgen, "Target detectability in acoustic elastography," IEEE Transactions on Ultrasonics, Ferroelectrics and Frequency Control, vol. 46, no. 5, pp. 1128­33, Jan. 1999. T. Varghese, E. Konofagou, J. Ophir, S. Alam, and M. Bilgen, "Direct strain estimation in elastography using spectral cross-correlation," Ultrasound in medicine & biology, vol. 26, no. 9, pp. 1525­1537, 2000. H. Ponnekanti, J. Ophir, and I. Cespedes, "Ultrasonic imaging of the stress distribution in elastic media due to an external compressor," Ultrasound in medicine & biology, vol. 20, no. 1, pp. 27­33, 1994.

[43] [44] [45]

[46]

50

Chapter 3
Conclusions and Suggestions for Further Work
3.1 SUMMARY

The performance of the proposed algorithm was evaluated using statistical analysis and image quality analysis. The proposed algorithm was compared with NCC and SSD. The effects of interpolation of data and/or cosine curve fitting (in the case of NCC and SSD) were also considered. Statistical analysis was carried out by analysing the performance of all considered algorithms in terms of bias, standard deviation, and standard deviation of the jitter errors as a function of subsample delay, SNR, and kernel window length. Image quality analysis was performed by assessing the SNRe and CNRe of strain images in simulated and experimental ultrasound elastography. In addition, a novel normalization method was applied to enhance target detectability in ultrasound elastography.

3.2

CONCLUSIONS

The statistical analysis results indicate that without interpolation of the data prior to computing the time-delay estimates the proposed algorithm, NCC and SSD overall had about the same standard deviation, bias, and standard deviation of the jitter errors as a

51

function of sub-sample delay, SNR and standard deviation of the jitter errors. As expected, interpolation and/or cosine curve fitting (in the case of NCC and SSD) decreased the standard deviation, bias, and standard deviation of the jitter errors as a function sub-sample delay, SNR, and window length of all considered methods. The proposed algorithm with interpolation of the data, NCC with cosine curve fitting, NCC with interpolation of the data and cosine curve fitting, SSD with interpolation of the data and cosine curve fitting had about the same and the lowest standard deviation, bias, and standard deviation of the jitter errors as function of sub-sample delay, SNR, and window length. Moreover, NCC benefits more from cosine curve fitting than from interpolation of the data and on contrary SSD benefits more from interpolation of the data than from cosine curve fitting. When the quality of the strain maps was examined, without interpolation of the data, the proposed algorithm had higher SNRe and CNRe compared to NCC and SSD however it had lower SNRe and CNRe compared to NCC and SSD with cosine curve fittings. The proposed algorithm with interpolation of the data had the highest SNRe and CNRe. NCC with cosine curve fitting and/or interpolation of the data, SSD with interpolation of the data, and SSD with interpolation of the data and cosine curve fitting had about the same SNRe and CNRe. Consequently, to produce strain maps with high SNRe and CNRe either the data must be interpolated prior to estimating the time-delays or the pattern-matching function must be fitted to a cosine curve. In addition, strain map normalization enhanced target visualization by compensating for strain decay with depth although it did not affect the SNRe and CNRe of the strain maps. Therefore, with interpolation of the data, the proposed algorithm marginally improved the quality of the strain maps in terms of SNRe and CNRe.

52

3.3

SUGGESTION FOR FURTHER WORK

The computational efficiency of each algorithm has not been studied in more details in this thesis. A possible future work can be to compare the computational efficiency of each algorithm in a realistic situation. In addition, the proposed algorithm was not implemented with some type of curve fitting. If the proposed algorithm is implemented with curve fitting then its performance in terms of computational efficiency and accuracy could increase. Thus, as another future work, it is sugguested to implement the proposed algorithm with curve fitting.

53

Appendix A
Performance Evaluation of Various Time-Delay Estimation Algorithm in Simulated Elastography Phantoms

A simple 3D phantom for strain elastography was simulated using Field II ultrasound simulation software. The phantom was constructed from a uniform distribution of point scatterers within a volume in which the scatterers strength was set by a Gaussian distribution. The phantom exhibited uniform echogenicity. The phantom consisted of hard cylindrical inclusions of three different sizes and located at three different axial depths. Two 65 mm × 60 mm × 10 mm phantom were modeled, where each one contained nine hard inclusions. The first phantom contained inclusions with diameter of 2 mm, 3 mm and 5 mm at the depth of 10 mm, 30 mm and 50 mm, as shown in Figure A.1(a). The second phantom contained inclusions with diameter of 4 mm, 6 mm and 8 mm at the depth of 10 mm, 30 mm and 50 mm, as shown in Figure A.1(b).

54

Figure A.1: (a) First phantom which contained cylindrical inclusions of 2 mm, 3 mm, and 5 mm diameter at 10 mm, 30 mm, and 50 mm axial distances. (b) Second phantom which contained cylindrical inclusions of 4 mm, 6 mm, and 8 mm diameter at 10 mm, 30 mm, and 50 mm axial distances.

In order to simulated strain elastography, two RF frames were simulated from the scatterers distribution using Field II with the assigned parameters as shown in Table A.1. First, a RF frame was simulated, which refers to pre-compression frame, from the scatterers distribution. Then, the scatterers were displaced in such a way as if they were compressed from the top surface downward by the transducer, as shown in Figure A.2. In order to simulated tissue phantoms with hard inclusions, the scatterers inside the inclusions were subjected to less strain compared to the background, when a uniaxial plane compressional force was applied. When a compressional force is applied hard inclusions experience less strain compare to the background. The phantom was compressed by 0.5% (equivalent to 0.32 mm at the utmost axial depth) whereas the inclusions were compressed by 1/3. In this study, we have assumed that all scatterers move only in the axial direction when they experience a compressional force from the axial direction. In reality scatterers are free to move in lateral and elevation directions as well when a compressional force is

55

applied from axial direction. However in this study, since all the time-delay estimation algorithms are implemented in 1D and they can only estimate time-delays in axial direction, this assumption seems reasonable. The compressed scatterers were then used to simulate another RF frame, which refers to post-compression frame. The displacement of scatterers from the transducer's point of view appears as if the top surface, where the transducer is mounted, is fixed and the bottom surface is compressed toward the top, as shown in Figure A.2.
PARAMETER Transducer type Element height Element weight Inter-element spacing Transmit focus Receive focus Apodization Dimension of the tissue phantom Number of scatterers Density of scatterers Sampling frequency Transmit centre frequency Speed of Sound Attenuation coefficient Number of A-lines per frame VALUE Linear Array with 256 elements and 64 active elements 5 mm 1 wavelength (equivalent to 0.15 mm) 0.05 mm 30 mm 10 mm, 30 mm, and 50 mm Hanning 65 mm × 60 mm ×10 mm (axial, lateral, elevation) 390,000 scatterers 10 scatterers/mm3 100 MHz 5 MHz 1510 m/s 0.75 dB/(cm MHz) 128

Table A.1: Parameters and their assigned values used in Field II ultrasound simulation software for construction of a computer simulated tissue phantom for strain elastography.

56

Probe

Probe

Figure A.2: Only 500 scatterers out of a total of 390,000 scatterers are shown in both of these subfigure for better illustration. (a) Illustration of the scatterers distribution used by Field II to generate RF frame at precompression state. (b) Illustration of the displaced scatterers distribution, simulating a compressional force being applied by the transducer, used by Field II to generate RF frame at post-compressional state.

Each A-line in the pre-compression and post-compression frames were segmented into windows of 8 wavelengths (equivalent to 1.2 mm or 160 samples) with 75 % overlapping between two consecutive windows. A pattern-matching function was calculated between each pre-compression and post-compression windows to find the timedelay estimates between them. The strain map was generated from the gradient of the timedelay estimates, using 1D Savistky-Golay digital differentiator with filter length of 9 samples, polynomial fitting of second order, and differentiation of first order. In addition, the strain maps were filtered using 5×5 median and mean filters. The performance of the proposed new algorithm (with and without interpolation of the data) relative to NCC and SSD algorithms (with and without cosine curve fitting and interpolation of the data) was also evaluated in ultrasound strain elastography imaging using simulated data generated by Field II. The parameters used to compare their relative

57

performance were target detectability (i.e., visual appearance of a target in an image), SNR e and CNR e . The pre-compression and post-compression B-mode frames of the first and second phantoms are shown in Figure A.3 and Figure A.4, respectively. The B-mode frames have uniform echogenicity, except for the effects of attenuation. A pre-compression and a postcompression RF signals are shown in Figure A.5(a)-(b), as an example. Time-delay estimation between the pre-compression and post-compression frames was computed Aline by A-line using the proposed algorithm, NCC, NCC with cosine curve fitting, SSD, and SSD with cosine curve fitting. The effect of interpolation was also considered by interpolating the pre-compression and post-compression frames by a factor of 10 (equivalent to sampling frequency of 1000 MHz). The window length was set to 8 wavelengths (equivalent to 1.21 mm) with 75% window overlap. Figure A.5(b)-(c) shows an example of time-delay estimation between two RF signals and the corresponding strain estimation. The strain maps, which were computed from the gradient of time-delay estimates, are shown in Figure A.6 and Figure A.7. The actual size and position of each inclusion is shown in Figure A.1.

58

Figure A.3: B-mode images of the first phantom. (a) Pre-compression state. (b) Post-compression state.

Figure A.4: B-mode images of the second phantom. (a) Pre-compression state. (b) Post-compression state.

59

Figure A.5: (a) Plot of a pre-compression and post-compression RF signals from the center (i.e., at 0 lateral distance) of the second simulated phantom. (b) A zoom in section of (a). (c) Plot of the corresponding timedelay estimates between the reference and delayed RF signals. (d) Plot of the corresponding strain. The boxes with dashed lines indicate the locations of the inclusions.

60

Figure A.6 depicts the strain maps of the first phantom, which contained inclusions with diameters of 2 mm, 3 mm, and 5 mm at axial depths of 10 mm, 30 mm, and 50 mm. All considered algorithms were able to visualize the 5 mm inclusions at all three axial depths. The 3 mm inclusions are barely visible at 10 mm and 30 mm axial depth but not at 50 mm depth, using all considered algorithms. None of the algorithms were able to visualize the 2 mm inclusions. Figure A.7 shows the strain maps of the second phantom, which contained inclusions with diameters of 4 mm, 6 mm, and 8 mm at axial depths of 10 mm, 30 mm, and 50 mm. All algorithms studied were able to visualize all the contained inclusions. Thus, strain elastography can potentially depict and detect inclusions with diameter of 4 mm or larger using any of the algorithms studies. In addition, inclusions of 3 mm diameter can be depicted only if they are superficial. The corresponding SNR e and CNR e values of the strain maps in Figure A.6 and Figure A.7 are tabulated in Table A.2. When the data was not interpolated, the proposed algorithm had higher SNR e and CNR e compared to NCC and SSD but lower SNR e and CNR e compared to NCC and SSD with cosine curve fittings. In general, the SNR e and CNR e of the strain maps were increased with interpolation of the data and/or cosine curve fitting (in the case of NCC and SSD). With interpolation of the data, the proposed algorithm generally had the highest SNR e and CNR e . Moreover, NCC with interpolation of the data and/or cosine curve fitting, SSD with interpolation of the data, and SSD with interpolation of the data and cosine curve fitting had about the same SNR e and CNR e . Thus, interpolation of the RF data and/or cosine curve fitting, in general, significantly improve the quality of the strain maps of all algorithms studied in terms of SNR e and CNR e .

61

Figure A.6: The strain maps of the first simulated phantom. Time-delay estimates were computed by all considered algorithms (using window length of 8 wavelengths with 75% window overlap). The corresponding strain was computed using the SGDD method (with filter length of 9 samples, polynomial fitting of second degree, and differentiation of first order). The strain maps were also filtered by a 5×5 median and mean filters.

62

Figure A.7: The strain maps of the second simulated phantom. Time-delay estimates were computed by all considered algorithms (using window length of 8 wavelengths with 75% window overlap). The corresponding strain was computed using the SGDD method (with filter length of 9 samples, polynomial fitting of second degree, and differentiation of first order). The strain maps were also filtered by a 5×5 median and mean filters.

63

First Simulated Phantom Algorithm NCC NCC w/ CosFit SSD SSD w/ CosFit Proposed Algorithm NCC w/ Int10 NCC w/ Int10 & CosFit SSD w/ Int10 SSD w/ Int10 & CosFit Proposed Algorithm w/ Int10 SNRe (dB) 19.13 21.88 19.13 25.33 19.42 25.68 24.72 25.65 24.78 26.84 CNRe (dB) 22.19 29.03 21.55 31.10 28.49 32.65 31.92 32.56 31.99 33.53

Second Simulated Phantom SNRe (dB) 2.62 27.75 2.62 14.48 8.72 28.70 28.04 28.74 27.79 27.94 CNRe (dB) 12.77 33.11 12.77 23.07 18.15 34.10 33.53 34.14 33.42 36.05

Table A.2: SNRe and CNRe of the first and second simulated phantoms. From each strain map, sample points (about 50 samples) were taken from the inclusions which was located at the center elastogram (axially and laterally), and from the background at the same axial depth to compute SNRe and CNRe.

64

Appendix B
A Study of Computational Efficiency of Various Time-Delay Estimation Algorithms

The computational efficiency of the proposed algorithm, NCC, SSD, NCC with cosine curve fiting, and SSD with cosine curve fitting was studied by taking into account the average processing time to generate a displacement map. Experimental data was acquired by scanning an ultrasound breast elastography tissue phantom (Model #059, CIRS Inc., Nortfolk, VA, USA) using Sonix RP imaging scanner (Ultrasonix Medical Corp., Richmond, BC, Canada) with a 128 element linear array transducer. The ultrasound scanner was set to 5 MHz transmit central frequency and 40 MHz sampling frequency. The transducer was held by hand while it is pressed in and out by small compressional force against the phantom's top surface. Concurrently, RF frames were stored for postprocessing and all post-processing calculations were done in MATLAB (MathWorks, Inc., Natick, MA, USA). The data was processed done on a PC workstation (equipped with an Intel Core i7-920 CPU running at 3.8 GHz, and 12 GB RAM). Only 10 frames were processed, out of 100 frames, and the average processing time to produce a displacement

65

map was recorded. The effect of interpolation of RF data before computing the time-delay estimates on processing time was also studies by interpolating the RF data by factor of 2, 5, and 10. Figure B.1 shows the results of average processing time of each algorithm. As expected, as the interpolation factor was increased the computational time increased, almost linearly. For example, the computation time of NCC without interpolation was about 8 s, with interpolation by a factor of 5 it increased to about 12 s, and with interpolation by a factor of 10 it increased to about 16.5 s. The computation time of NCC and SSD was about the same and cosine curve fitting did not affect the computation time. The computation times of the propose algorithm were the lowest. Even when comparing NCC and SSD without interpolation to the proposed algorithm with interpolation by a factor of 10, the computation time of the proposed algorithm was lower by about 2.5 s. Thus, the proposed algorithm was computationally more efficient compared to NCC and SSD. However, these results are not decisive because the proposed algorithm had smaller search range compared to NCC and SSD, and the proposed algorithm was not compared with computationally efficient versions of NCC and SSD, as reported in [1], [2], [3].

66

Figure B.1: The average processing time of each algorithm to produce a displacement map. 10 displacement maps were produced. The RF data was also interpolated by a factor of 2, 5 and 10. The transmit central frequency was 5 MHz, sampling frequency was 40 MHz, and window length was 20 wavelengths (4 s  3.1 mm) with 75% window overlap. The size of the RF frames was 2393×256 samples and the size of the displacement maps was 51×256 samples.

REFERENCES FOR APPENDIX B
[1] R. Zahiri-azar and S. E. Salcudean, "Motion Estimation in Ultrasound Images Using Time Domain Cross Correlation with Prior Estimates," IEEE transactions on Biomedical Engineering, vol. 53, no. 10, pp. 1990­2000, 2006. Y. Zhu and T. J. Hall, "A Modified Block Matching Method for Real-Time Freehand Strain Imaging," Ultrasonic Imaging, vol. 24, no. 3, pp. 161­176, Jul. 2002. J. Luo and E. Konofagou, "A fast normalized cross-correlation calculation method for motion estimation," IEEE Transactions on Ultrasonics, Ferroelectrics and Frequency Control, vol. 57, no. 6, pp. 1347­1357, Jun. 2010.

[2] [3]

67


