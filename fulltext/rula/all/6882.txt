THREE PHASE DIGITAL EARTH LEAKAGE DETECTION by Liaqat Ali Bachelor of Electrical Engineering University Of Engineering and Technology, Pakistan, 2004

A Master's Research Project presented to Ryerson University

in partial fulfillment of the requirements for the degree of Master Of Engineering in the program of Electrical and Computer Engineering

Toronto, Ontario, Canada, 2017 © Liaqat Ali 2017

Author's Declaration

I hereby declare that I am the sole author of this project. This is a true copy of the project, including any required final revisions. I authorize Ryerson University to lend this project to other institutions or individuals for the purpose of scholarly research. I further authorize Ryerson University to reproduce this project by photocopying or by other means, in total or in part, at the request of other institutions or individuals for the purpose of scholarly research.

I understand that my project may be made electronically available to the public.

ii

THREE PHASE DIGITAL EARTH LEAKAGE DETECTION Liaqat Ali Master Of Engineering, Electrical And Computer Engineering, Ryerson University, 2017

ABSTRACT
In any electrical system, protection is the most important requirement to secure both human lives and appliances from any damage. The THREE PHASE EARTH LEAKAGE DETECTION (TDELD), is a design which could be implemented in three phase electrical environment to provide protection to user as well as equipments against any earth leakage fault. Being a microcontroller based solution, it provides ease and luxury at the user end with the help of its auto reset and display features. This research will attempt to improve the existing ELCB design using PIC microcontroller to automatically switch back system to its normal mode when the TDELD tripped during any electric shock or temporary earth leakage while in permanent leakage fault, it provide input control to bring back the system to its normal operation. The results of this research after doing several tests have shown that the average sensitivity value for TDELD against leakage current is better than what could be found in a conventional ELCB.

Keywords: TDELD,MCU, ELCB, ACS, THREE PHASE, AC.

iii

ACKNOWLEDGEMENT

I would like to thank Professor Kaamran Raahemifar for guiding me in understanding the concepts of my project. I would like to thank all my teachers especially my supervisor for guiding me in solving problems related to my Project. My project supervisor Professor Kaamran Raahemifar cooperation and support has brought this project to completion.

I would also like to thank my family and friends for their continuous encouragement and moral support.

iv

Table of Contents AUTHOR'S DECLARATION ............................................................................................... ii ABSTRACT ............................................................................................................................ viii ACKNOWLEDGMENT ......................................................................................................... ix LIST OF TABLES ................................................................................................................. viii LIST OF FIGURES ................................................................................................................. ix LIST OF ABBREVIATIONS ................................................................................................. xi CHAPTER 1 .............................................................................................................................. 1 INTRODUCTION..................................................................................................................... 1 1.1 PROJECT BACKGROUND ............................................................................................. 1 1.2 OBJECTIVES .................................................................................................................... 1 1.3 SCOPE OF PROJECT ....................................................................................................... 2 1.4 PROBLEM STATEMENT................................................................................................ 2 1.5 PROJECT OUTLINE ........................................................................................................ 3 CHAPTER 2 ............................................................................................................................. 4 LITERATURE REVIEW ........................................................................................................ 4 2.1 INTRODUCTION ........................................................................................................... 4 2.2 EARTH LEAKAGE CIRCUIT BREAKER (ELCB) .................................................. 5 2.2.1 VOLTAGE EARTH LEAKAGE CIRCUIT BREAKER (VELCB) ......................... 7 2.2.2 CURRENT EARTH LEAKGE CIRCUIT BREAKER(IELCB) ............................... 7

v

2.3 OPERATION OF ELCB TRIP SITUATION............................................................... 8 2.3.1 PERMANENT FAILURE.......................................................................................... 8 2.3.2 TEMPORARY FAILURE ......................................................................................... 8 2.4 ELECTRICAL FAULTS ................................................................................................ 8 2.4.1 OVER-CURRENT FAULT ........................................................................................ 9 2.4.2 SHORT-CIRCUIT FAULT......................................................................................... 9 2.4.3 LIGHTNING FAULT ............................................................................................... 10 2.5 ELCB FEATURES ........................................................................................................ 10 2.6 ELCB DESIGN .............................................................................................................. 11 2.7 BASIC CONCEPT OF ELCB ...................................................................................... 14 2.8 OPERATION OF ELCB............................................................................................... 14 CHAPTER 3 ............................................................................................................................ 18 METHODOLOGY ................................................................................................................. 18 3.1 OVERVEIW.................................................................................................................. 18 3.2 BLOCK DIAGRAM ...................................................................................................... 18 3.3 SCHEMATIC DESIGNING ......................................................................................... 19 3.3.1 PIC16F877A ............................................................................................................. 19 3.3.2 16X2 LCD ................................................................................................................. 21 3.3.3 3.3.4 3.3.5 ACS712-30A CURRENT SENSOR .................................................................. 21 SWITCH MODE POWER SUPPLY ................................................................. 23 PROTEUS .......................................................................................................... 24

vi

3.3.6 3.4 3.4.1 3.4.2

FUNCTIONAL SCHEMATIC DESIGN........................................................... 24 SOFTWARE DEVELOPMENT ........................................................................ 34 MIKROC PRO FOR PIC ................................................................................... 34 SOFTWARE FLOWCHART ............................................................................ 34

CHAPTER 4 ............................................................................................................................ 37 RESULT AND ANALYSIS .................................................................................................... 37 4.1 4.2 4.2.1 4.2.2 4.2.3 4.2.4 4.3 CODE COMPILATION TEST .......................................................................... 37 SIMULATION RESULTS .................................................................................. 38 ACS712 OUTPUT TEST .................................................................................. 38 NORMAL CONDITION TEST ......................................................................... 39 FAULT CONDITION TEST ............................................................................. 40 MANUAL RESET TEST .................................................................................. 43 ANALYSIS ........................................................................................................... 44

CHAPTER 5 ............................................................................................................................ 45 CONCLUSION ....................................................................................................................... 45 APPENDIX .............................................................................................................................. 48 REFERENCES ........................................................................................................................ 54

vii

LIST OF TABLES

2.1

Previous report

16

3.1

Ports configuration

20

3.2

Device voltage usage

23

viii

LIST OF FIGURES

2.1 2.2 2.3 2.4 2.5 2.6 2.7 3.1 3.2 3.3 3.4 3.5 3.6 3.7 3.8 3.9 3.10 3.11 4.1

TT Network Home ELCB/RCCB With Housing The System Inside ELCB Earth Leakage Circuit Breaker Design Earth Leakage Circuit Breaker Design Schematic Operation of ZCT Earth Leakage Circuit Breaker Operation Flow Block diagram PIC16F877A 16X2 LCD ACS712-30AMP 12V 1amp Power adapter Power supply unit Leakage detection unit ACS output voltage Control unit Input/output unit Flowchart mikroC pro for PIC HEX file generation

6 10 11 10 12 13 15 19 20 21 23 23 25 27 27 30 32 36 37

ix

4.2 4.3 4.4 4.5 4.6 4.7

ACS712 output Normal condition Fault condition Temporary fault condition Permanent fault condition Manual reset operation

39 40 41 42 43 44

x

LIST OF ABBREVIATIONS

MCU PIC

Microcontroller unit Programmable Integrated Circuit

AC ELCB TDELD RCD VELCB IELCB ACS LED NO NC

Alternating current Earth Leakage Circuit Breaker Three Phase Digital Earth Leakage Detection Residential Current Device Voltage Earth Leakage Circuit Breaker Current Earth Leakage Circuit Breaker Allegro Current sensor Light Emitting Diode Normally Open Normally Close

xi

CHAPTER 1

INTRODUCTION

1.1 PROJECT BACKGROUND
This paper is focused on the design and building a unit of Three Phase Digital Earth Leakage Detection (TDELD) system. Nowadays Earth leakage/fault detection system is manually controlled by mechanical switch and has a limited function which cannot distinguish and notify either permanent or temporary fault that occurred. The main focus for this project is to detect fault/earth leakage in a three phase four wire system and prevent all the critical equipment from being breakdown. This new TDELD is not limited just to auto switching, but it also can differentiate and display the type of fault so that the user is aware of the situation.

There are two types of fault normally detected by TDELD, which are permanent fault and temporary fault. Permanent fault is type of fault that is occurred because of any permanent earth leakage; meanwhile temporary fault is type of fault that occurred from an electric shock or any short time earth leakage. The concept is that if fault occurs then after waiting for 5 second, the TDELD will automatically switch back the power to normal condition to look for a fault, if its exists, TDELD will consider it as permanent fault and bring the system to idle mode while in the case of no fault, TDELD will go back and resume the normal mode of operation. In this project the PIC microcontroller has been chosen as a control. 1.2 OBJECTIVES

The objectives of this project are:

i.

To investigate the characterization of a TDELD with automatic triggering and resting feature due to a fault. The system will trigger by both the temporary and permanent fault but will reset only if fault is temporary.

ii.

To achieve the automatic tripping feature in three phases four wire system.

1

iii.

To make system more sensitive to the fault

iv.

To provide more speed to fault detecting mechanism

1.3 SCOPE OF PROJECT

i.

TDELD system is for three phases four wire system.

ii.

The range for voltage that will cover for this project is limited only 110 to 120V phase voltage that will be coming from suppliers.

iii.

This project uses an advance allegro current sensors ACS712-30A which is only limited to 30 amps for each phase. .

1.4 PROBLEM STATEMENTS Conventional Earth Leakage Detection system provides automatic protection when a fault occurs where it disconnects the power from a system. But the problem may arrive where if temporary fault occurs, ELCB cuts the power from the load, but there are one or more equipments which demands to be operated all the time and no human is present at this moment so system cannot be restored because resetting of ELCB requires physical access to mechanically operate the switch. Fault detection Time for any ELCB becomes more critical when a fault appears to be an electric shock. But since the fault detection of ELCB works on a mechanical movement of internal components, speed at which it detects fault get low.

Sensitivity of fault detection, also play a huge role in case of dangerous faults like electric shock. But as ELCB uses components by which detection process is carried out mechanically. It doe sn't provide high sensitivity which makes it more venerable.

2

1.5 PROJECT OUTLINE This thesis is structured in seven main chapters. The contents of each chapter are Summarized as below:

Chapter 1 consists of the introduction, project statement, objectives, the scope of project, overview of the project and summary of the content of thesis. Chapter 2 describes the literature review on ELCB, VELCB, IELCB, electric fault and its types and some literature reviews of related works. Chapter 3 explains methodology of project. It discusses what type of operations is carried out in this project. Block diagram, fully functional schematic design and software flowchart are discussed in this chapter. Chapter 4 presents the results and Analysis which discusses the step by step testing method to keep the project working.

Chapter 5 summarizes and concludes the outcome of this project.

3

CHAPTER 2 LITERATURE REVIEW

2.1 INTRODUCTION
The operation of ELCB systems occurs by gauging the current balance between the outgoing and incoming currents by the use of "Allegro current sensor." This system has the capacity to identify and indicate errors in case of any variation in the current between the neutral conductor and line conductor. Both the supply current and return current are expected to total to zero, if not the current may be leaking to somewhere else (to ground/earth, or additional circuit, etc.). the system of ELCB has been designed to avoid electrocution through the detection of any leaking current, capable of being far lesser (normally 5 to 30 mill amperes) that the currents required in the operation of conventional fuses or circuit breakers (several amperes). Residential Current Device (RCDs) are expected to function within 25-40 milliseconds, prior having the heart driven by the electric shock into ventricular fibrillation, which remains the leading cause of death via electric shock. Considering Canadian case, the national electric code necessitates ground fault circuit interrupter (GFCI) devices whose purpose is to guard people from interrupting the circuit in case a current range of 4-6 mA is exceeded by the leakage current (the trip setting is normally 5 milliamps) within 25 milliseconds. The ELCB gadgets guarding the equipment (not people) have a maximum tripping range of up to 30 milliamps of current. In most cases, the European region uses RCD with trip currents ranging between 10 and 3000 milliamps [2]. Over-current detection is corresponding to residual current detection. Residual current detection fails to offer protection for short-circuit or overload currents. ELCB with 500milliamps trip currents are at times installed in environments (like computing centers) with

4

minimal threshold containing an undesirable danger of accidental trips. Such high-current ELCB highly function as extra fire-safety protectors than facilitators of efficient shield against the dangers of electric shocks [2]. For several years, both the differential currentand voltage-operated ELCB and were both regarded as ELCB since it was a simpler word to remember. Nonetheless, using a common phrase for two different gadgets was associated with substantial confusion in the electrical sector. Use of the incorrect type during installation would considerably limit the protection level than the anticipated. To eliminate this perplexity, IEC considered the use of RCD (Residual Current Device) phrase for differential current operated ELCB. Residual current entails any current exceeding the load current [2].

2.2 EARTH LEAKAGE CIRCUIT BREAKER (ELCB)
An ELCB (Earth Leakage Circuit Breaker) is a gadget considered in the direct detection of earth current leakage from an installation and therefore having the power cut. Its key use was in TT earthing systems. In such systems, a local connection that is not dependent on any earth connection at the generator offers the consumer with protective earth connection [3]. The main benefit associated with TT earthing system is its capacity to suppress low and high frequency noises associated with the neutral wire from a range of neutral electrical devices attached to it. This is the reason why TT has every time been considered for special uses such as telecommunication portals that gain from interference-free earthing. Nonetheless, TT is not associated with the danger of a broken neutral. For the regions where distribution of power is overhead and done using TT, there is no risk facing the installation earth conductors in case of any fracturing of any of the overhead distribution conductor by a tree or its branch, for instance [3].

5

Figure 2.1: TT Network

During the pre-RCD period, the earthing system was less attractive for overall application due to its inferior capacity to accept high currents in the event of a live-to-PE short-circuit (compared to the TN techniques). Since the residual current gadgets may suppress this demerit, then the TT earthing approach remains excellent for premises with AC power circuits being RCD-shielded [3]. ELCB has turn out to be one of the home protection systems within our life at present. ELCB has a reset button which is to reclose circuit breaker while the tripping happens. Nowadays, a lot of people are occupied with work and normally not at home. The issue is that throughout the short circuit, over current or current leakage at live conductor, it may trip the circuit breaker "OFF" and discontinue the whole house supply of power. This condition can cause specific vital component or equipment not to be operated. The majority household ELCB must be manually reclosed during tripping. As a result, it is a difficult thing for user who is not at home and might take extensive time to reset the button at circuit breaker. The major mechanism within the operation is tripping coil whose operation can either be live or off condition. This ELCB will function when current is surpassing the rating of the current ELCB. This elevated current does not flow into equipment following the tripping of ELCB. It will directly flow into ground by employing ground rod. This ground rod should have lesser resistance because it is easy to flow high current. Two kinds of ELCB exist which comprise [5]:-

6

i. ii.

Voltage Earth Leakage Circuit Breaker (VELCB) ii. Current Earth Leakage Circuit Breaker (IELCB)

2.2.1 VOLTAGE EARTH LEAKAGE CIRCUIT BREAKER (VELCB) As a current-ran circuit breaker, VELCB gadget will operate when the current penetrates via the ELCB. VELCB has relay loop that is linked to the metallic load body at one end and at the other end it is linked to ground wire. If the load body's' voltage is increased which could lead to the dissimilarity between earth and load body voltage, the threat of electric shock will take place. This current dissimilarity will generate an electric current from the load metallic body that goes through the relay loop and to earth. Once electrical energy on the load metallic body is increased to the threat level which surpasses 50Volt, the flowing voltage through relay loop might shift the relay contact through disconnecting the supply current to prevent any risk electric shock [5].

2.2.2 CURRENT EARTH LEKAGE CIRCUIT BREAKER (IELCB)

IELCB is current ran circuit breaker. Generally, current-operated ELCBs are presently recognized as RCD (residual current device). Moreover, this guard against earth leakage even though the details and technique of operation are diverse. The gadget will operate once the Current goes through ELCB. This current divulged to current transform gadget and on the load. Current from the load as well admitted once more to transform device. Within normal situation, total current used on the load is equivalent to the total current out of the load. As a result of the balance of in and out of current, it does not influence the current transform tool. If there is any earth current leakage resulting from earth damage, then the in and out current will no more be in balance. This unbalance current occurrence will produce the current and if the current surpass the rate prescribed, the ELCB will jerk and discontinue the supply. The device is as well known as RCD, Residual Current Device within IEC or RCCB, Residual Current Circuit Breaker [5].

7

2.3 OPERATION OF ELCB TRIP SITUATION
Two kinds of fault are usually identified by ELCB that include temporary fault and permanent fault:
2.3.1 PERMANENT FAILURE

Normally, it trip when there is any leakage current from circuit to ground or earth. For permanent failure, the damage should be repaired foremost or get rid of it from the current before automatically trigger back ELCB. If the damage not to repair or eradicate the damage from circuit, If not so, it will trip once more once the ELCB turn out to be automatically triggered. If this occurs numerous times, it will destroy the ELCB. An example is electrical, electronic appliance or short circuit [6].

2.3.2 TEMPORARY FAILURE

This is able to have the ELCB triggered devoid of having repair initially or do away with the supply circuit damage. In case of the occurrence of overloading and lighting in industrial or residential premises, it can generate additional problems to the user by automatically triggering itself. Lighting is one perfect illustration of this problem [6].

2.4 ELECTRICAL FAULTS
Any abnormal condition within an electrical connection whereby the electrical current flows or fails to flow via the intended areas is known as a fault. The failure by devices equally leads to some circuit faults, such as insulation failure, loose connection, or short circuit among others. An ELCB is able to detect the following forms of faults within a distribution network [7] i. Over-Current Fault

ii. Short-Circuit Fault

iii. Lightning Fault

8

2.4.1 OVER-CURRENT FAULT

Over-current, according to the National Electrical Code, is as any current above the rated current of device or the amp city of a conductor. It might stem from short circuit, overload, or ground fault. Current flow within a conductor at all times produces heat. The higher the current flow the hotter the conductor. Surplus heat is destructive to electrical elements. As a result, conductors contain a rated constant current carrying capability or amp city. Devices of over-current protection are applied to guard conductors from unwarranted current flow. These devices for protection are devised to maintain the current flow within a circuit at a secure level to evade overheating of the circuit conductors. In conditions of over-current fault while a current greater compared to that which a circuit or a fuse is planned to transmit, the fuse or wire might melt or spoil the other circuit's elements [8].

2.4.2 SHORT-CIRCUIT FAULT

A short circuit within an electrical circuit is one that permits a current to move a long a dissimilar path from the one initially planned. The electrical reverse of short-circuiting is "open circuit" that is an endless resistance between two nodes. It is an anomalous low -resistance link between an electrical circuit's two nodes that are expected being at diverse currents. This brings about an unwarranted electric current (over-current) and possibly leads to circuit damage, fire, overheating, or explosion. Even though it is normally the fault outcome, there exist instances in which short-circuiting occurs deliberately, such as, for the intention of "crowbar circuit protectors" that sense voltage. Within circuit study, the term short -circuit has been employed by analogy to devise at a zero-impedance linking two nodes. This compels the two nodes to have matching electrical energy. Within a perfect short-circuit, the implication here is that there exists zero resistance hence no current decline a cross the short, simply circuit analysis wires are deemed to be shorts. For ideal circuits, the outcome is an approximately zero impedance connection, and nearly no resistance [8].

9

2.4.3 LIGHTNING FAULT

Lightning is the noticeable discharge of static electricity in a cloud, between the earth and a cloud, or between clouds. Scientists yet do not completely comprehend what the cause of lightning is, but the majority professionals consider that diverse types of ice interact within a cloud. Updraft within the clouds separate charges in order that positive charges flow to the top of the cloud and the negative charges flow towards the base of the cloud. Once the negative charges shifts downwards, a "stepped leader" is formed. The leader shifts toward the earth within 150 foot distinct steps, generating an ionized path within air. The main element of the lightning discharges current is contained within the return stroke that flows alongside the ionized path. One of the momentary faults is as a result of direct lightning occurrences. An instance of permanent fault is fault on electrical device [8].

2.5 ELCB FEATURES
Figure 2.2 demonstrate concerning Home ELCB with the housing, the purpose of this housing as the shield for the circuit. What can be observed from this state are simply the black box and a mechanical switch [9].

Figure 2.2: Home ELCB/RCCB With Housing Figure 2.3 demonstrates the entire ELCB component within the housing, the mainly vital thing within the system is the good insulator and should be employed for live and neutral cable so as to prevent the ELCB from self fault[9].
10

Figure 2.3: The System Inside ELCB

2.6 ELCB DESIGN

Figure 2.4: Earth Leakage Circuit Breaker design

Figure 2.4 illustrates the ELCB design. The design comprises Mechanical Switch, Black Box, ZCT, Rest Button and High Level Resistor. Mechanical switch is a contact of black box and the purpose of this component is to activate and stop the power by cutting off the neutral and life line in general. The purpose of high level resistor or test resistor is to experiment whether ELCB is operational or not by offering a short circuit within internal ELCB neutral and life. By offering a new current course throughout test condition (assuming

11

Kirchhoff current law), current flow through life wire is separated. The current within the neutral is below the current within the life wire once the reset button is pressed. The reset button's function is to re-set back the instrument to the original condition and as well as a spot to identify whether the instrument is still within good state or damage/expired. The black box's function is to induce a magnetic field and subsequently de-energize the magnetic coil within the black box [10].

Figure 2.5: Earth Leakage Circuit Breaker Design Schematic

From figure 2.5, the ELCB design schematic has been exemplified. The ZCT is responsible for detecting the unbalance current from neutral or live or grounded live polarities. The ELCB tripping ability depends on the ZCT sensitivity. A residential household will require a 0.1 A ECLB being in use, meaning that any unbalance current equal or more than 100 mA will make ZCT to induce current while de-energizing the black box's magnetic coil, and eventually disconnecting the mechanical switch [12]. From figure 2.6, ZCT operation

12

process has been illustrated. The ZCT operation is identical to a clamp meter considered in the identification of line current. Considering case 1, when the flow of current via live conductor is equal to that in neutral, there exists zero unbalance current detection in ZCT thereby meaning no induced current is generated by ZCT. Considering case 2, the presence of unbalanced current between neutral and live points will mean production of an induced current by the ZCT thereby sending it to magnetic coil and signal therefore making the ELCB to trip [12].

Since Iin = Iout, the induced current produced by the ZCT is zero

Since Iin = Iout, ZCT produces some induced current. An increased difference between the output and input currents leads to a high production of induced current. Figure 2.6: Operation of ZCT

13

2.7 BASIC CONCEPT OF ELCB

Basically, ELCB concept is that in case of fault occurrence, ZCT is able to sense this error and transmit the signal to the ELCB to have the load power disconnected from the load (tripped). This will be followed 10 seconds later by having the power connecting back, and in case the ELCB and the load remain connected would indicate a temporary fault such as lighting. In the meantime, if upon connecting back the ELCB to the load detects any error, it would have it switched back on. The cycle is then repeated thrice and in case the error is still detected, then ELBD isolates the power from the load and therefore displaying as permanent like over-current or short-circuit. Until when rectified by the user by manually switching it on, the ELCB remains in tripped state which helps in avoiding any form of electrical risk [13].

2.8 OPERATION OF ELCB
With reference to figure 2.7, in case of any fault, the detection of current L and N imbalance value is achieved using ZCT, thereby the induced current occurring in ZCT, induced current attaining the least value to activate the coil is sent to the black box as a signal, and upon activation of the coils it senses the trigger contact which triggers the mechanical switch automatically thereby disconnecting the supply from the mainline [14].

14

Figure 2.7: Earth Leakage Circuit Breaker Operation Flow

15

2.9

CONCLUSION FOR PREVIOUS REPORT
Table 2.1: Previous report DESCRIPTION By engaging the GSM modem,  Least-Bandwidth lag  Least-causes electronic interference During the main ELCB Use of main ELCB and tripped, the LCD will display that Main is tripped and back up is  Least-no backup supply on.  The other demerit of GSM is its capacity to interfere with a number of electronics like hearing aids and pace makers. Such an interference results from the verify that GSM utilizes a pulse-transmission method. Due to this, several locations like hospitals and airplanes need cell phones to turn them off.  In such Instance with no Back up supply becomes a problem to user during permanent fault condition. the user can obtain the circuit-breaker's situation alert at home. RESULT  May be the greatest demerit of GSM is the sharing of identical bandwidth by several users with ample users, the transmission may go through interference.

REFERENCE "Development of Earth Leakage Circuit Breaker to operate Automatic Reclosed Using PIC Microcontroller"

METHOD Use of the GSM Modem.

(Syahrum Nizam bin Md Arshad 2008)

backup ELCB

16

REFERENCE

METHOD Using the P Spice Software

DESCRIPTION Pspice is a spice analog circuit and digital logic

RESULT  Pspice allows the user to select specific components with industry standard part number and specifications.

Development of Earth Leakage Circuit breaker with an auto Re-closer unit. (Mohd Tarmizi Bin Rahim May, 2009)  Least-Pspice does not allow data visualization during simulation. Use of main ELCB and backup ELCB.  Least-no backup supply  Least-Pspice is a much more complex circuit simulator.

simulation program for Microsoft Windows.

During the main ELCB tripped, the LCD will display that Main is tripped and back up is on. Searching for these components can take up more of the user's time when constructing the circuit.  In this case with out the backup supply will be a problem to user while in permanent fault condition.

17

CHAPTER 3

METHODOLOGY 3.1 OVERVEIW In order to complete this project, development of the method and step is an important to make sure this project was successful without any problems. This chapter is based on the following major parts discussed in the following section. It deals with the actual design and construction of the project. Methodology is the process to find the suitable project, make the researching and study all of the project information, choose the suitable method for design this project, planning the time and selecting the equipment such as material is needed and computer software program. 3.2 BLOCK DIAGRAM
Figure 3.1 shows the block diagram for the three phase earth leakage detection system. Based on the block diagram, it shows the microcontroller PIC16F877A continuously collecting data from incoming and outgoing current sensors where each incoming and outgoing block represent three sub current sensors for each phase. Three phase supply source mentioned is in three phases, four wire configuration where each phase is given to separate loads with current sensors in series whose signals are given to MCU for current data collection. MCU after taking data from these sensors does comparative processing, find the fault if any and update the LCD about the current status of the system. Input control block connected to MCU has a function of manually clearing any permanent fault which will be discussed in detail in upcoming sections. Finally trip unit is responsible for cutting the load connection from the source if a trip command is received from MCU in case of any fault occurrence.

18

Figure 3.1: Block Diagram

3.3 SCHEMATIC DESIGNING
Schematic designing is a process of building a circuit in designing software which includes connecting components in such manner so that combined properties of connected components gives us desired result. Components that are used in schematic design are discussed below.

3.3.1 PIC16F877A

The brain for this system is the microcontroller. For this project, PIC16F877A manufactured by Microchip was selected as microcontroller. Figure 3.2 shows the microcontroller PIC16F877A. The microcontroller interfaced with current sensor gets the current data, indicates the fault if any imbalance in the currents is found. Table 3.1 shows the port connection for PIC16F877A. The programming of the microcontroller will be discussed in the following section of this chapter. PIC16F877A was selected as microcontroller in this project because:

19

i. ii. iii. iv. v.

33 I/O pins in which 8 can be used as analogue. Wide operating voltage which is from 2 to 5.5v On-change interrupts to be used for IR receiver decoding Internal EEPROM memory for permanent saving Provide more pin for future purpose

Figure 3.2: PIC16F877A

Table 3.1:Ports configuration

Port PORTA PORTB PORTC PORTD

Function Analogue voltage measurement Normalization input buttons Fault indicators LCD control

20

3.3.2 16X2 LCD

LCD (Liquid Crystal Display) screen shown in figure 3.3, is an electronic display module and find a wide range of applications. A 16x2 LCD display is very basic module and is very commonly used in various devices and circuits. These modules are preferred over seven segments and other multi segment LED. The reasons being: LCDs are economical; easily programmable; have no limitation of displaying special & even custom characters (unlike in seven segments), animations and so on. A 16x2 LCD means it can display 16 characters per line and there are 2 such lines. In this LCD each character is displayed in 5x7 pixel matrix. This LCD has two registers, namely, Command and Data. The command register stores the command instructions given to the LCD. A command is an instruction given to LCD to do a predefined task like initializing it, clearing its screen, setting the cursor position, controlling display etc. The data register stores the data to be displayed on the LCD. The data is the ASCII value of the character to be displayed on the LCD. Click to learn more about internal structure of a LCD.

Figure 3.3: 16X2 LCD

3.3.3

ACS712-30A CURRENT SENSOR

ACS712 showed in figure 3.4isFully Integrated, Hall Effect-Based Linear Current Sensor IC with 2.1 kVRMS Isolation and a Low-Resistance Current Conductor. It provides economical and

21

precise solutions for AC or DC current sensing in industrial, commercial and communications systems. The device consists of a precise, low-offset, linear Hall circuit with a copper conduction path located near the surface of the die. Applied current flowing through this copper conduction path generates a magnetic field which the Hall IC converts into a proportional voltage. Device accuracy is optimized through the close proximity of the magnetic signal to the Hall transducer. A precise, proportional voltage is provided by the low-offset, chopper-stabilized BiCMOS Hall IC, which is programmed for accuracy after packaging. The output of the device has a positive slope (>VIOUT (Q)) when an increasing current flows through the primary copper conduction path (from pins 1 and 2, to pins 3 and 4), which is the path used for current sampling. The internal resistance of this conductive path is 1.2 m typical, providing low power loss. The thickness of the copper conductor allows survival of the device at up to 5× over current conditions. The terminals of the conductive path are electrically isolated from the signal leads (pins 5 through 8). This allows the ACS712 to be used in applications requiring electrical isolation without the use of opto-isolators or other costly isolation techniques.

Main Features  Low-noise analog signal path  Device bandwidth is set via the new FILTER pin  5 s output rise time in response to step input current  80 kHz bandwidth  Total output error 1.5% at TA = 25°C  Small footprint, low-profile SOIC8 package  1.2 m internal conductor resistance  2.1 kVRMS minimum isolation voltage from pins 1-4 to pins 5-8  5.0 V, single supply operation  66 to 185 mV/A output sensitivity  Output voltage proportional to AC or DC currents  Factory-trimmed for accuracy  Extremely stable output offset voltage  nearly zero magnetic hysteresis  Ratio metric output from supply voltage

22

Figure 3.4: ACS712-30AMP

3.3.4 SWITCH MODE POWER SUPPLY

For this project, the power supply was feed from a single AC to DC 120VAC12VDCpower adapter. The PSU adapter in Figure 3.5 was selected because it meets the power Consumption requirement for the project having power of 1amps at 12v. It can support the Input from 100V to 240V and 50/60 Hz. A capacitor is used at the output of power supply to remove any noise if it comes.

Figure 3.5: 12V 1AMP POWER ADAPTER

Table 3.2: Device/System led PIC16F877A ACS712-20A 16x2 LCD Trip Unit i.e. Relay

Device voltage usage Voltage(V) 1.2 5 5 5 12

23

3.3.5 PROTEUS

Proteus ISIS is designing and simulation software which is used for various designs with electronics and microcontrollers. It has built-in libraries of almost all microcontrollers. It is a handy tool to test programs and embedded designs for electronics and electrical systems. After making a design and writing a source code for microcontroller, simulation is then possible to predict the behavior of system in a real world.
3.3.6 FUNCTIONAL SCHEMATIC DESIGN

Final design was made by connecting components mentioned above. First those components were chosen so that it meets our design requirement, after that they were connected in such manner to build a schematic design that gives me required result. For the sake of better understanding, schematic design is divided into four small units which are power supply, control, earth leakage detection and input/output units. By using this approach simple sub units have been derived from the main complex design. Different meaning Labels have been used to indicate the connection of component in one unit with the component in other. Each unit is discussed in detail below.

3.3.6.1 POWER SUPPLY UNIT
Power supply unit has further three basic components. As shown in figure 3.6, first component is a "Three phase four wire power source" which are power lines provided by a utility company. It has three different phases and one extra neutral wire which could be used in four wires configuration. In Canada voltage between any of two different phases which is called line voltage is normally 90v. Also voltage between any phases with respect to neutral which is called phase voltage is normally 120v. Three phases are further distributed and given to different load points which we will see in coming section and at the same time one phase and a neutral comes to "switch mode power supply" which is second component of power supply unit. Switch mode power supply or in short SMPS is a modern time technology which takes AC voltage as an input and converts it into DC voltage of a desired magnitude. In this case 12v 1amp have been chosen as supply to provide power to circuitry. As SMPS only generate 12vdc which is further needed in relays section, but majority of components used in a design operates on 5vdc so another converter is needed to convert this 12vdc into fix 5vdc so "7805 voltage regulator" which is third component of PSU unit is used for this purpose. Output of SMPS which is 12vdc is

24

given to the 7805 input section which then produce 5vdc on its output. Two bi-polar capacitors are used in the input/output terminals of regulators to neutralize any spike or noise.

Figure 3.6: Power supply unit

3.3.6.2 FAULT DETECTION UNIT This unit mainly consists of ACS current sensors, loads and fault contacts. As shown in figure 3.7, three phases are provided to each load but before that current sensors are installed in input and output series paths whose job is to find each phase current. Total of six current sensors are required because there is a need to find three incoming currents going into the loads and three outgoing currents coming out of the load through shared neutral wire. Fault contacts which are shown by switches are virtual representation of any fault so there connections are in parallel with each load.

25

ACS sensors are used for current sensing purpose because conventional sensing mechanism like shunt resistor lacks electrical isolation between sensing unit like microcontroller and load i.e. where neutral of AC line and ground of DC side are has to be shorted for its operation. Also in shunt based technique, response becomes non linear due to heating effect that results in changing the resistance value. The output of the ACS has positive slope when an increasing current flows through the copper conduction path (from pins 1 and 2, to pins 3 and 4). The ACS712-30 is chosen for this project that can measure current up to ±30A and provides output sensitivity of 66 mV/A (at +5V power supply), which means for every 1A increase in the current through the conduction terminals in positive direction, the output voltage also rises by 66 mV. At zero current, the output voltage is half of the supply voltage (Vcc/2). It is noted that the ACS712 provides ratio metric output, which means the zero current output and the device sensitivity are both proportional to the supply voltage, VCC. This feature is particularly useful when using the ACS712 with an analog-to-digital converter. The precision of any A/D conversion depends upon the stability of the reference voltage used in the ADC operation. In most microcontroller circuits, the reference voltage for A/D conversion is the supply voltage itself. So, if the supply voltage is not stable, the ADC measurements may not be precise and accurate. However, if the reference voltage of ADC is same as the supply voltage of ACS712, then the ratio metric output of ACS712 will compensate for any error in the A/D conversion due to the fluctuation in the reference voltage. In our case since current on input side of ACS is alternating current, output will also be varying analogue signal in the supply range from 0 to 5v oscillating through 2.5v (Vcc/2) as shown in the figure 3.8, where 2.5v in the output at any instance means zero current at the input which means that output voltage reflects the input AC current behavior. Now to find RMS value of input AC currents, its peak value has to find first but as we know peak value of AC current is in direct relation with peak value of output voltage signal of ACS so finding that will lead us to find the peak and hence RMS value of input AC current. For that purpose ACS outputs are given to the MCU analogue pins whose operation is discussed in the next section.

26

Figure 3.7: Leakage detection unit

Figure 3.8: ACS output voltage

27

3.3.6.3 CONTROL UNIT Control unit has a PIC16F877A microcontroller which is the most important part by providing intelligence to this project. It has 33 general purpose input output (GPIO) pins in which eight pins can be used as analogue. Some surrounding components are required to keep the MCU running in which the mandatory one is crystal oscillator which is mentioned by the name of "X1" in the below figure 3.9 whose terminals are connected to the 13 th and 14th pin of MCU. Its value indicates the speed by which the MCU will execute the instructions. Two 22pf capacitors are connected between the crystal and ground which resonates with the crystal inductance and cause the crystal to oscillate on its fundamental parallel-resonant mode. First pin of MCU is MCLR which is active low reset floating pin, if grounded, will reset the MCU. But if it is left unconnected, it would reset the MCU randomly so to pull this pin high, a Pull up resistor of value 10k is connected between Vcc and MCLR pin of MCU. Also a "Reset" button is connected between MCLR pin and ground and by pressing it down, MCLR pin will get connected with ground and will results in MCU reset therefore it allows user to manually reset the MCU if anything goes wrong. Different pins are used for input/output operation. Two types of input pins are used for our purpose which is analogue and digital.

Analogue pins provides interface between internal ADC module and external analogue signals. Main purpose od ADC module is to convert analogue signal to digital number which is further processed by MCU to find different parameters. As discussed in previous section, ACS produces analogue output signal but MCU can only understand digital numbers so for that purpose, outputs of ACS are given to the ADC section of MCU through PORTA pins then its job of ADC to convert that signal to digital number so that it becomes understandable for MCU.

Since ADC is 10 bit, resultant digital number will have a minimum value of 0 and maximum of 1023. 5v is selected as a reference for ADC which means that when the input is 0v, ADC output will be 0, 512 for 2.5v and 1023 for 5v. But the problem is that ADC input signal is not DC and is continuously varying with main AC current so we have to find its maximum value. First different instantaneous samples have to be taken for ADC inputs, which are digital numbers.

28

Now to convert these digital numbers back to the voltage values, the following equation would be used. V_5 = (digital_number * 5) / 1023 ..............(1)

In above equation, V_5 represents the actual voltage present on analogue pin of ADC which has to be found. Second parameter, digital number is the ADC converted digital value which we will get at the time ADC operation take place. Constant 5 is used in the equation because if the reference to the ADC is 5v and finally 1023 is in the equation because ADC is 10 bit which has maximum range of 1023. After V_5 (output of ACS) is found, Main AC current we can be easily found by the following equation. AC_CURRENT = V_5 /66 ..............(2)

Where AC_CURRENT in the above equation is the actual current in amps, V_5 is the output voltage of ACS found previously, and constant 66 having unit of mV/A is sensitivity of ACS in use. After six currents can be find by the same process discussed above, after that MCU will find any imbalance in each pair of incoming/outgoing current i.e. between (phase1_in, phase1_out), (phase2_in, phase2_out), (phase3_in, phase3_out) and if any difference between these pair is found, MCU will immediately turn on the concerned indicator and will update the LCD, mentioning the fault that occurs in a specific phase.

After detecting an earth leakage, led indicator for the faulty phase will turns on, indicating fault occurrence in that phase but at this point, fault is considered to be temporary so MCU will issue command LCD to show temporary fault in that specific phase. MCU will then wait for 5 seconds and after that will find if that specific fault still exist, if so then fault indicator will be turn on permanently and MCU will tell the LCD to show permanent fault in that specific phase. In case of no fault after 5 seconds, MCU will reset the whole system back to its normal mode, turn off that specific fault indicator and tells LCD to show fault normalized in that faulty phase.

Digital input pins comes into play if the fault detected is permanent and a user in some way managed to remove that fault manually, now the system needs to be brought back to its normal mode. For this purpose, digital inputs coming on 37th, 38th and 39th pin of MCU comes from

29

three different buttons that are used to restore the normal operation of system. Internal weak pullup resistors are used for these pins which means that pull up resistor one terminal is connected to the VCC and other terminal to that specific pin. Now as button second terminal is connected to ground, if button is not pressed yet then that specific MCU pin will remain high due to pull up resistor but by pressing it down, it will provide short circuit path between that specific MCU pin and ground. So after pressing a button, specific pin condition will change and MCU will clear that corresponding fault and bring the system to the normal operation mode. Outputs pins are used for two different operation, led control and LCD control. Pin 15 th, 16th and 17th of MCU are used for output operation. In normal mode, these pins will stay low, providing zero voltage in output hence the connected led will also stay off. But whenever some fault is

detected, these pins will get high and in result will turn on the specific led connected to it. Other output pins from 19th to 22nd and 27th to 28th are used to control the 16x2 LCD. Pin 19th and 20th are control pins in which Pin 19th is a register select pin used to select internal register of LCD for operation while pin 20th is enable pin used to enable or disable LCD. Other pins 21 st, 22nd, 27th and 28th are data pins and have the purpose to send data to LCD in four bit configuration mode.

Figure 3.9: Control unit

30

3.3.6.4 INPUT OUTPUT UNIT As discussed previously in control unit section, two different inputs and outputs types are used for the desired operation. Input unit contains analogue and digital inputs while output unit has led and LCD control output.

Analogue inputs were discussed in detail in previous section. As it can be seen in figure 3.10, input unit mainly consist of three buttons used for normalization operation of three different phases. If permanent fault occurs in any phase line, its respective button has to be pressed down in order to restore system to normal mode. These buttons are of non-latching type which means that as long as it is pressed down it will stay down but as soon as it is released, it will come back to its original position. One end of these buttons are connected to ground and other to MCU input pin so that if it is pressed, its two terminals gets shorted and the MCU pin will get low, so in this way MCU will find whether button is presses or not.

Output unit consist of LED and LCD. LED has got two terminals, anode and cathode where anode is positive and cathode is negative. Voltage of 1.2v is required across its terminals to keep it glowing i.e. ground to cathode and 1.2v to anode. So for that purpose one of its terminals is connected to ground and other to a terminal of 330ohm resistor. Purpose of resistor here is to limit the current to led, without using it, led will burn off and also only giving 1.2v to LED by keeping the remaining voltage across its own terminal since voltage coming from MCU is 5v. Current requirement to turn on LED is normally 20 milliamps.

LCD is another output unit which function is to show the current status of system. 16x2 LCD is used for that purpose which means that it has 2 rows and 16 different columns. As shown in below figure, first pin of LCD is connected to ground second to supply voltage VCC. Third pin is VEE which is a LCD contrast control pin where LCD contrast depends on voltage present on this pin. To bring contrast to a appropriate level, a variable resistor of 10k is used. Variable resistor has three terminals in which left and right terminals are connected to VCC and ground and its center terminal to the VEE pin of LCD. Now if we rotate its upper part in either direction, LCD contrast will change. 4th pin of LCD is register select pin which is used to select internal registers of LCD. If RS=0, it will select command register and if RS=1, it will select data register. 5 th pin is Read/Write pin. If RW=0, it will write to register and if RW=1, it will read from register. In

31

our case, as we don't require any reading from LCD so RW is tied up to the ground which makes LCD work only for write operations. Its 6th pin is enable pin which ensure the data transmission to LCD when a high to low pulse (minimum 45ns wide) is given to it. Pins from 7 to 14 are data pins which used to display letters or numbers but as we we will use LCD in 4 bit configuration so pins from 7 to 10 are connected to ground. The remaining four pins from 11 to 14 are connected to MCU pins for data transmission.

Figure 3.10: Input/output unit

32

3.3.6.5 OVERALL OPERATION Four important building blocks of this project were discussed in above section and now in this section; a summary of an overall operation is presented. As discussed earlier the most important block is control unit. It controls the overall operation of system by communicating with other blocks. It takes data from earth leakage detection block, process it and then issue command to output block for it to display the overall system status. As soon as power is provided from the PSU to the other blocks, system operation starts. First control unit do its initial work by making its ports compatible to the other blocks, update output block about the initial system status. After that it starts taking AC current data from earth leakage block and continuously compares each IN and OUT currents for three different phases. This process is repeated until there is some imbalance detected. If that happens, control unit will suddenly break the phase/load connection by giving command to trip unit, turn on the corresponding phase fault indicator and issues a command to display unit to show the temporary fault message in that specific phase.

After that control unit starts timer for 5 seconds. Now it depends on the nature of fault, if the fault occurred due to some electric shock then it would be a temporary fault but if some appliance has permanent leakage problem then is considered as a permanent fault. So after 5 seconds, if the control unit detects that no fault is present, it will resume the power to the load, turn off fault indicator and will tells the display unit to show normal operation status of the system otherwise it will keep the load isolated from the power and update the display unit to show that the system is having permanent fault. Now permanent fault has to be manually removed first e.g. resolving earth leakage problem in old fridge. Once fault is removed, the input unit which contains normalization buttons for each phase is used to tell the control unit to restore power to the previously faulty load. When that happens, control unit will bring the whole system back to its normal mode and resume the process of fault detection.

33

3.4 SOFTWAREDEVELOPMENT

Software development in embedded world is a process of writing a source code for the microcontroller. Source code is a set of instructions which tell the MCU how to behave in a real world. Every MCU needs to have its specific compiler which not allows a user to write a source but also compile that source code and convert it into a form which is understandable by MCU. So after writing a source code in a compiler, it is then compiled and converted into HEX file. Now that HEX file is burn into the MCU by special burning software. For our purpose since we are using PIC16F877A microcontroller, Mikro C pro for PIC programming language is chosen as compiler.
3.4.1 MIKROC PRO FOR PIC

The mikroC PRO for PIC is a powerful, feature-rich development tool for PIC microcontrollers. It is designed to provide the programmer with the easiest possible solution to developing applications for embedded systems, without compromising performance or control.

PIC and C fit together well: PIC is the most popular 8-bit chip in the world, used in a wide variety of applications, and C, prized for its efficiency, is the natural choice for developing embedded systems. Mikro C PRO for PIC provides a successful match featuring highly advanced IDE, ANSI compliant compiler, broad set of hardware libraries, comprehensive documentation, and plenty of ready-to-run examples. 3.4.2 SOFTWARE FLOWCHART
The flow chart for the control system is shown in Figure 3.11. As the system starts, it first initializes variables, GPIO ports, timer1, ADC module and LCD module. Variables used are of different data types. Floating type variables are used for AC current values storage, byte types for counter values, character arrays for messages and bit types for different flags. GPIO (general purpose input output) are divided into two types, inputs and outputs. Two types of Inputs are used, analogue and digital. Analogues are internal ADC module inputs which are used to take analogue inputs and forwarded to ADC for its digital conversion, while digital inputs are connected to the external buttons. Outputs are also divided into two categories, one for LED

34

control and one for LCD control. PIC16F877A has built-in internal ADC modules which will be used for analogue to digital conversion. LCD module is control in software which means that different pins of MCU will be used to configure, update external LCD module. After initialization, system first reads all six ADC channels i.e. three for incoming and three for outgoing phase currents. Reading ADC channels means getting results in digital numbers. Those digital numbers are then converted into their respective current values. Once currents are found, system will compare incoming and outgoing currents for each phase. If any "imbalance" in the currents is found, concerned output will get high and will cause its own LED to turn on. Also commands will be send to LCD to change its message from "normal mode operation" to "temporary fault detected. At this point timer1 will start for the duration of five seconds. If no imbalance is detected, control will be transfer to "timer1 up". The importance of "timer1 up" comes when some fault is occurred previously so this is the point, system see whether timer1 was active previously and has completed its 5 seconds duration. Now if timer1 is a already expired then it see if any imbalance in currents still exist, if yes then system updates LCD by sending a message to it indicating a permanent fault and also stops timer1. But if no imbalance condition exists, fault indicator is immediately turned off; LCD is updated to display no fault and normal mode message and timer1 is stopped. If timer1 is not activated previously, control is transferred to next block. At this point it is check whether any input in RB4, RB5 and RB6 is low. These inputs are normally pulled high and are connected to three different buttons which are required when the system goes into the permanent fault mode. So pressing those buttons will result in making these inputs low. So if any of these inputs gets low then it is checked whether any fault related to this specific pin still exists, if yes then fault indicator is immediately turned off; LCD is updated to display normalized and normal mode message and timer1 is stopped. In case of no imbalance or no inputs grounded, the control will be transferred to the start where read ADC channels will start again and the whole process is repeated again. The complete programming/code for the project is shown in appendix.

35

Figure 3.11: Flowchart

36

CHAPTER 4

RESULT AND ANALYSIS

A Virtual circuit containing PIC16F877A microcontroller, ACS712, virtual load, 16x2 LCD, LED and switches are designed in Proteus in order to simulate and analyze the results. Source code is written in MIKROC pro for PIC compiler to compile and convert code into HEX file which will be burnt into the MCU.

4.1 CODE COMPILATIONTEST Figure 4.1 shows the process in order to compile the program, generating the HEX file and write it on the microcontroller.

Figure4.1: mirkoC PRO for PICHex file generation

37

The source code is first written in the compiler program, and then by the above process it is converted into the HEX file. This HEX file will be then placed in MCU HEX file location in the Proteus simulation file.

4.2 SIMULATION RESULTS
A circuit is designed by connecting different components like PIC16F877Amicrocontroller, A C S71 2, vi rtua l l oad , 16 x2 LC D, LE D a nd swit che s i n Proteus. HEX file that is generated in mikroC PRO for PIC software is placed into the microcontroller. This HEX needs to be first loaded into MCU in any microcontroller based simulation. Simulation process is then carried out to predict the designed system in real world. Different tests explained below, have been done to analyze individual results and to see if we are getting what was expected.

4.2.1 ACS712 OUTPUT TEST

ACS712 produces output voltage signal which is directly proportion to current passing through its input terminals. For its simulation, arrangement was made by connecting ACS in series with LINE and LOAD and LOAD back to the NEUTRAL. Virtual oscilloscope was picked from Proteus built-in libraries and was placed near the current sensor. ACS output pin was connected with the A channel of oscilloscope. After this arrangement, simulation was started.

In simulation, it was noticed through oscilloscope that signal generated on the output of ACS has the sinusoidal shape shown in figure 4.2. Further it can be seen that this signal is oscillating about 2.5v reference and between two extremes which are VCC(5V) and 0V while its time period is 20m seconds which is same as for of input AC current. Peak of this signal is clearly visible which is well in the range for 0-5v and if given to the ADC of MCU, input AC current could be easily found.

38

Figure4.2: ACS712 Output

4.2.2

NORMAL CONDITION TEST

System condition is considered normal if there is no earth leakage fault. As shown in figure 4.3, a switch is installed in parallel to load and earth. If this switch is open, there will be no leakage of current to the earth also input current coming to the system and output current leaving the system ill have same magnitude which can be seen in the below figure where virtual AC ammeters are installed in series in input and return path of the system, showing both the current of 13.7.amp magnitude. Microcontroller is also detecting the condition rightly because it shows the message "SYSTEM IS READY" which means that both the current it senses are of equal magnitude.

39

Figure4.3: Normal Condition

4.2.3

FAULT CONDITION TEST

System is considered to have a fault if any leakage of current flows to the earth. Fault condition is tested by closing the switch naming "LEAKAGE L1 CONTACT" as shown in the figure 4.4. While doing it, current starts leaking through JOHN body to earth and it was noticed that ammeter in the input path, which was initially 13.7 amps, now shows current of 14 amps but the one in the return path still shows that old current of 13.7 amps so there is a difference of 300 milliamps in both the currents which means that more current is going to the system but less current coming out in the return path. This clearly indicates that there must be some current wasting in the system i.e. leaking to the earth. System has also detected the fault, because LCD is now showin g "L1 LEAKAGE" which means that MCU successfully detected the current difference and has commanded LCD to change its contents for fault indication.

40

Figure4.4: Fault condition

4.2.3.1

FAULT REMOVED BEFORE TUP

After fault occurs, then the system is programmed so that if the fault is removed within 5 seconds after it happened, like in electric shock, it would be considered as a temporary fault and the system will go back to its normal mode of operation. Here two cases need to be considered; one in which in fault occurs and the other where fault is removed. In figure 4.4, it can be seen that fault occurred at 3.7 seconds of simulation time and figure 3.5 shows that it is removed after 8.6 seconds of simulation time. Now as time different between two events is approximately 4.9 seconds which means that 5 second threshold is not yet reached. At this point system has to normalize the fault because it was a temporary fault and its removing occurs before 5 second threshold. Same outcome is shown in below figure.

It can further noted from the below figure that system has successfully detect the fault removal before timer up (5 seconds threshold) and has updated the LCD showing the message "L1 NORMALIZED" which means that system has clear this temporary fault and is gone back to its normal operation.

41

Figure4.5: Temporary Fault Condition

4.2.3.2

FAULT REMOVED AFTER TUP

Now if fault occurs, and it wasn't cleared before the threshold timer 5 seconds expires, like in permanent earth leakage from an appliance, then it would be considered as a permanent fault and the system will stay in fault condition until it cleared manually. After the fault occurs at 3.7 seconds of simulation time shown in figure 4.4, it is removed at 11.2 seconds shown in figure 4.6, which means that difference between occurrence and removal of fault is now 7.5 seconds. At this point system is expected to consider this as permanent fault and stay in unclear fault state, until some manual operation is performed. Same behavior is shown in the below figure.

Figure 4.6 also shows that even after clearing the fault, which is after 5 seconds timer is expired, LCD is showing "L1 LEAKAGE" message which means that system has not cleared the fault and identified it as permanent.

42

Figure4.6: Permanent Fault Condition
4.2.4 MANUAL RESET TEST

Final test is related to a situation where fault is removed after the timer expires. It was discussed in previous section that system has detected this specific situation as a permanent fault, but now how the system will come out from this situation. Solution was provided by using external buttons. As shown in figure 4.7, permanent fault was previously occurred and system was in permanent fault state, but as its corresponding buttonwas pressed down, "NORMALIZE L1" in this case, LCD changed its content to "L1 NORMALIZED" which indicates that when MCU sensed that button pressing, it has cleared that specific permanent fault and enforce the system to return to its normal mode of operation.

43

Figure4.7: Manual Reset Operation

4.3 ANALYSIS
From the above results, it is analyzed that a current difference in any phase and its return path would bring the system into the fault state. After a fault is occurred, two situations may come; either the fault is temporary like electric shock or some short-time earth leakage problem or it is permanent like appliance bad condition causes the permanent leakage problem. Temporary fault is indicated by its removal before timer expiry while permanent is the one in which removal take place after timer is expired. No mechanical reset is required if the fault is temporary, system will automatically clear it and would resume the normal operation, but in the case of a permanent fault, system will remain in that unclear state. For this case, Manual operation is required thereby using buttons to bring back system to its normal state.

44

CHAPTER 5

CONCLUSION

In this thesis, detecting earth leakage in a three phase system by a microcontroller is discussed. The procedure consists of building t h e s c h e m a t i c d e s i g n , s i m u l a t i o n , and software design. A digital earth leakage detection system was designed in a three phase environment in which processing work was carried out by the microcontroller and its results, in different situations were discussed using software simulation. Simulation tests in possible events were done and shown using separate graphs. Advance current sensors were used for AC current measurement instead of current transformer or a shunt method which increases the speed and also shrinks the overall size of the system.

The whole system was controlled through a microcontroller which changes the analogue nature of earth leakage detection to the digital one and adds an ease and luxury at the user end. Also the auto resetting feature makes this design more valuable which would require no physical access of a user if a temporary fault occurs while in conventional system, user must have a physical access to turn off the switch mechanically, if a fault occurs.

The most hazardous fault is considered to be an electric shock but it was noticed that in a conventional ELCB speed of detecting fault was too slow and also the currents difference by which it detected fault was too high. Complex algorithm was used in the current software design to ensure that the speed of detection gets high and current difference get low by a reasonable amount.

45

RESEARCH QUESTIONS
Some questions and comments were raised during final Defence of the project. I tried to answer those but still these questions can be considered as future research.

Q1: If breaker is off so it should not be turned on automatically as you don't know how serious the fault is. Its temporary but not known how much serious is this? Why would you turn it on again? It can be dangerous? A1: The only dangerous fault that could occur is "Electric shock", but it only lasts for milli seconds and goes off when circuit breaks. So, by the time when system resume power to the load i.e. after 5 seconds, electric shock is no more there but now we are interested in other current leakage to the ground like permanent leakage of appliance current to ground, if that is the case then it would be considered as permanent fault and system will remain in off state. Q2: Current is not perfectly aligned, in case of phase shift it would show fault but it's not a fault.

A2: This question has a little ambiguity. If you are asking why sometime it shows error when it has not occurred yet i.e. false tripping, problem is that for speedy fault detection, we take only one sample from ADC to find each PHASE in and out currents but one sample sometimes leads us to a fluctuation problem and taking more samples could increase the fault detection time, so for this problem to be solved we will need fast ADC and microcontroller in which we will increase number of samples and do averaging to get same in/out currents for no fault.

Q3: Three phase and neutral. How would u distinguish which phase has problem?

A3: LCD is already showing which PHASE has got a problem. Also, physically the one which is disconnected from its corresponding load will have a problem.

46

Furthermore, If the above-mentioned questions still exist so this project can also be used as Remote information Of ELCB and we can disable the option of automatic Reset but at least it will give us information in case we are not present there. In that case if we are outside the place so we can at least inform someone to go and check the problem.

47

Appendix

Source Code

#define L1_FAULT portc.f0 #define L2_FAULT portc.f1 #define L3_FAULT portc.f2 // Lcd pinout settings sbit LCD_RS at RD0_bit; sbit LCD_EN at RD1_bit; sbit LCD_D4 at RD2_bit; sbit LCD_D5 at RD3_bit; sbit LCD_D6 at RD4_bit; sbit LCD_D7 at RD5_bit; // Pin direction sbit LCD_RS_Direction at TRISD0_bit; sbit LCD_EN_Direction at TRISD1_bit; sbit LCD_D4_Direction at TRISD2_bit; sbit LCD_D5_Direction at TRISD3_bit; sbit LCD_D6_Direction at TRISD4_bit; sbit LCD_D7_Direction at TRISD5_bit; void CURRENT_MEASURE(unsigned char cur_id); //PROTOTYPE FOR CURRENT MEASURING FUNCTION void CHECK_L1_LEAKAGE(void); //PROTOTYPE FOR LEAKAGE FINDING ROUTINES void CHECK_L2_LEAKAGE(void); void CHECK_L3_LEAKAGE(void); float L1_IN_CURR,L2_IN_CURR,L3_IN_CURR; float L1_OUT_CURR,L2_OUT_CURR,L3_OUT_CURR; float L1_THR,L2_THR,L3_THR; const char txt1[] = "INITIALIZING...."; const char txt2[] = "SYSTEM IS READY"; const char txt3[] = "L1 LEAKAGE......"; const char txt4[] = "L2 LEAKAGE......"; const char txt5[] = "L3 LEAKAGE......"; const char txt6[] = "L1 NORMALIZED..."; const char txt7[] = "L2 NORMALIZED..."; const char txt8[] = "L3 NORMALIZED..."; bit L1_FLAG,L2_FLAG,L3_FLAG; bit TMRON_FLAG,TUP_FLAG; unsigned char T_COUNT=0; char msg[16]; //declare array set 16 bytes of RAM aside for copying into void interrupt(void) //interupt for timer 5 seconds in this case { if(PIR1.TMR1IF==1) { T_COUNT++; if(T_COUNT==50) //16ms*61 ~ 1 sec delay, 5 SEC DELAY { TUP_FLAG=1; T_COUNT=0; TMR1L=0X00; //initialize timer1 TMR1H=0X00; T1CON.TMR1ON=0; //stop timer1 } else { TMR1L=0X00; //initialize timer1 TMR1H=60; } PIR1.TMR1IF=0; } } char * CopyConst2Ram(char * dest, const char * src)

48

{ char * d ; d = dest; for(;*dest++ = *src++;) ; return d; } void main() { adcon1=0x00; //all porta pins analogue cmcon=0x07; //comapartor off trisa=0xFF; portb=0x00; //clear portb trisb=0xFF; //make all portb pins input trisc=0x00; //make all portb pins output portc=0x00; //clear portc trise.f0=1; //make porte pin0 input option_reg.f7=0; T1CON=0x30; //timer1 prescaler is 1:8, stop timer1 PIE1.TMR1IE=1; //timer1 interrupt enabled PIR1.TMR1IF=0; //clear timer1 interrupt flag INTCON.PEIE=1; //peripheral interrupts enabled INTCON.GIE=1; //global interrupts enabled TMR1L=0X00; //initialize timer1 TMR1H=0X00; L1_IN_CURR=0.0; L2_IN_CURR=0.0; L3_IN_CURR=0.0; L1_OUT_CURR=0.0; L2_OUT_CURR=0.0; L3_OUT_CURR=0.0; L1_THR=0.4; L2_THR=0.4; L3_THR=0.4; L1_FLAG=0; L2_FLAG=0; L3_FLAG=0; TMRON_FLAG=0; TUP_FLAG=0; T_COUNT=0; ADC_Init(); // Initialize ADC module with default setting Lcd_Init(); // Initialize LCD module Lcd_Cmd(_LCD_CLEAR); //clear command for LCD Lcd_Cmd(_LCD_CURSOR_OFF); //clear cursor command for LCD Lcd_Out(1, 1, CopyConst2Ram(msg,txt1)); delay_ms(1000); //wait for a second Lcd_Cmd(_LCD_CLEAR); //clear command for LCD Lcd_Out(1, 1, CopyConst2Ram(msg,txt2)); while(1) { CURRENT_MEASURE(1); //FIND L1 INPUT CURRENT CURRENT_MEASURE(2); //FIND L1 OUTPUT CURRENT CHECK_L1_LEAKAGE(); //LOOK FOR ANY LEAKAGE CURRENT IN L1 CURRENT_MEASURE(3); //FIND L2 INPUT CURRENT CURRENT_MEASURE(4); //FIND L2 OUTPUT CURRENT CHECK_L2_LEAKAGE(); //LOOK FOR ANY LEAKAGE CURRENT IN L2 CURRENT_MEASURE(5); //FIND L3 INPUT CURRENT CURRENT_MEASURE(6); //FIND L3 OUTPUT CURRENT CHECK_L3_LEAKAGE(); //LOOK FOR ANY LEAKAGE CURRENT IN L3 if(L1_FLAG==1) { if(PORTB.F4==0) //IF CORRESPONDING BUTTON PRESSED { if(L1_IN_CURR<L1_OUT_CURR+L1_THR) //IF NO EARTH LEAKAGE { L1_FLAG=0; L1_FAULT=0; //TURN OFF L1 FAULT DETECT LED Lcd_Cmd(_LCD_CLEAR);

49

Lcd_Out(1, 1, CopyConst2Ram(msg,txt6)); delay_ms(1000); //wait for a second Lcd_Cmd(_LCD_CLEAR); Lcd_Out(1, 1, CopyConst2Ram(msg,txt2)); } } if(TMRON_FLAG & TUP_FLAG) //IF 5 SECONDS TIME IS COMPLETED { TUP_FLAG=0; T_COUNT=0; TMRON_FLAG=0; TMR1L=0X00; //initialize timer1 TMR1H=0X00; T1CON.TMR1ON=0; //stop timer1 if(L1_IN_CURR<L1_OUT_CURR+L1_THR) //IF NO EARTH LEAKAGE { L1_FLAG=0; L1_FAULT=0; //TURN OFF L1 FAULT DETECT LED Lcd_Cmd(_LCD_CLEAR); Lcd_Out(1, 1, CopyConst2Ram(msg,txt6)); delay_ms(1000); //wait for a second Lcd_Cmd(_LCD_CLEAR); Lcd_Out(1, 1, CopyConst2Ram(msg,txt2)); } else { L1_FLAG=1; L1_FAULT=1; //TURN ON L1 FAULT DETECT LED } } } if(L2_FLAG==1) { if(PORTB.F5==0) //IF CORRESPONDING BUTTON PRESSED { if(L2_IN_CURR<L2_OUT_CURR+L2_THR) //IF NO EARTH LEAKAGE { L2_FLAG=0; L2_FAULT=0; //TURN OFF L2 FAULT DETECT LED Lcd_Cmd(_LCD_CLEAR); Lcd_Out(1, 1, CopyConst2Ram(msg,txt7)); delay_ms(1000); //wait for a second Lcd_Cmd(_LCD_CLEAR); Lcd_Out(1, 1, CopyConst2Ram(msg,txt2)); } } if(TMRON_FLAG & TUP_FLAG) //IF 5 SECONDS TIME IS COMPLETED { TUP_FLAG=0; T_COUNT=0; TMRON_FLAG=0; TMR1L=0X00; //initialize timer1 TMR1H=0X00; T1CON.TMR1ON=0; //stop timer1 if(L2_IN_CURR<L2_OUT_CURR+L2_THR) //IF NO EARTH LEAKAGE { L2_FLAG=0; L2_FAULT=0; //TURN OFF L2 FAULT DETECT LED Lcd_Cmd(_LCD_CLEAR); Lcd_Out(1, 1, CopyConst2Ram(msg,txt7)); delay_ms(1000); //wait for a second Lcd_Cmd(_LCD_CLEAR); Lcd_Out(1, 1, CopyConst2Ram(msg,txt2)); } else { L2_FLAG=1;

50

L2_FAULT=1; } } }

//TURN ON L2 FAULT DETECT LED

if(L3_FLAG==1) { if(PORTB.F6==0) { if(L3_IN_CURR<L3_OUT_CURR+L3_THR) { L3_FLAG=0; L3_FAULT=0; //TURN OFF L3 FAULT DETECT LED Lcd_Cmd(_LCD_CLEAR); Lcd_Out(1, 1, CopyConst2Ram(msg,txt8)); delay_ms(1000); //wait for a second Lcd_Cmd(_LCD_CLEAR); Lcd_Out(1, 1, CopyConst2Ram(msg,txt2)); } } if(TMRON_FLAG & TUP_FLAG) //IF 5 SECONDS TIME IS COMPLETED { TUP_FLAG=0; T_COUNT=0; TMRON_FLAG=0; TMR1L=0X00; //initialize timer1 TMR1H=0X00; T1CON.TMR1ON=0; //stop timer1 if(L3_IN_CURR<L3_OUT_CURR+L3_THR) //IF NO EARTH LEAKAGE { L3_FLAG=0; L3_FAULT=0; //TURN OFF L3 FAULT DETECT LED Lcd_Cmd(_LCD_CLEAR); Lcd_Out(1, 1, CopyConst2Ram(msg,txt8)); delay_ms(1000); //wait for a second Lcd_Cmd(_LCD_CLEAR); Lcd_Out(1, 1, CopyConst2Ram(msg,txt2)); } else { L3_FLAG=1; L3_FAULT=1; //TURN ON L3 FAULT DETECT LED } } } } } void CURRENT_MEASURE(unsigned char curr_id) { unsigned int cur=0,cur_new=0,i=0; unsigned short channel_id=0; if(curr_id==1) { channel_id=0; } else if(curr_id==2) { channel_id=3; } else if(curr_id==3) { channel_id=1; } else if(curr_id==4) { channel_id=4; //calculate current

51

} else if(curr_id==5) { channel_id=2; } else if(curr_id==6) { channel_id=5; } for(i=0;i<300;i++) { cur_new = ADC_Get_Sample(channel_id); //cur_new = adc_read(channel_id); ADC_Get_Sample if(cur_new>cur) { cur = cur_new; } } if(curr_id==1) { L1_IN_CURR = (cur-511)*0.05235908; } else if(curr_id==2) { L1_OUT_CURR = (cur-511)*0.05235908; } else if(curr_id==3) { L2_IN_CURR = (cur-511)*0.05235908; } else if(curr_id==4) { L2_OUT_CURR = (cur-511)*0.05235908; } else if(curr_id==5) { L3_IN_CURR = (cur-511)*0.05235908; } else if(curr_id==6) { L3_OUT_CURR = (cur-511)*0.05235908; } } void CHECK_L1_LEAKAGE(void) { float TEST_CURR; TEST_CURR=L1_OUT_CURR+L1_THR; if(L1_FLAG==0) { if(L1_IN_CURR>TEST_CURR) { L1_FLAG=1; L1_FAULT=1; //TURN ON L1 FAULT DETECT LED Lcd_Cmd(_LCD_CLEAR); //clear command for LCD Lcd_Out(1, 1, CopyConst2Ram(msg,txt3)); TMRON_FLAG=1; TUP_FLAG=0; T_COUNT=0; TMR1L=0X00; //initialize timer1 TMR1H=60; T1CON.TMR1ON=1; //start timer1 } } } void CHECK_L2_LEAKAGE(void) { float TEST_CURR;

52

TEST_CURR=L2_OUT_CURR+L2_THR; if(L2_FLAG==0) { if(L2_IN_CURR>TEST_CURR) { L2_FLAG=1; L2_FAULT=1; //TURN ON L2 FAULT DETECT LED Lcd_Cmd(_LCD_CLEAR); //clear command for LCD Lcd_Out(1, 1, CopyConst2Ram(msg,txt4)); TMRON_FLAG=1; TUP_FLAG=0; T_COUNT=0; TMR1L=0X00; //initialize timer1 TMR1H=60; T1CON.TMR1ON=1; //start timer1 } } } void CHECK_L3_LEAKAGE(void) { float TEST_CURR; TEST_CURR=L3_OUT_CURR+L3_THR; if(L3_FLAG==0) { if(L3_IN_CURR>TEST_CURR) { L3_FLAG=1; L3_FAULT=1; //TURN ON L3 FAULT DETECT LED Lcd_Cmd(_LCD_CLEAR); //clear command for LCD Lcd_Out(1, 1, CopyConst2Ram(msg,txt5)); TMRON_FLAG=1; TUP_FLAG=0; T_COUNT=0; TMR1L=0X00; //initialize timer1 TMR1H=60; T1CON.TMR1ON=1; //start timer1 } } }

53

References [1]Lin,I.H.,Liu,C.Y.,Chen,L.C.,"EvaluationofHumanRobotArmMovementImitation",Proceedingsof8thAsianControlConference(ASCC),pp.287292,2011. [2]Nikku,S., "Introduction to Robotics" USA: John Wiley&Sons, 2011. [3]http://www.robotics.org/content-detail.cfm/Industrial-Robotics-FeaturedArticles/How-Robots-Will-Affect-Future-Generations/content_id/834 [4]http://machineslikeus.com/news/potential-future-impact-robots-society [5]http://curiosity.discovery.com/question/how-robots-improve-lives [6]Nehmzow,U.,"Mobile Robotics: a practicalintroduction",UK: Springer,2003. [7]Muir,F.P.,Neuman,P.C.,"Pulse widthModulationControlofBrushlessDCMotorsforRoboticApplications",IEEETransactionso nIndustrialElectronics,Issue 3, Vol. 32, pp.222-229, 1985. [8]Kramer,A.K.,Anderson,M.,"APIC18RobotCenteredMicrocontrollerSystemsLaboratory",IEEEFrontiers in EducationConference(FIE), pp.1-6, 2011.

54

