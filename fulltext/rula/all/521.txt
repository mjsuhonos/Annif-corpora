Ryerson University

Digital Commons @ Ryerson
Theses and dissertations

1-1-2009

An Enhanced Numerical Model to Simulate Nonlinear Continuous Wave Ultrasound Propagation and the Resulting Temperature Response
Shahram Mashouf
Ryerson University, shahram.mashouf@ryerson.ca

Follow this and additional works at: http://digitalcommons.ryerson.ca/dissertations Part of the Biological and Chemical Physics Commons Recommended Citation
Mashouf, Shahram, "An Enhanced Numerical Model to Simulate Nonlinear Continuous Wave Ultrasound Propagation and the Resulting Temperature Response" (2009). Theses and dissertations. Paper 123.

This Thesis is brought to you for free and open access by Digital Commons @ Ryerson. It has been accepted for inclusion in Theses and dissertations by an authorized administrator of Digital Commons @ Ryerson. For more information, please contact bcameron@ryerson.ca.

AN ENHANCED NUMERICAL MODEL TO SIMULATE NONLINEAR CONTINUOUS WAVE ULTRASOUND PROPAGATION AND THE RESULTING TEMPERATURE RESPONSE

By: Shahram Mashouf
BSEE, Sharif University of Technology, Tehran, Iran, 1996

A thesis presented to Ryerson University in partial fulfillment of the requirements for the degree of Master of Science in the Program of Biomedical Physics

Toronto, Ontario, Canada, 2009 © Shahram Mashouf 2009

________________________________________________________________________

Author's Declaration

I hereby declare that I am the sole author of this thesis. I authorize Ryerson University to lend this thesis or dissertation to other institutions or individuals for the purpose of scholarly research.

--------------------------------------------- x

I further authorize Ryerson University to reproduce this thesis or dissertation by photocopying or by other means, in total or in part, at the request of other institutions or individuals for the purpose of scholarly research.

--------------------------------------------- x

ii

________________________________________________________________________

Abstract
"An Enhanced Numerical Model to Simulate Nonlinear Continuous Wave Ultrasound Propagation and the Resulting Temperature Response", Shahram Mashouf, M.Sc., Biomedical Physics, Ryerson University, 2009

In this work a nonlinear CW ultrasound field propagation model based on a second-order operator splitting approach is studied and a number of significant enhancements are introduced and implemented. In this model the ultrasound field is calculated and propagated plane by plane and the effects of diffraction, nonlinearity and absorption are applied independently over incremental steps. This work completes the preceding works (Christopher and Parker 1991, Tavakkoli et al. 1998, Zemp et al. 2003, Williams et al. 2006) by introducing an arbitrary source geometry and excitation definition, full diffraction solution, enhanced pressure, enhanced power deposition rate and temperature prediction capabilities. The result is a particularly useful tool in carrying out simulations of high intensity focused ultrasound (HIFU) that includes temperature rise predictions. Comparisons are made with other codes in both linear and nonlinear regimes. Different dynamics of lesion formation are obtained in linear versus nonlinear models, specially at the onset of lesion creation during HIFU exposure.

iii

________________________________________________________________________

Acknowledgements

I would like to give my sincere thanks to my supervisor, Dr. Jahan Tavakkoli, for his continuous support during the tenure of this thesis. His thoughtful insights, comments and directions have always been most helpful in solving the problems.

I would also like to thank all the faculty and staff of the department of physics for their resourcefulness and support.

I'm also thankful for the helpful comments, suggestions and directions of Dr. Richard Cobbold, Dr. Oleg Sapozhnikov, Dr. Roger Zemp and Mr. Ross Williams.

This work was partially supported by the Ryerson Dean's Start-up Fund that was made available to Dr. Tavakkoli.

Last but not least special thanks go to my parents and brothers for their love and encouragement.

Fall of 2009

iv

________________________________________________________________________

Table of Contents
TITLE PAGE...................................................................................................i AUTHOR'S DECLARATION.......................................................................ii ABSTRACT...................................................................................................iii ACKNOWLEDGEMENTS...........................................................................iv TABLE OF CONTENTS................................................................................v LIST OF SYMBOLS...................................................................................viii LIST OF FIGURES.........................................................................................x CHAPTER 1 INTRODUCTION AND BACKGROUND.....................1

1.1 THESIS MOTIVATION AND OBJECTIVE................................................1 1.2 THERAPEUTIC ULTRASOUND...................................................................2 1.2.1 High Intensity Focused Ultrasound.................................................2 1.2.2 Lithotripsy.......................................................................................6 1.2.3 Histotripsy.......................................................................................8 1.3 NONLINEAR ACOUSTICS..........................................................................10 1.3.1 History of Nonlinear Acoustics.....................................................10 1.3.2 Coefficient of Nonlinearity............................................................15 1.3.3 Model Equations............................................................................19 1.3.4 Method of Fractional Steps............................................................22 1.4 HEAT TRANSFER AND TEMPERATURE.................................................24 1.4.1 Heat Transport...............................................................................24 1.4.2 Bio-Heat Transfer Equation...........................................................26

CHAPTER 2

METHODOLOGY.........................................................28 2.1 METHOD OF FRACTIONAL STEPS..........................................................28 2.1.1 Second-order Operator-splitting Method......................................29 2.1.2 Diffraction Operator......................................................................29 2.1.3 Nonlinearity and Attenuation Operator.........................................31 2.2 3D SOURCE DEFINITION ......................................................................... 31 2.2.1 Elements Matrix............................................................................32 2.2.2 Sub-elements.................................................................................34 2.2.3 Coordinate System Attached to an Element..................................36 2.3 FULL DIFFRACTION SOLUTION..............................................................39 2.3.1 Initial Plane....................................................................................39

v

________________________________________________________________________ 2.3.2 Rayleigh Diffraction Integral.........................................................39 2.3.3 Location of the Initial Plane...........................................................41 2.3.4 Full Diffraction vs. Phase Shift Method........................................47 2.4 ENHANCED PRESSURE..............................................................................52 2.4.1 Enhanced Pressure in Lossless Liquid...........................................52 2.4.2 Computational Noise in Enhanced Pressure..................................60 2.4.3 Enhanced Pressure In Viscous Liquid...........................................64 2.5 SOURCE PRESENTATION IN SPATIAL FRQUENCY DOMAIN...........72 2.5.1 Pressure Calculation Across Initial Plane......................................73 2.5.2 Spatial Extent of the Initial Plane..................................................73 2.5.3 Spatial Sampling of the Initial Plane.............................................74 2.5.4 Pressure to Normal Particle Velocity Conversion.........................76 2.5.5 Acoustic Source as a 2D Array......................................................77 2.6 TEMPERATURE & THERMAL DOSE CALCULATIONS........................79 2.6.1 Bio-Heat Transfer Equation...........................................................80 2.6.2 Enhanced Heat Deposition Rate....................................................81 2.6.3 Interpolation of Q Between Two Planes........................................82 2.6.4 User Defined Parameters...............................................................83

CHAPTER 3

MODEL VERIFICATION............................................85

3.1 VERIFICATION OF THE DIFFRACTION INTEGRAL............................85 3.2 FULL DIFFRACTION VS. PHASE SHIFT METHOD...............................90 3.3 COMPUTATIONAL NOISE IN ENHANCED PRESSURE.....................103 3.3.1 In a lossless Medium....................................................................103 3.3.2 In a Viscous Medium..................................................................108

CHAPTER 4

RESULTS ....................................................................112

4.1 LINEAR SIMULATIONS...........................................................................114 4.1.1 Pressure Profiles...........................................................................112 4.1.2 Intensity Profiles..........................................................................119 4.1.3 Temperature Profiles....................................................................122 4.2 NON-LINEAR SIMULATIONS.................................................................125 4.2.1 Comparison with the KZK...........................................................125 4.2.2 Effect of Nonlinearity..................................................................129

CHAPTER 5

DISCUSSIONS AND CONCLUSIONS.........................

5.1 SIGNIFICANCE OF THE WORK.............................................................139 5.1.1 Arbitrary Excitation and 3D Source Geometry...........................139 5.1.2 Full Diffraction Solution..............................................................139 5.1.3 Enhanced Pressure.......................................................................140 5.1.4 Temperature Simulations.............................................................141 5.2 FUTURE WORK.........................................................................................142 5.2.1 Pulsed Wave Model.....................................................................142 5.2.2 Multilayer Medium......................................................................142

vi

________________________________________________________________________ 5.2.3 Enhanced Heat Deposition Rate..................................................142 5.2.4 Dynamic Medium........................................................................143 5.2.5 Cavitation Model.........................................................................144

APPENDIX_A APPENDIX_B APPENDIX_C APPENDIX_D REFERENCES

INSTRUCTIONS TO RUN NLP-E............................145 PUBLISHED PAPER ................................................147 "FIELD" PROGRAM.................................................152 ENHANCED Q ­ AN IMPROVED FORMULA......155 ......................................................................................161

vii

________________________________________________________________________

List of Symbols
co
c
C

Small signal speed of sound [m/s] Finite amplitude speed of sound [m/s] Specific heat capacity [J/kgoC] 2D Fourier transform Frequency [Hz] Frequency of fundamental [Hz] Pressure gain at the focal spot
-1

2D

f fo
G

j
k

Wave number [rad/m] Complex wave number [rad/m] Spatial frequency component along the horizontal axis [rad/m] Spatial frequency component along the vertical axis [rad/m] Thermal conductivity [W/ m.oC] Pressure [Pa] Pressure phasor [Pa] Pressure amplitude at the source [Pa] Heat deposition rate [W/m3] Temperature [oC] Particle velocity amplitude [m/s] Particle velocity vector [m/s]

k

kx

ky K
p P Po Q T
v r v

vx vy
vz

x-component of the particle velocity [m/s] y-component of the particle velocity [m/s] z-component of the particle velocity [m/s] v x phasor [m/s] v y phasor [m/s]
v z phasor [m/s]

Vx Vy
Vz

viii

________________________________________________________________________

x
|x|

Complex conjugate of x

Magnitude of x Attenuation coefficient [Np/m] Attenuation factor [Np/m.(MHz) ] Nonlinearity coefficient of the medium Mach number Shock parameter Dirac delta function Angular frequency [rad/s] Wavelength [m] Power index of power law of attenuation Ambient density of the medium [Kg/m3] Density of the medium [Kg/m3] Adiabatic compressibility of the medium [Pa-1] Velocity potential [m2/s] Velocity potential phasor [m2/s] Coefficient of shear viscosity [Kg.s/m] Coefficient of bulk viscosity [Kg.s/m]



o


M 





 o 

   
B

ix

________________________________________________________________________

List of Figures
Figure Description Page

1-1 1-2 1-3 1-4 1-5 1-6 1-7 1-8 1-9 1-10 1-11 2-1 2-2 2-3 2-4 2-5 2-6 2-7 2-8 2-9 2-10 2-11 2-12 2-13 2-14 2-15 2-16 2-17

Lesion formation at the focal region due to HIFU exposure Examples of HIFU devices in clinical use A lithotripsy pulse at the focus of a lithotripter Various lithotripter designs Acoustic pressure waveform of a histotripsy pulse Tissue ablation in histotripsy Sketches of nonlinear distortion by Stokes Harmonic generation in a lossless liquid Harmonic generation in a lossy liquid Method of fractional steps Thermal conductivity of different materials Second order operator splitting method Numerical implementation of angular spectrum method Aggregation of the source surface into small rectangular elements Attributes of a surface element Examples of source geometries created using the element matrix Division of a surface element into sub-elements Geometry and dimensions Significance of sub-elements in eliminating computational errors Systems of coordinate Implementation of the Rayleigh diffraction integral Location of the initial plane in a concave spherical source Time domain waveform distortion of a plane sinusoidal wave Location of the initial plane Important dimensions of a concave spherical source Variations of shock parameter as a function of distance Definition of parameters Phase shift method

3 4 6 7 8 9 11 15 21 23 25 29 30 32 33 33 34 35 36 37 40 42 43 44 45 46 47 48

x

________________________________________________________________________
Figure Description Page

2-18 2-19 2-20 2-21 2-22 2-23 2-24 2-25 2-26 2-27 2-28 2-29 2-30 2-31 2-32 3-1 3-2 3-3 3-4 3-5 3-6 3-7 3-8 3-9 3-10 3-11 3-12 3-13 3-14 3-15

How to calculate the phase shift Calculation of field close to the source surface Spatial distribution of the sinusoidal signal Location of impulse functions in k space Deviation from plane wave approximation Radiation circle Calculation of field variation Band stop filter Spatial extent of the initial plane Pressure variations in front of a source Pressure sampling at discrete points Equi-pressure circles in an axis-symmetric source Acoustic source as a 2D array Interpolation of Q between two propagation planes BHTE calculation domain Geometry and dimensions Transducer surface is broken down to 1mm x 1mm elements Variations of a field point distance from a surface element Lateral pressure profile at z = 25mm, nse=1 Lateral pressure profile at z = 25mm, nse=2 Lateral pressure profile at z = 50mm, nse=1 Lateral pressure profile at z = 75mm, nse=1 Lateral pressure profile at z = 100mm, nse=1 Lateral pressure profile at z = 100mm, nse=1, in log-scale Simulation parameters Application of the phase shift method on a spherically concave source Comparison in near field of a highly focused source Pressure profiles at the focal plane, F#1 Pressure profiles at the focal plane, F#1, in log-scale Comparison in near field of a slightly focused source

49 50 57 58 59 60 62 63 74 75 75 76 78 83 84 85 86 86 87 87 88 88 89 89 90 92 93 94 94 95

xi

________________________________________________________________________
Figure Description Page

3-16 3-17 3-18 3-19 3-20 3-21 3-22 3-23 3-24 3-25 3-26 3-27 3-28 3-29 3-30 3-31 3-32 4-1 4-2 4-3 4-4 4-5 4-6 4-7 4-8 4-9 4-10 4-11 4-12 4-13

Pressure profiles at the focal plane, F#1.67 Focusing phase factor Pressure calculation at the focal point of a radial source Comparison in near field of a highly focused source Pressure profiles at the focal plane, F#1 Comparison in near field of a slightly focused source Pressure profiles at the focal plane, F#1.67 Geometry and parameters used in the simulation (lossless medium) Noise in enhanced pressure in a lossless medium Noise reduction farther away from the source Quantitative demonstration of noise reduction by distance Effect of filtering in noise reduction Quantitative demonstration of noise reduction by filtering Geometry and parameters used in the simulation (lossy medium) Computational noise in water vs. tissue Effect of filtering in reduction of noise Noise reduction farther away from the source Source specifications Lateral pressure profiles Enhanced pressure vs. impedance pressure Enhanced pressure vs. impedance pressure vs. Field Lateral pressure profile at the focal plane in log scale Lateral intensity profiles Lateral pressure profile at the focal point Comparison of axial and lateral temperature profiles Temperature contours around the focal spot Geometry and parameters used in the simulation Lateral pressure profiles at different depths Nonlinear distortion of the pressure wave at different axial locations Geometry and parameters used in the simulation

96 97 98 101 101 102 102 104 105 105 106 107 108 109 109 110 111 113 115 116 118 119 121 122 123 124 125 128 128 130

xii

________________________________________________________________________
Figure Description Page

4-14 4-15 4-16 4-17 4-18 4-19

Harmonic generation at the focal plane Temporal pressure waveforms at different axial locations Waveform distortion in water Waveform distortion in tissue Increase of the heat generation rate in the focal region Temporal development of temperature and lesion contours

131 132 133 135 135 136

xiii

Chapter 1: Introduction and Background ________________________________________________________________________

Chapter 1: Introduction and Background
1.1 Thesis Motivation and Objective
Ultrasound propagation is a nonlinear phenomenon, however linear

approximations are often used to model the beam propagation. The Linear theory of sound was regarded as sufficient, until 1980 when Carstensen et al. points out for the first time the importance of nonlinearity around intensities and frequencies of interests in the field of biomedical ultrasound (Carstensen et al. 1980). Even though Carstensen et al. concentrated on beams used in ultrasound therapy, we now know that nonlinearity effects could be pronounced in diagnostic applications as well. The advent of tissue harmonic imaging is a clear example of this effect (Duck 2002). The linear model assumes infinitesimal deviations of acoustic parameters about their equilibrium values. As a result, if the acoustic amplitudes are high enough, significant errors may arise (Baker 1998). The problem is that the effect of nonlinearity is cumulative and it's hard to quantify these errors, except for simple geometries and excitations. For instance, the effect of nonlinearity in a low power biomedical ultrasound scanner might be more pronounced than that of a high power sonar system because the biomedical scanner works at much higher frequencies (Carstensen et al. 1980). In this thesis, among other things, we'll be extending the model of Zemp et al. (Zemp et al. 2003) to be able to define an arbitrary source and excitation in simulations of nonlinear acoustic. We'll be also presenting a more accurate way to predict the pressure field compared to the model of Zemp et al. in which the impedance relation between pressure and normal velocity was being used to calculate the pressure.

1

Chapter 1: Introduction and Background ________________________________________________________________________ Many therapeutic effects of ultrasound are caused by temperature elevation in tissue. Thus it's important to include temperature predictions as part of our model. In this thesis we'll be also including simulations of temperature by introducing an enhanced heat generation rate due to ultrasound nonlinearity. Among others, the resulting program is a particularly useful tool in carrying out simulations of HIFU beams.

1.2 Therapeutic Ultrasound
Medical applications of ultrasound fall into two main categories: diagnostic and therapeutic. Historically, therapeutic applications of ultrasound were examined earlier than its diagnostic or imaging capabilities (ter Haar 2007). Ultrasound can induce a range of bio-effects in tissue depending on the level of intensity and duration of exposure. At low intensities (~100 mW/cm2) it typically creates reversible biological effects which can prove beneficial. At higher end (~1000 W/cm2), however, immediate cell death could result (ter Haar 1995). Diagnostic imaging techniques such as B-mode or Doppler fall at the very low range of the intensity scale and they typically don't cause any adverse biological response in tissue (ter Haar 1993). Therapeutic effects of ultrasound can be caused by both thermal and non-thermal mechanisms. At lower intensity levels acoustic streaming is the dominant underlying mechanism and at higher intensities heating and cavitation play a significant role. High intensity focused ultrasound (HIFU), lithotripsy and histotripsy are examples of high intensity therapies, while sonophoresis, sonoporation, gene therapy, bone healing and physiotherapy comprise low intensity treatments (ter Haar
2007). In what follows we'll describe a number of the high power applications in more

detail.

1.2.1 High Intensity Focused Ultrasound
High Intensity focused ultrasound (HIFU) is a rapidly expanding modality with applications in tumor necrosis, hemostasis, immunotherapy, and soft tissue thermal surgeries (Tavakkoli and Sanghvi 2009). In this method of treatment, highly focused ultrasound beams induce a rapid temperature rise around the focal spot due to conversion of acoustic energy to heat. Precise, well defined thermal lesions can be created inside the

2

Chapter 1: Introduction and Background ________________________________________________________________________ tissue due to thermal coagulation. One advantage of HIFU over other similar treatment modalities is that it can be performed non-invasively. Fig. 1-1 shows the location of lesion formation takes place during HIFU treatment.

Figure 1-1. Lesion formation at the focal region due to HIFU exposure. The size of the lesion is typically around 10mm x 1mm. Source: (Bailey et al. 2003).

Selecting the right transducer and excitation parameters ensure that underlying tissue layers remain intact and tissue coagulation happens only around the focal spot. HIFU transducers typically operate at frequency range of 2-4 MHz with focal intensities being around 1000-3000 W/cm2. The F numbers are usually around one but can be higher with focal lengths of up to 15 cm. The maximum acoustic pressure amplitude is typically limited to 2-4 MPa at the transducer surface (Bailey et al. 2003). The pioneering work in this area was done by Lynn et al. (Lynn and Putnam 1944, Lynn et
al. 1942) in neurosurgical research. They built a high-power focused source and

demonstrated a highly localized biological effect can be produced. Their work was then continued by Fry brothers for selective tissue ablation in the central nervous system (Fry
et al. 1954). Treatment of Parkinson's disease and some ophthalmologic conditions such

3

Chapter 1: Introduction and Background ________________________________________________________________________ as glaucoma and retinal tears were among the first to be tried using the HIFU (Lizzi et al.
1978, Coleman et al. 1985a, Coleman et al. 1985b, Coleman et al. 1985c). However the

emergence of laser eye surgery and L-dopa for treatment of Parkinson inhibited further research activity in this area. In general despite early promising results, the clinical usage of HIFU was delayed till 1990s because of difficulty in guidance and monitoring of the treatment (ter Haar 2007, Foley et al. 2007). The advent of modern imaging techniques along with ultrasound capability to both monitor and deliver a treatment, has caused a revival of this technique.
Applications in tumor therapy:

HIFU has been used to treat tumors in variety of soft tissues. There have been two modes of HIFU delivery in actual clinical settings which are extracorporeal and transrectal
(Tavakkoli and Sanghvi 2009). Fig 1-2 illustrates examples of commercially available

extracorporeal and transrectal HIFU devices.
(a) (b)

Figure 1-2 (a) Ultrasound image-guided extracorporeal HIFU device manufactured and commercialized by Chongqing Haifu (HIFU) Technology Co. Ltd., Chongqing, China.(b) Sonablate® 500 transrectal HIFU device developed and commercialized by Focus Surgery, Inc., Indianapolis, IN. Source: (Tavakkoli and Sanghvi 2009).

Extracorporeal devices are significantly larger and more versatile (Fig. 1-2(a)). They can be used to treat a variety of problems, most commonly intra-abdominal solid tumors. Transrectal devices have been designed mainly for the treatment of prostate cancer and thus are smaller (Fig. 1-2(b)).

4

Chapter 1: Introduction and Background ________________________________________________________________________ Transrectal devices work at higher frequencies and have smaller focal lengths compared to their extracorporeal counterparts (Leslie and Kennedy 2006) and use ultrasound for both treatment and imaging. For extracorporeal devices, the targeting and monitoring is done either with ultrasound or magnetic resonance imaging (MRI). In terms of imaging, MR provides excellent tumor delineation. Moreover thermal maps and necrosed volume can be displayed since several MRI parameters are temperatures dependant (Leslie and Kennedy
2006). On the other hand, ultrasound imaging is significantly less expensive and less

bulky, widely available and can provide real time images, however it's hard to locate the ablated region without the presence of bubbles. During the last decade, HIFU has shown a great promise in treating variety of tumors. It particularly finds a special place when there's no other alternative treatment available such as liver metastasis and pancreatic tumors where regular resection procedures are simply not possible (Bailey et al. 2003). HIFU also offers a number of advantages such as ability to induce highly localized legions non-invasively, less side effects in terms of mortality and morbidity, and possibility of applying other treatments after its use. There are observations that HIFU might evoke an enhanced immune response which restrains new tumor growth (Wu et al. 2004). Even if that's not the case, the body immune function is not impaired as much due to locality and noninvasiveness of the treatment (ter Haar
2007). There are certain challenges and difficulties in implementation of HIFU for tumor

therapy. For example, ultrasound can not pass through air or bone because of the large impedance mismatch. As a result, ribs, lungs and other parts of the body filled with air such as bowels should not be in the path of the acoustic beam. Skin burns is also another issue that has to be considered which requires appropriate surface coupling and cooling mechanisms. Long treatment time is another problem. Contrast agent microbubbles have been shown to help both in imaging of the procedure (Kennedy et al. 2004) and reducing the treatment time (Hanajiri et al. 2006).
Applications in haemostasis or acoustocautery:

Haemostasis or acoustocautery is the process of occluding blood vessels using HIFU exposure. During tumour therapy, it was found that HIFU is also capable of sealing blood

5

Chapter 1: Introduction and Background ________________________________________________________________________ vessels (Delon-Martin et al. 1995) and since then this property has been used and verified by a number of researches (Vaezy et al. 1999, Rivens et al. 1999). Electrocautery is an alternative way to induce haemostasis, but unlike HIFU its use is limited to the tissue surface and surface bleeding inhibits its effectiveness.

1.2.2 Lithotripsy
Lithotripsy has been used for treatment of kidney stones since the early 1980s. It still continues to be the modality of choice for treatment of uncomplicated upper urinary tract concretions (Bailey et al. 2003). New applications in orthopedic medicine are also under development (Thiel 2001, Maier et al. 2001). Lithotripters create an acoustic shock wave at the device focal point where a positive-pressure spike is followed by a negative pressure cycle as shown in Fig. 1-3. Unlike HIFU where many cycles are continuously applied during the on time, in lithotripsy individual microsecond pulses are administered at a pulse repetition frequency of around 1-2 Hz. Typically a treatment requires around 10002000 pulses. Lithotripter transducers typically have F-numbers around one and aperture diameters of tens of centimeters. More compact designs are being sought for orthopedic applications. Three commercially available lithotripter systems (a,b,c) and a research model (d) are illustrated in Fig. 1-4. In electrohydraulic lithotripters, an ellipsoidal reflector is used to

Figure 1-3. A lithotripsy pulse measured at the focus of a lithotripter. The peak positive pressures are typically 20 to 140MPa with peak negative pressures around -8 to -15MPa. Source: (Bailey et al. 2003)

6

Chapter 1: Introduction and Background ________________________________________________________________________

focus a shock wave on the kidney stone. The shock wave is initially generated by an underwater spark. In electromagnetic lithotripters, a high current is conducted through a coil which shakes a parallel membrane. The resulting wave is then focused by lenses or reflectors. The third type is piezoceramic lithotripters which consist of array elements located on a spherically concaved surface. Using array technology, the focal point can be steered and image of the stone can be acquired at the same time. The laser lithotripter which is not clinically available yet, uses optoacoustic properties of a thin spherical layer of a liquid to generate shock waves (Rudenko and Sapozhnikov 1991). Control of cavitation during lithotripsy is an active research area (Cathignol et al. 1998, Sokolov et al. 2001) .

Figure 1-4. Various lithotripter designs: (a) Electrohydraulic (b) Electromagnetic (c) Piezoceramic (d) Laser. Source: Bailey et al. 2003.

7

Chapter 1: Introduction and Background ________________________________________________________________________

1.2.3 Histotripsy
Histotripsy is a tissue ablative technique which utilizes focused high intensity pulsed ultrasound. Other tissue ablative techniques such as HIFU, radiofrequency or laser use thermal effects to coagulate tissue. In histotripsy, however, no coagulative necrosis is present as the temperature rise is kept at a minimum by selecting a low duty cycle (percent of time when ultrasound energy is delivered). In histotripsy the tissue damage is mostly due to mechanical fragmentation. The primary mechanism for this mechanical disruption is believed to be acoustic cavitation which has been supported by a number of experiments during the histotripsy process (Xu et al. 2007, Xu et al. 2005, Parsons et al.
2007). Cavitation is a phenomenon in which rapid transition from compression to

rarefaction phase in pressure results in the formation of microbubbles in tissue. These bubbles oscillate and violently collapse, releasing energy. This process creates localized stresses and pressures that can mechanically fragment and subdivide tissue, resulting in cellular destruction during histotripsy (Roberts et al. 2006). Unlike lithotripsy, which utilizes single-cycle pulses, pulses of several acoustic cycles in duration are used in histotripsy (see Fig.1-5). These pulses are repeated at a certain pulse

Figure 1-5. Acoustic pressure waveform of a 10-cycle (14-s) histotripsy pulse in water at the transducer focus (Pr = 21 MPa, Pc = 76 MPa). Source: Xu et al. 2007.

repetition frequency (PRF) in order to sustain bubble activity. The duty cycle is kept at 0.1 ­ 5 % compared to 100% in HIFU. Even though the spatial peak pulse average 8

Chapter 1: Introduction and Background ________________________________________________________________________ intensity (ISPPA) used in histotripsy is very high (>10 kW/cm2), spatial peak time average intensity (ISPTA) is relatively low (<200 W/cm2) due to the low duty cycles applied. This low duty cycle also allows observation of the ablation process with diagnostic ultrasound between the therapeutic pulses since only a small portion of imaging scan lines are corrupted by interference (Roberts et al. 2006).

The margins of histotripsy lesions in bulk tissue are also sharply demarcated, with only several microns between the liquefied area and the intact cells (see Fig. 1-6). The mechanism for the sharp boundaries might have to do with the nature of cavitation as a threshold phenomenon. The region of tissue erosion extends up to a point where the pulse pressure falls below the cavitation threshold at a tissue-fluid interface (Xu et al. 2007).

C

Figure 1-6. Tissue ablation in porcine myocardium. A) After histotripsy. B) Void after ablated tissue has been irrigated from tissue. C) Histology at lesion border. Source: Parsons et al. 2006.

In overall histotripsy offers two main advantages: first the ability to maintain the treatment volume compared to thermal ablative methods where the creation of precise lesions is limited by the diffuse nature of thermal propagation, inhomogeneous heatingcooling due to tissue variability, perfusion effects and tissue charring (Xu et al. 2007,
Roberts et al. 2006). Second the lesion can be easily monitored by ultrasound as treatment

area appears hyperechoic due to bubble activity, as opposed to thermal methods which needs more advanced monitoring requirements such as MRI (Hall et al. 2007). Histotripsy is a fairly new technique, and hence has not been approved for clinical use by the FDA. So far no human trials have been performed. One of the concerns with histotripsy in oncology is the spread of the tumor within the body. Violent disruption of

9

Chapter 1: Introduction and Background ________________________________________________________________________ surrounding tissue may cause nearby cancer cells to metastasize (Kieran et al. 2007). Studies involving metastatic VX2 tumours in rabbits are planned to investigate this phenomenon (Roberts et al. 2006).

1.3 Nonlinear Acoustics
1.3.1 History of Nonlinear Acoustics
Nonlinear acoustics has grown rapidly over the past 30 years. The finite amplitude wave equations, however, were known much earlier at about the same time as linear equations. The reasons for the slow pace of advances include more complicated mathematics and also the fact that in most cases small signal relations provide a very good description of many acoustical phenomena (Hamilton and Blackstock 1998). The first step in deriving a finite amplitude equation was taken by Euler (Euler 1759) for aerial plane waves. He also noted that nonlinear terms may give rise to higher speeds of propagations. In deriving a solution for a similar problem Lagrange (Lagrange 1760) also came to suggest a variable speed of propagation. However shortly after he dismissed the idea, as this was in contrast to a widely accepted notion of a constant speed of propagation. Later on an important milestone was achieved by Poisson (Poisson 1808) in finding an exact solution for propagation of a finite amplitude plane progressive wave. He assumed Boyles's law and used Eulerian coordinates which yields the following equation:
v   2 v  2 v   v 2 - 2 =  + v2  2  x  t x  x t 

b2

(1.3-1)

where v is the particle velocity, b = Po /  o is the isothermal speed of sound resulting from Boyle's law and Po ,  o are the ambient pressure and density. Poisson's exact solution is v = g[ x - ( v + b )t ] for waves travelling in the direction of increasing x and

10

Chapter 1: Introduction and Background ________________________________________________________________________

v = G[ x - ( v - b )t ] for waves travelling in the opposite direction, where g and G are
arbitrary functions. In spite of this, Poisson didn't recognize the implications of his results which predict a variable propagation speed of dx / dt v = v ± b . He failed to notice this because of observations that the length of a pulse did not appear to change as it propagated and concluded "sound, loud or faint, is transferred with the same speed" (Hamilton and
Blackstock 1998).

The significance of nonlinear distortion was not recognized till 40 years later when Stokes clearly explained the waveform distortion implied by Poisson's solution (Stokes
1848). The first sketches of nonlinear distortion by Stokes has been shown in Fig 1-7.

Figure 1-7. First sketches of nonlinear distortion by Stokes. Source: (Hamilton and Blackstock 1998).

At the end of the classical era (1860s), the prevailing question on everyone's mind was what happens after a shock front is formed. It then became clear that appearance of discontinuities is due to the assumption of a lossless propagation. Dissipation would not allow any discontinuity to form. It was then clear that dissipation should be accounted for in analysis of a shock front. That's why energy equations with dissipation terms opened the door to shock wave theories. In earlier efforts, Stokes had tried to solve the problem by applying conservation of mass and momentum and energy at the shock front, but it didn't yield any results as a lossless energy equation had been used. Rankin (Rankine
1870) and Hugoniot (Hugoniot 1887) independently came up with appropriate energy

relations which accounts for dissipation through heat conduction. Combining the equations of mass, momentum and energy and eliminating pressure and density from the expressions, the speed of shock ( U sh ) for a shock entering a quiet fluid is calculated as:

11

Chapter 1: Introduction and Background ________________________________________________________________________
2 U sh = [ c o + (  v b / 2 ) 2 ]1 / 2 +  v b / 2

(1.3-2a)

where c o is the small-signal speed of sound,  is the medium coefficient of nonlinearity and vb is the peak particle velocity. A shock creates a rapid change in particle velocity from v a to vb . The assumption of a shock entering a quiet fluid assumes the particle velocity ahead of the shock is zero (i.e. v a = 0 ). Based on Eq. (1.3-2a), the shock front moves faster than the small signal speed of sound. For weak shocks where vb << co , Eq. (1.3-2a) can be simplified to: U sh = c o +  vb / 2 (1.3-2b)

If v a  0 , Eq. (1.3-2b) takes the general form of:

U sh = co + 

( v a + vb ) 2

(1.3-2c)

Rayleigh (Rayleigh 1910) later demonstrated that Rankin's result would not yield valid results if the ratio of shock pressure before the shock to that after the shock exceeds certain limit. In other words heat conduction alone does not create enough dissipation to sustain a shock front. He was the first one who considered and formulated the effect of viscosity as a source of dissipation. He could then obtain single-valued solutions even for strong shocks through numerical methods.

Shortly after, Taylor (Taylor 1910) managed to find an analytical solution for weak shock conditions in a viscous heat conducting gas. Based on this, the shock thickness or the distance required for the particle velocity to rise from 10% to 90% is given by (Hamilton
and Blackstock 1998):

h=

2 ln 9 vb

(1.3-3)

or subsequently t rise = h / c o ; since under weak shock conditions U sh  c o . Here,  and vb are the same as defined in Eq. (1.3-2) and  is the sound diffusivity which represents the thermo-viscous dissipation of the fluid.

12

Chapter 1: Introduction and Background ________________________________________________________________________ As pointed out by Lighthill (Lighthill 1956) Eq. (1.3-3) displays how nonlinearity and dissipation create opposite effects. While increasing nonlinearity through parameter  ub steepens the shock, increasing dissipation through  smooths it out. Aside from the case of a step shock, the problem of finite amplitude plane wave propagation generated by a sinusoidal source had been also investigated by Airy (Airy
1849) and Hugoniot (Hugoniot 1887). Hugoniot also managed to calculate the shock

formation distance as:
x= 1

 M k

(1.3-4)

where  is the coefficient of nonlinearity,  M = v o / c o is the ratio of peak particle velocity to the small-signal speed of sound and k is the wave number. The shock parameter  is consequently defined as

 = x / x =  M kx

(1.3-5)

which is a measure of nonlinear distortion at different field locations (Duck 2002).

The next major step was taken by Fay (Fay 1931) for the same problem of finite amplitude plane wave propagation generated by a sinusoidally vibrating source in a dissipative medium. He solved the problem by using the Fourier series expansion of the waveform as given in Eq. (1.3-6) below: v( x, ) = v o  Bn ( x ) sin( n )
n =1



(1.3-6)

where vo is the particle velocity amplitude of the fundamental at the source,  is the source angular frequency and  = t - x / c o . He managed to determine the values of Bn in Eq. (1.3-6) as: Bn = 2  sinh[ n(1 +  ) / ] (1.3-7)

3 where  =  M k /  is the Gol'dberg number,  =  2 / 2c o is the medium absorption

coefficient,  is the shock parameter as defined in Eq. (1.3-5) and other parameters are the same as defined in Eq. (1.3-4).

13

Chapter 1: Introduction and Background ________________________________________________________________________ There are a few interesting points which are worth mentioning at this point. First, the Gol'dberg number as defined above, is equal to la/lb or ratio of absorption length to discontinuity length ( x as defined in Eq. (1.3-4)). It's also a good indicator of the waveform distortion in a lossy medium.  >> 1 means nonlinear processes will be dominant and when  is around 1.0, it means nonlinearity and dissipation are at comparable levels (Duck 2002). Second, for points where  >> n(1 +  ) (e.g. strong waves at not very far distances), the hyperbolic sine function can be substituted with its argument. Hence Eq. (1.3-7) is simplified to: Bn = 2 n(1 +  ) (1.3-8)

which are harmonic amplitudes of a sawtooth waveform. Finally at far distances (  >> 1 ), the amplitude of any harmonic can be written as: v n = v o Bn = 2c o 2c o =  k sinh[ n(1 +  ) / ] k exp[n(1 +  ) / ] (1.3-9)

Substituting  =  /(x ) in Eq. (1.3-9), yields: vn = 2co k exp[nx(1 +  ) /  ] 2c o - nx e k (1.3-10)

Assuming  >> 1 , Eq. (1.3-10) can be simplified to: vn = (1.3-11)

Since source amplitude doesn't appear in Eq. (1.3-11), the amplitude of the waveform at distance places is independent of the source. This phenomenon is referred as saturation.

Fubini (Fubini 1935) also tackled the same problem but in inviscid liquids. He determined the harmonic coefficients as:

Bn =

2 J n ( n ) n

(1.3-12)

where J n is the ordinary Bessel function.

A plot of harmonic generation as a function of distance from a monochromatic source is shown in Fig. 1-8 below:

14

Chapter 1: Introduction and Background ________________________________________________________________________
10
0

1

Normalized amplitude

2
-1

10

3 4 5

10

-2

0

0.1

0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 Propagation distance normalized to shock

Figure 1-8 Amplitude of the fundamental and four harmonics of a plane wave propagating in a lossless medium. Source: (Zemp 2000).

It's worth noting that Eq. (1.3-7) proposed by Fay will not reduce to Eq. (1.3-12) for the case of no viscosity. The reason is that Fubini solution is accurate in   1 region (close to the source), while Fay solution is valid for   3 . A solution for the transitional region has been provided by Blackstock (Blackstock 1966). Generally analytical solutions to nonlinear problems (such as those by Fay and Fubini) are limited to specific source geometries and excitations (Duck 2002). That is why numerical methods to solve the equation have found more ground over the last several years.

The classical era of nonlinear acoustic is then followed by works of Burgers (Burgers
1948), Westervelt (Westervelt 1963) , Khokhlov (Khokhlov and Soluyan 1964), Zabolotskaya (Zabolotskaya and Khokhlov 1969) and Kuzentsov (Kuznetsov 1971) in deriving more

general equations of nonlinear acoustic which will be described in section 1.3.3.

1.3.2 Coefficient of Nonlinearity
In this section we define coefficient of nonlinearity or  which is a medium property.  is the single most important parameter which can describe and account for

15

Chapter 1: Introduction and Background ________________________________________________________________________ nonlinear behavior of the sound propagation. Assuming  = 0 in nonlinear equations of acoustics will yield familiar linear counterparts.

The B/A Parameter:

In thermodynamics, pressure in a fluid can be described as a function of density and entropy which is referred to as equation of state. In a perfect gas, this relationship assumes the simple form of

 p = in isothermal conditions (which is also known as po  o

Boyle's law) and

 p = ( )  in adiabatic conditions. Although Boyle's law describes a po o

linear relation between pressure and density, in general this relation is nonlinear. Assuming P = P(  , s ) where  is the density and s is entropy, the Taylor series expansion of P yields:
P - Po =
p 1 2 p ( - o ) + (  -  o ) 2 + ... 2  0 2!  0

(1.3-13)

where Po and  o are the values for equilibrium pressure and density. All partial derivatives in Eq. (1.3-13) are also calculated around the equilibrium values of density (  o ) and entropy ( s o ). Eq. (1.3-13) can be simplified as below:

 B    C    +   p=A  + 3!     + ...  o 2!   o   o

2

3

(1.3-14)

where p = P - Po is the acoustic pressure,   =  -  o is the excess density and
A = o
p 
2 , =  o co 0 2 B = o

2 p ,  2 0

3 C = o

3 p  3

(1.3-15)
0

According to Eqs. (1.3-15), the parameter B/A is defined as:

o  2 p B/A = 2 c o  2 0
where c o is the small signal speed of sound.

16

Chapter 1: Introduction and Background ________________________________________________________________________
Importance of the B/A parameter:

B/A parameters has a physical importance as it determines the speed of sound during finite amplitude propagation. The general formula for speed of propagation is (Hamilton
and Blackstock 1998):

c2 =

p P =  s  

(1.3-16)

Taking the derivative of both sides of Eq. (1.3-14) in respect to   yields:

p 1 B    C   =A + +   o o    o  2 o Noting c 2 =

       + ...  o

2

(1.3-17)

P p 2 and A =  o c o , Eq. (1.3-17) can be written as: =  s  

B    C   c =c + + o    o  2 o
2 2 o

       + ...  o        + ...  o
2

2

or

c2 B = 1+ 2 2 co co  o

   C     + 2c 2   o o o

(1.3-18)

2 Replacing c o  o = A on the right hand side of Eq. (1.3-18) yields:

c2 B    C      = + 1 2  + 2A     + ... A  co  o  o

2

(1.3-19)

Taking the square root of both sides of Eq. (1.3-19) and using binomial expansion on the right hand side, yields:
2 c B     1  C 1  B        = 1+  + 4  A - 2  A      + ... 2A  co      o   o   2

(1.3-20)

Based on Eq. (1.3-20), the parameter B/A is a factor in determining the first order correction to the small signal speed of sound. For the case of a plane wave in linear regime, we know (Hamilton and Blackstock 1998):

 v =  o co

(1.3-21)

17

Chapter 1: Introduction and Background ________________________________________________________________________ Where v is the particle velocity. In case of a finite amplitude plane wave, Eq. (1.3-21) can be used to determine the value of

 approximately. Hence Eq. (1.3-20) can be simplified as: o
(1.3-22a)

 B  c  co +  v  2A 

It's worth noting that Eq. (1.3-22a) is the Lagrangian speed of sound or in the coordinate system which moves with an acoustic particle. Finite amplitude equations of acoustic propagation can be stated either in Eulerian or Lagrangian coordinate systems. The Eulerian coordinates are measured against a global or laboratory system of reference as opposed to Lagrangian coordinates where the system of reference is attached to an acoustic particle and moves with it. They can be related via the following equations (Lee and Wang 1993):
 q L ( a, t ) = q E ( x, t ) x = a + ( a ,t )  q ( x, t ) = q L ( a, t ) a = x - ( a ,t )   E (1.3-22b)

where q could be any acoustic field quantity, L and E subscripts represent Lagrangian and Eulerian coordinate systems respectively and  ( a, t ) is the displacement of the acoustic particle from its equilibrium position at time t.

Coefficient of Nonlinearity:

In Eulerian coordinate system, the speed of propagation can be found by adding the particle velocity to Eq. (1.3-22a). In other words:  B  c E = co +  v + v  2A  B   c E = c o + 1 + v  2A  The coefficient of nonlinearity or  is defined as: or

(1.3-23)

 = 1+

B 2A

(1.3-24)

Thus Eq. (1.3-23) can be written as:

18

Chapter 1: Introduction and Background ________________________________________________________________________ c E = co +   v (1.3-25)

Eq. (1.3-25) accounts for the effects of convection during the propagation as well. In other words,  accounts for nonlinearity induced as a result of medium as well as the convection.

1.3.3 Model Equations
In this section we'll discuss the most common equations used in modeling of finite amplitude acoustic wave propagation.

Lossless Theory:

Assuming no loss the value of entropy will be constant everywhere and pressure is a function of density only, i.e. P = P(  ) (Hamilton and Blackstock 1998). In the case of plane progressive wave propagating in one direction in homogenous media, the reduced wave equation is: q q + (c + v ) =0 t x where c = (1.3-26)

P , v is the particle velocity and q could be acoustic pressure ( P - P0 ) , 

excess density (  -  0 ) or particle velocity.  B  Based on Eq. (1.3-22), c = c o +    v and the expression c + v on the left hand side  2A  of Eq. (1.3-26) can be expressed as: B   B   c + v = co +    v = co +   v   v + v = c o + 1 +  2A   2A  (1.3-27)

where  is the coefficient of nonlinearity as defined in section 1.3.2. Substituting Eq. (1.3-27) into Eq. (1.3-26) , yields: q q + (co + v ) =0 t x (1.3-28)

19

Chapter 1: Introduction and Background ________________________________________________________________________ Eq. (1.3-28) has an implicit solution which is known as Poisson solution. Assuming q = v and for the initial value problem of v( x,0) = G ( x ) , the solution can be written as
(Cobbold 2007):

v = G{x - (  v + c o )t} v = F {t - x /(  v + c o )} Equation (1.3-28) can be rearranged as:

(1.3-29)

or for the boundary value problem of v(0, t ) = F (t ) , it assumes the form of: (1.3-30)

v -1 v = x c o (1 +  u / c o ) t

(1.3-31)

Assuming  v / c o << 1 , right side of Eq. (1.3-31) can be estimated as (Cobbold 2007):
v - 1(1 -  v / c o ) v  x co t

(1.3-32)

Eq. (1.3-32) can be simplified further by converting to a retarded time coordinate system where x  = x and  = t - x / c o . Calculating the partial derivatives of Eq. (1.3-32) in terms of new variables yields:

v  v v = 2 x  c o 

(1.3-33)

Burgers' Equation:

Burgers' equations are in essence an extension of Eq. (1.3-33) when the medium is dissipative. The equation assumes weak absorption due to viscosity and heat conduction. Khokhlov et al.(Khokhlov and Soluyan 1964) derived the following equation for plane progressive waves assuming the viscous loss as the primary mechanism of dissipation:

v( z , )  v v 4  2v 1 = 2 + 3 ( B +  ) 2 x 3  c o  2 c o  o

(1.3-34)

where  and  B are the coefficients of shear and bulk viscosity. Eq. (1.3-34) is known as Burgers' equation after the work done by Burger (Burgers 1948) in deriving a similar differential equation to describe the turbulent flow. In this paper he

20

Chapter 1: Introduction and Background ________________________________________________________________________ also points to the applicability of a similar equation to the problem of shock waves in supersonic motion of gas (Hamilton and Blackstock 1998). Fig. 1-9 below, illustrate the harmonic generation predicted by the Burgers equation in two media with different attenuation coefficients. Here source is sinusoidal with fundamental frequency of 1MHz and initial particle velocity amplitude of 0.4m/s.

dB/(cm.MHz), (b)  =1.0 dB/(cm.MHz). Source: (Cobbold 2007).

Figure 1-9. Normalized amplitudes of the fundamental and harmonics vs. normalized distance to the source. Medium parameters include:  =3.5,  0 =1000 Kg/m3, c 0 =1500 m/s and (a)  =0.3

KZK Equation:

All equations we've discussed so far are limited to the simple case of a plane wave. In an effort to derive a three dimensional equation which accounts for the effects of diffraction, nonlinearity and absorption, Kuznetsov (Kuznetsov 1971) extended the work of Zabolotskaya and Khokhlov (Zabolotskaya and Khokhlov 1969) and obtained the following equation in terms of the velocity potential:
2  2  1 (  - 1)     4 2 2 2 2 - c o   =  (  B +  )  + ( ) +    2 t  3 t 2 co  t     o

(1.3-35)

Using the paraxial approximation for directional sources, Kuzentsov showed Eq. (1.3-35) is simplified to:

 2 c o 2   1  4  2 -   = +   ) 2 + ( ) 2 + 3 (  3 B z 2   3  2c o  2c o  o

       

2

   

(1.3-36)

21

Chapter 1: Introduction and Background ________________________________________________________________________ where  2  =
2 2 + is a transverse Laplacian and  = t - z / c o is the retarded time. x 2 y 2

Taking the partial derivative of both sides of Eq. (1.3-36) in respect to  and replacing p = o

 , an equation in terms of pressure can be obtained: 
(1.3-37)

 2 p co 2   1 4 2 p p 2  -  p = 3 + ( + )    B z 2 3  2   2 c o  o    

Eq. (1.3-37) is widely known as the KZK equation after the names of the Russian scientists who developed it. As mentioned earlier, the KZK equation is based on the paraxial assumption which is valid for fairly directional beams (Duck 2002). This is particularly true for flat sources with dimensions much bigger than lambda with exception of areas close to the source or far off the axis. The Paraxial assumption also fails for sources with dimensions close to one wavelength or highly focused ones. The KZK equation has been widely used to simulate variety of medical applications including therapeutic transducers (Curra et al. 2000, Filonenko and Khokhlova 2001). The results have been validated experimentally in number of cases including plane circular sources (Baker et al. 1988, Nachef et al. 1995, TenCate 1993), circular focused fields
(Averkiou and Hamilton 1995, Baker 1992) and rectangular geometries (Baker et al. 1995).

1.3.4 Method of Fractional Steps
Christopher and Parker (Christopher and Parker 1991) used a method of fractional steps to solve the nonlinear acoustic field of axi-symmetric planar sources. In this method the effects of diffraction, attenuation and nonlinearity are applied independently over incremental steps in a marching scheme. This work is essentially an extension to the KZK equation, where the parabolic term of diffraction is replaced by a full diffraction solution. Fig. 1-10 illustrates the application of diffraction and nonlinearity operators over the propagation step of z as suggested by Christopher and Parker. Attenuation can be combined with either diffraction or nonlinear substeps.

22

Chapter 1: Introduction and Background ________________________________________________________________________

Figure 1-10. Propagation of normal particle velocity over incremental step of z . Fundamental and harmonics are propagated by applying diffraction and nonlinear operators in sequence.

Tavakkoli et al. (Tavakkoli et al. 1998), used the method of fractional steps in time domain to propagate the acoustic field of axi-symmetric sources. They implemented a secondorder operator splitting algorithm which enables larger propagations steps. This work is well suited for simulations of high amplitude short pulses generated in a lithotripter system. They also compared the results with experiment and noticed a good agreement. Zemp et al. (Zemp et al. 2003) extended the work of Christopher and Parker to general non axi-symetric sources and also made use of the second-order operator splitting method proposed by Tavakkoli et al. This was a particularly useful tool in simulation of array transducers. Williams et al. (Williams et al. 2006) extended the work of Zemp et al. by including multilayer media which accounts for reflection and refraction between layers. This work also includes a great deal of comparison between experimental and simulations which serves as a verification point of the theoretical model.

23

Chapter 1: Introduction and Background ________________________________________________________________________

1.4 Heat Transfer and Temperature
In this section an overview of the literature in the area of heat transfer and temperature predictions in tissue is presented.

1.4.1 Heat Transport
The general problem of heat transfer is addressed by making use of the first law of thermodynamics along with three heat transport relations which will be discussed here. According to the first law of thermodynamics which is a conservation of energy reinstatement, the heat transfer rate towards or from a body of mass, can be written as: Q H = mC dT dt (1.4-1)

where Q H is positive when energy flow is towards the object or negative when away from the object, T is the temperature of the object, C is the specific heat capacity and m is mass of the object (Lienhard and Lienhard V 2008).

The first heat transport relation which accounts for heat transfer due to conduction is described by Fourier's law (Fourier 1822) as below: r q = - KT (1.4-2) r where q is the heat flux in units of (W/cm2) and K is a property of the medium which is called thermal conductivity. Fig. 1-11 displays the nominal range of thermal conductivity values for various substances. For tissue it typically assumes a value between 0.1-1 W/(moC) which is in the neighborhood of water.

24

Chapter 1: Introduction and Background ________________________________________________________________________

Figure 1-11. Thermal conductivity values for different materials at room temperature (Lienhard and Lienhard V 2008)

The second heat transport equation is attributed to Newton (Newton 1701) and deals with convective heat transfer. In the steady state form, it can be written as: q = h(Tbody - T ) (1.4-3)

where q is the heat flux leaving the surface of a body with temperature of Tbody due to fluid convection at the surface. T is the temperature of the fluid passing by and h is called local heat transfer coefficient. In general h depends on the temperature difference (i.e. T = Tbody - T ), however it has been shown that h will be independent of T if the fluid is forced to pass by the body (forced convection) and T is not too large. In free or natural convection, h dependence to T is proportional to a low power of T (e.g.

T 1 / 4 or T 1 / 3 ), but if the body heat causes a liquid to boil, it will change by T 2 (Lienhard and Lienhard V 2008).
The third heat transport relation is due to radiant energy absorbed or emitted by an abject. This is described by the Stefan-Boltzmann law which is expressed as: eb (T ) = T 4 (1.4-4)

where eb is the energy flux leaving a black body, T is the object temperature (in Kelvin) and  is the Stefan-Boltzmann constant which is 5.670400 × 10 -8 W/m 2 K 4 .

25

Chapter 1: Introduction and Background ________________________________________________________________________ Contributions due to Eq. (1.4-4) in problems of heat exchange within tissue are generally negligible because of low temperatures involved. In the absence of convective and radiant heat transfer, the Eqs.(1.4-1) and (1.4-2) can be combined to yield a partial differential equation in terms of the temperature which is known as heat diffusion equation:

  KT + Q = C

T t

(1.4-5)

here Q is the heat deposition rate in W/cm3 and other parameters are the same as defined in Eqs.(1.4-1) and (1.4-2). A unique solution to Eq. (1.4-5) can be obtained if one initial condition is known as well as two boundary conditions for each dimension of the problem (Lienhard and Lienhard V
2008). However, an initial condition will not be required in a steady-state problem or

& or the boundary conditions are periodic functions of time. where q

Boundary conditions often assume three forms: i. Dirichlet or boundary conditions of the first kind: In this form, T is known on a boundary. ii. Neumann or boundary conditions of the second kind: In this form, the derivative of T normal to a boundary is known. iii. Boundary conditions of the third kind: In this form, the derivative of T normal to a boundary is linearly related to the value of T at the boundary.

1.4.2 Bio-Heat Transfer Equation (BHTE)
In tissue, convective heat transfer processes play an important role in the heat exchange problem as blood constantly circulate through the tissue. The heat diffusion equation as given in Eq. (1.4-5) does not take convective heat transfer into consideration. A more general equation which accounts for heat convection is in the form of Eq. (1.4-6) as given below (Lienhard and Lienhard V 2008):

  T r   KT + Q = C  + v  T   t 

(1.4-6)

26

Chapter 1: Introduction and Background ________________________________________________________________________ r where v is the flow velocity field and other parameters are the same as defined in Eq. (1.4-5). In 1948, Pennes (Pennes 1948) proposed a simplified model in which the convective term r of Eq. (1.4-6) (i.e. C (v  T ) ) is replaced by wbCb (T - Tb ) . The resulting equation which is widely known as bioheat transfer equation or BHTE, can be expressed as:

C

T = K 2T - wb Cb (T - Tb ) + Q t

(1.4-7)

where wb is the blood perfusion rate in kg /( m 3 .s ) which is assumed to be uniform throughout the tissue, C b is the blood specific heat capacity and Tb is the blood temperature which is assumed to be constant at 37 o C . In studying the problem of temperature distribution in the forearm, Pennes managed to find an analytical solution for Eq.(1.4-7) for a steady state cylindrical system in terms of the Bessel function of order zero assuming a homogenous tissue structure. Pennes' model has been validated by Eberhart et al. (Eberhart et al. 1980) in several other biological tissues. Wissler (Wissler 1998) in an overview of Pennes article has also confirmed a good agreement exists between Pennes' theoretical model and his experimental data. However, as Wissler points out, there are certain limitations in Pennes' work. First, the biological model used by Pennes, i.e. the forearm, is not exactly a cylindrical homogenous tissue with uniform perfusion as it contains two bones. Second, the presence of large blood vessels effects the temperature distribution and third heat exchange of smaller blood vessels which supply the capillaries alters the temperature of blood. Therefore Tb in Eq. (1.4-7) can not be a constant. Our objective is to combine equations of finite amplitude propagation of ultrasound (as discussed in section 1.3) with the bio-heat transfer equation to calculate the temperature field within the tissue. The temperature response is then used to study the process of lesion creation during HIFU exposure.

27

Chapter 2: Methodology _____________________________________________________________________

Chapter 2: Methodology
In this chapter we'll describe the methods used in implementation of the enhanced version of the code. The enhancements include arbitrary 3D source geometry and excitation definitions, full diffraction solution, enhanced acoustic pressure calculation, and enhanced power deposition rate and temperature prediction capabilities.

2.1 Method of Fractional Steps
The code is based on the method of fractional steps in which the field is calculated plane by plane in a marching scheme. The KZK equation, which accounts for combined effects of diffraction, attenuation and nonlinearity in propagation of the acoustic beam, is given in Eq. (2.1-1) below:


p co = z 2

-

2    pd +

1 3 2 co o

 4  2 p p 2     + +  B 3   2     

(2.1-1)

where p is the acoustic pressure, c o is the small signal speed of sound,  o is the ambient density,  and  B are the parameters of shear and bulk viscosity,  is the coefficient of non-linearity and  = t - z / c o . The first term on the right hand side of Eq. (2.1-1) is the diffraction term in the parabolic approximation, the second term reflects the effect of attenuation and the third term is due to nonlinearity. Eq. (2.1-1) illustrates three significant properties which provide the basis for solving the equation. First, the term
p in the left side of the equation, enables plane z

by plane calculations of pressure in incremental steps along the z axis provided the values of pressure is known on an initial plane (e.g. at z = 0 ). Second, the effects of diffraction,
28

Chapter 2: Methodology _____________________________________________________________________ attenuation and nonlinearity can be applied separately over propagation steps and then added to together. Third, the effects of attenuation and nonlinearity follow the same equations as a plane wave so the plane wave solutions can be used for the effects of attenuation and nonlinearity.

2.1.1 Second-order Operator-splitting Method
As mentioned in previous section, based on the KZK equation, the effects of diffraction, nonlinearity and attenuation can be propagated independently over small propagation steps and then the results are added together. This is referred to as operatorsplitting method. Tavakkoli et al. (Tavakkoli et al. 1998) demonstrated that following a certain propagation scheme would enable larger propagation steps while maintaining the same degree of accuracy. This is referred to as second-order operator splitting method and has been shown in Fig. 2-1 below:
D N+A D N+A

z
z
D

Figure 2-1. Second order operator splitting method

2.1.2 Diffraction Operator
The main difference between our method and implementation of the KZK equation lies in the diffraction term. The diffraction term in KZK is based on the parabolic approximation. In our method the diffraction term in the KZK is replaced by a full diffraction solution. Since there are methods which enable fast plane to plane diffractive propagation, this approach will not lead to significant increase in computational time. Full diffraction is achieved using the angular spectrum method.

29

Chapter 2: Methodology _____________________________________________________________________ In the angular spectrum method the field is propagated plane by plane. Based on this method, knowing the field distribution on a given plane, one can calculate the field profile on any other plane parallel to the first one. If the planes are perpendicular to the z axis and z is the distance between the two planes, we have (Zemp et al. 2003):
-1 s ( x , y , z + z ) =  2  2 D {s ( x , y , z )}× H (k x , k y , z )} (2.1-2) D{

where H ( k x , k y , z ) = e

2 2 jz k 2 -( k x +k y )

, k = 2 ( nf o ) / co , k x , k y are spatial frequency

components and n is the harmonic number. The term s( x, y , z ) in Eq. (2.1-2) could be any field parameter such as pressure, normal particle velocity or velocity potential. Fig. 2-2 below illustrate how this method is implemented numerically.

Figure 2-2. Numerical implementation of angular spectrum method. Source: (Cobbold 2007).

To implement this method one should know the field distribution of the initial plane. If the source is flat, this is immediately known. If the source is not flat, this can be estimated using either the Rayleigh diffraction integral on the source surface or a phase shift method which will be described in sections 2.3.2 and 2.3.4 respectively. Since N harmonics are captured at each plane, the diffractive propagation should be repeated N times to propagate each harmonic separately.

30

Chapter 2: Methodology _____________________________________________________________________

2.1.3 Nonlinearity and Attenuation Operator
After finishing with the diffractive sub-step, the results are converted to the spatial domain and a nonlinearity and attenuation sub-step is followed. Combined effects of nonlinearity and attenuation are applied in one step using the solution obtained by Harran and Cook (Haran and Cook 1983) for nonlinear propagation of progressive plane waves in lossy media. In this method a finite number of harmonics ( N ) is captured at each plane and normal particle velocity at z + z is obtained from the harmonic values of the preceding plane as below:
v n ( z + z ) = v n ( z ) + j
N 2f o  n -1  *  +  z iv v nvi v n   i n -i -i  -  o (nf o ) v n z 2  2c o i = n +1   i =1

(2.1-3)

Here, z is the propagation step,  indicates the complex conjugate, n is the harmonic number,  is the coefficient of nonlinearity, f o is the frequency of the fundamental,
c o is the small signal speed of sound,  o is the attenuation coefficient and  is the

medium power law coefficient. Eq. (2.1-3) has to be repeated N times to calculate all harmonics for each propagation step.

2.2 3D Source Definition
One of the enhancements implemented is the user ability to define any source geometry and excitation. The first part of the problem is to introduce a way to fully describe any source and the second part is to introduce a method to capture the field of an arbitrarily shaped transducer. The first part is handled though introduction of an elements matrix and the second part is solved by using the Rayleigh diffraction integral on the surface of the source. The second order operator splitting method was expanded by Zemp et al. (Zemp et al. 2003) to be able to propagate any field profiles by making use of angular spectrum method. We want to build upon this capability and extend the code to be able to handle any source configuration.

31

Chapter 2: Methodology _____________________________________________________________________

2.2.1 Elements Matrix
To be able to define any source geometry and excitation, the source is broken into several small rectangular elements as shown in Fig. 2-3 as below.

Figure 2-3. Aggregation of the source surface into small rectangular elements

Elements specifications (location and excitation) are then saved into a 16xN matrix which we call the Elements Matrix. N is the total number of small rectangular surface elements. The elements matrix contains 16 rows where each element specifications is saved as follow: 1) x component of the vector pointing to the center of the element ( xc ) , in global coordinates 2) y component of the same vector ( y c ) 3) z component of the same vector ( z c )
^ ), in global coordinates 4) x component of the unit vector in the element's X direction ( x

5) y component of the same vector 6) z component of the same vector

^ ), in global coordinates 7) x component of the unit vector in the element's Y direction ( y
8) y component of the same vector 9) z component of the same vector
^ ), in 10) x component of the unit vector in the element's Z (transmitting) direction ( z

world coordinates 11) y component of the same vector
12) z component of the same vector

32

Chapter 2: Methodology _____________________________________________________________________ 13) size of the element in the X direction ( l ) 14) size of the element in the Y direction ( w ) 15) driving amplitude ( vo ) 16) driving phase, in radians

Fig. 2-4 illustrates a single element and the associated specifications as defined above:

^ z
w

^ y
^ x

( xc , yc , zc )

l
Figure 2-4. Attributes of a surface element

Examples of source geometries created using this method have been illustrated in Fig. 25 below.

Figure 2-5. Examples of source geometries created using the element matrix. Left: spherical concave with a hole inside (blue area). Right: truncated spherical concave

33

Chapter 2: Methodology _____________________________________________________________________

2.2.2 Sub-elements
Breaking the source elements further will enable us to obtain more accuracy when the field point is close to the surface of the transducer. If this happens the program is capable of breaking the surface of each rectangular element into smaller pieces and maintaining the accuracy. These smaller elements within a surface element are called sub-elements. This is accomplished by dividing the width and length of an element into equally spaced pieces as shown in the Fig 2-6. The number of divisions is called "nse" in the program. Figure 2-6 below illustrates how a surface element is divided into 9 smaller elements for the case of nse = 3, as an example. nse =1 means the element remains intact and nse =2 will result in 4 smaller elements. This figure also demonstrates how the distances ( r  ) of a typical field point (P) from the center of sub-elements could be significantly different than the distance ( r ) between P and center of the element (O) specially when P is close to the element surface. r and r  are the most important parameters in calculating the field using Rayleigh diffraction integral which will be used to achieve a full diffraction solution.

^ z

^ y

P

r
w
A O B

r

C

^ x

l
Figure 2-6. Division of a surface element into sub-elements

To demonstrate the significance of introducing sub-elements, a flat cylindrical transducer with even excitation was simulated (see Fig 2-7). The surface of the transducer

34

Chapter 2: Methodology _____________________________________________________________________ was broken down to small rectangular elements with 0.7 × 0.7mm 2 dimensions. The pressure field was then calculated along a radial arc (dotted line in Fig. 2-7) using Rayleigh diffraction integral for two cases (nse = 1 , nse = 2). The radial path has been selected such that at  = 0 , the path passes tangentially to the surface of the transducer. In the vicinity of  = 0 , the distances of a field point to different points on the surface of a close-by element is quite varying and different from the distance of this point to the center of the element ( r vs. r  in Fig. 2-6). This will result in inaccuracies and the only way to reduce it, is by dividing each element even further into sub-elements as described previously.

y x

r =12.5mm

Roc=25mm


z

Figure 2-7. Radius of cylindrical piston r = 12.5mm, excitation frequency fs = 1MHz Radius of curvature (Roc) = 25mm

Fig. 2-8 illustrates how creating sub-elements would eliminate the computational errors in evaluating the Rayleigh integral specially in close vicinity of the source.

35

Chapter 2: Methodology _____________________________________________________________________
Normalized pressure amplitude
8 7 6 5

nse=1 nse=2

|P|/P o

4 3 2 1 0 -30 -20 -10 0 10 20 30

Theta ( C)
Figure 2-8. Significance of sub-elements in eliminating computational errors

o

2.2.3

Coordinate System Attached to an Element
As illustrated in Fig 2-6, we can define a coordinate system which is attached

^, y ^, z ^ ). As it will be demonstrated later, to be to a given surface element (defined by ( x able to calculate the distance of a field point (P) to the center of each sub-element ( r  ) , coordinates of P should be determined in this coordinate system. Coordinates of P is initially known only in the global coordinate system attached to the transducer. In this section we describe how global coordinates can be converted to those of a system attached to a surface element. Knowing the width ( w ) and the length ( l ) of each element, it's straight forward to determine the coordinates of the center of each sub-elements (e.g. A, B and C in Fig 26) in the coordinate system attached to the element. As an example the coordinates of point A in Fig 2-6 will be (
- l l / nse w w / nse + , - , 0) . If coordinates of P can be 2 2 2 2

also determined in the system attached to the element, the distance of P to the center of each sub-element ( r  ) can be readily calculated. If the coordinates of point P in global coordinate system (identified by xyz axes in Fig. 2-9 below) is ( x p , y p , z p ) , the coordinates of P in a coordinate system with its origin

36

Chapter 2: Methodology _____________________________________________________________________ at the centre of the element and axes parallel to the xyz axes will be [ x p y p z p ] - [ xc y c z c ] . The problem now is to find the coordinate of P in a new coordinate system with the same centre but rotated axes indicated by x y z  . The unit ^, y ^, z ^ ) along x y z  axes are the unit vectors attached to the surface element. vectors (i.e. x ^, y ^, z ^ are known in global coordinate system as part of the Element matrix Unit vectors x ^, y ^, z ^ in terms of global unit vectors representing the transducer surface. Expanding x r r r ( i , j , k ), yields: r r r x ^ = uxi + u y j + uz k  r r r  ^ = vxi + v y j + vz k y r r r  ^ z w i w j w k = + +  x y z  where coefficients u, v, w are all known and stored as part of the Elements matrix defined earlier in section 2.2.1. Converting these equations into matrix form, yield:
z
y

z

z
^ z
( xc , y c , z c )

^ y

r rp
^ x

P (xp , yp , zp )

y

r rc
x

r rp

x

r k
r i

r j

y

x

Figure 2-9. Systems of coordinate

37

Chapter 2: Methodology _____________________________________________________________________ r u x u y u z   i   x ^   r    ^ v x v y v z  ×  j  =  y  r  w w w  k   z ^     x y z  
u x u y u z    Assuming A = v x v y v z  , and making use of associative property of matrix w w w   x y z

multiplication, one can write:

r r  i   i   x ^ ^ x   r   r   -1 -1  ^  A ×  A×  j   = A × y ^  A×  j  = y     r r   k k ^ ^   z z              r r i  i  ^ ^ x x r  r   -1 -1 -1    ^   j = A × y ^ (A × A)×  j  = A ×  y    r r k k ^ ^ z z            
Multiplying both sides by [ x p - xc y p - y c z p - z c ] , yields:
r i  ^ x  r  -1 ^   j = A ×y  r k ^  z     

r i  ^  x  -1     r ^  [ x p - xc y p - y c z p - z c ] ×  j  = [ x p - xc y p - y c z p - z c ] ×  A × y   r   k  ^  z     ^ x r r -1  ^ rp - rc = ([ x p - xc y p - y c z p - z c ] × A )× y   ^ z   The expression [ x p - xc y p - yc z p - zc ] × A-1 is a 1 × 3 matrix which gives the r r r r r ^, y ^, z ^ . Noting rp - rc = rp (see components of vector rp - rc in terms of unit vectors x Fig. 2-9), one can determine that [ x p - xc y p - yc z p - zc ] × A-1 is the coordinates of point

38

Chapter 2: Methodology _____________________________________________________________________ ^, y ^, z ^ unit vectors or the coordinate system P in a coordinate system identified by x attached to the element.

2.3

Full Diffraction Solution

2.3.1 Initial Plane
The propagation of ultrasound begins at the surface of the source where field variables are known (boundary conditions). Since the angular spectrum method can only be applied on a plane, we need to calculate the field on a plane in front of the source which we call the initial plane. We choose this plane to be perpendicular to the z axis. The first calculation step is to propagate the field from the surface of the transducer to the initial plane. The location of the initial plane (z0) is of importance and will be discussed in section 2.3.3.

2.3.2 Rayleigh Diffraction Integral
Since our method accounts for full diffraction, it's desirable that the first propagation step would also include full diffraction. In light of this, ultrasound field on the initial plane is calculated using the Rayleigh diffraction integral.

P=

j o c o



e - ( + jk ) r vo dS  r S

(2.3-1)

where r is the distance between an infinitesimal surface element and the field point where we want to calculate the pressure (see Fig. 2-10). vo is the normal velocity at the element surface and  , c ,  ,  are medium density, speed of sound, attenuation coefficient and the wavelength respectively and k = 2 /  is the wave number.

39

Chapter 2: Methodology _____________________________________________________________________ ^ z ^ y r
P ( xp , yp , zp )

( xc , yc , zc )

^ x

Figure 2-10. Pressure at a field point is calculated by summation over all surface elements

Using Eq. (2.3-1), one can calculate the pressure at any point of a homogenous medium.

r is the only unknown in Eq. (2.3-1) above which has to be calculated for each surface
element as defined in the Elements matrix (see section 2.2.1). To calculate r , the coordinates of the field point ( x p , y p , z p ) , where the pressure is to be calculated, are converted to those of the coordinate system attached to the element. This is achieved by a matrix conversion as derived in section 2.2.3:
 y p  z p  ] = [ x p - x c y p - y c z p - z c ] × A -1 [ x p

(2.3-2)

where A is the element orientation matrix and is constructed using rows 4 to 12 of the Elements matrix as below:
Elements(4, ne) Elements(5, ne) Elements(6, ne)  A = Elements(7, ne) Elements(8, ne) Elements(9, ne)      Elements(1 0, ne) Elements(1 1, ne) Elements(1 2, ne)  

Here ne is the element column number in the Elements matrix. Note that ( xc , y c , z c ) or the coordinates of the center of the surface element in Eq. (2.3-2) is readily accessible in rows 1 to 3 of the Elements matrix. Knowing coordinates of the field point ( P ) in the coordinate system attached to the surface element, one can calculate the distance between P and centre of the surface element ( r ) or sub-elements. The pressure at any given field point can now be calculated

40

Chapter 2: Methodology _____________________________________________________________________ using Eq. (2.3-1) which will be a summation over all surface elements (or sub-elements). In other words:

 c P= j o o 

e - ( + jk ) rn ×wl v no  rn n =1
N

(2.3-3)

where N is the total number of surface elements, rn is the distance between the field point and the nth surface element, w , l are the width and the length of each surface element and all other parameters are the same as defined in Eq. (2.3-1). v no is also known through the Elements matrix and can be expressed as: v no = Elements[15, ne] × exp( j  Elements[16, ne]) (2.3-4)

The results of our simulations using this methodology will be presented in Chapter 3 section 3.1.

2.3.3 Location of the Initial Plane
One advantage of using the Rayleigh diffraction integral during the first step of propagation is that field could be propagated to any initial plane at any distance from the source, providing the effect of nonlinearity remain negligible (small signal excitation). This could potentially enhance the calculation time of the code as there's no need for any intermediate propagation planes between the source and the initial plane. This is particularly useful for focused sources where nonlinearity usually remains insignificant close to the transducer surface and then gradually increases towards the focal point. For the case of a concave spherical source (as depicted in the Fig 2-11 below) the axial

41

Chapter 2: Methodology _____________________________________________________________________
Initial plane Source

D/2

R

O

zmin

z
z0

Figure 2-11. Location of the initial plane in a concave spherical source

location of the initial plane (z0) is limited by the source edges from one side and the extent of nonlinearity from the other side. In other words:
z min < z 0 < z max where z min = z d = R - R 2 - (D / 2 )
2

( R = Radius of curvature , D = Diameter of aperture)

zmax is determined using the shock parameter. The shock parameter is a dimensionless quantity which can be used to describe the extent of nonlinear distortion in any point of the field (Hamilton and Blackstock 1998). It combines the effects of the source amplitude, geometry, frequency, propagation distance and medium properties into one single number which can then be used to determine the degree of nonlinearity or waveform distortion at any given point of the field. For a plane sinusoidal wave it's defined as below:

S =  M  k  z where  is the coefficient of nonlinearity  M = uo /co is acoustic Mach number
uo is peak particle velocity at source k = 2/ is the wave number z = distance from source

(2.3 - 5)

42

Chapter 2: Methodology _____________________________________________________________________ for spherically converging waves, Eq. (2.3-5) is replaced by:

 S =    M  k  R ln[1 /(1 - z / R )]
where R is the source radius of curvature

(2.3 - 6)

and other parameters have the same definition as in Eq. (2.3 - 5)

Based on the definition of the shock parameter,  S = 0 indicates there's no wave distortion due to nonlinearity and  S = 1 means nonlinearly-induced shock wave-front has just formed.

Fig. 2-12 below illustrates time-domain sketches of a plane sinusoidal wave at various distances from a plane source as it propagates into the medium (Cobbold 2007). The wave distortion seen here is due to the nonlinearity and happens only when the source amplitude is large enough.

Figure 2-12. Time domain waveform distortion of a plane sinusoidal wave as a result of medium nonlinearity

 S = 0 .1 is a point where the effect of nonlinearity starts becoming significant and the
wave-form starts to deviate from a linear propagation. Replacing  S = 0.1 into Eq. (2.36) yields:
 - 0.1  z max = R 1 - exp(  kR )     M

(2.3-7)

43

Chapter 2: Methodology _____________________________________________________________________ zmax determines the upper limit for the axial position of the initial plane. If the initial plane is set at an axial point greater than zmax then the field calculated on this plane is not accurate enough due to nonlinearity. Locating the initial plane on any axial point farther than zmax from source would adversely effect the accuracy of the results. As it can be seen in the Fig. 2-13, if the axial position of the initial plane is set at less than zmax, other points (e.g. A and B) on this plane will also be located at radial distances which are less than zmax from the source. Hence the effect of nonlinearity would be negligible on all points located on this plane.

Source

Initial plane

R

A

0

zmax
B

z

Figure 2-13. zmax is determined by the induced degree of nonlinearity

If the intensity of the focal spot is to be set at a certain level (e.g. 5000 W/cm2 that is a typical focal intensity in HIFU regime), it can be shown that the shock parameter of a concave spherical source (given by Eq. 2.3-6) is not affected by the frequency of the source. The reason is that the wave number ( k ) increases proportionally with frequency, while the acoustics Mach number (  M ) is inversely proportional to frequency if the intensity at focal spot is to be maintained around a certain value. This can be shown by making use of the amplitude gain of a spherical concave source. We can calculate the pressure at geometrical focal spot by applying Eq. (2.3-1) to a uniformly excited spherical cap.

44

Chapter 2: Methodology _____________________________________________________________________

P=

j o co



e - ( + jk ) r vo dS  r S

S

D/2

R

h
F

Figure 2-14. Important dimensions of a concave spherical source

Since r = R at the focal spot and we assumed a uniform excitation, both r and vo remain constant and can be taken out of the integral:

PF =

j o c o v o - ( + jk ) R e dS  R S

(2.3-8)

As seen above, the integral is simplified to sum of the surface elements which will be
S = 2Rh for the surface area of a spherical cap. Eq. (2.3-8) can then be simplified as:

jpo - ( + jk ) R ×S e R S × e-R  PF = po R PF =

(2.3 - 9) S × e -R on the right side as the R

By looking at Eq. (2.3-9) one can identify the term

pressure gain of the transducer which we call G throughout this thesis. Focal intensity ( I F ) can be obtained from PF as below: IF = 1 2  o co PF =
2

1 2  oco

po G 2 , po = oco vo
2

 IF =

1 2 2 2 2  o co vo G 2

(2.3 - 10)

Using Eq. (2.3-10), vo (normal particle velocity at source) can then be expressed in terms of the focal intensity ( I F ) :
vo =
2I F

 o coG

(2.3-11)

Using Eq. (2.3-11), acoustic Mach number of a concave spherical source can be expressed as below:

45

Chapter 2: Methodology _____________________________________________________________________

M =

2I F R 2 I F vo = = -R 2 c o  o c o G Se  o c o 2

(2.3-12)

Using  M from Eq. (2.3-12) and replace it into Eq. (2.3-6) for shock parameter, yields:

 S =    M  k  R ln[1 /(1 - z / R )]
= = =

R 2 I F 2   R  ln[1 /(1 - z / R )] 2 Se -R  oco 
2R 2 2 I F Se -R  oco
2 2

 ln[1 /(1 - z / R )] , S = 2Rh (2.3 - 13)

 o co

×

R ln[1 /(1 - z / R )] × eR × 2 I F h

As it can be seen from Eq. (2.3-13), the shock parameter is a product of medium properties (i.e.  , c,  ), geometry and the focal intensity. Fig. 2-15 below shows the variations of the shock parameter in pre-focal region for a typical HIFU transducer in water for various focal intensities:

5

x 10

-4

Shock parameter for a typical HIFU transducer 2 (R=100mm , D=125mm, If=1000-5000W/cm )

Sigma (Shock parameter)

4 3 2 1 0 80

85

90

95

100

z (mm)

Figure 2-15. Variations of shock parameter as a function of distance. R is the radius of curvature and D is the aperture diameter

As mentioned previously, Eq. (2.3-9) produces an expression for the pressure gain of a concave spherical transducer at the focal spot in linear (small signal) regime. We can

46

Chapter 2: Methodology _____________________________________________________________________ show in a specific case of a transducer with D / 2 R << 1 (slightly curved, see Fig. 2-16 ), the gain will be simplified to G =

D 2 . 4 R

Using Eq. (2.3-9) and noticing that the surface area of a spherical cap is S = 2Rh , one can write:

G=

) =  2R (1 - 1 - ( D / 2 R ) )× e =
2

S × e -R 2Rh × e -R = R R

2 R - R 2 - ( D / 2) 2 × e -R
-R

(

S

D/2

R

h
F



If D / 2 R << 1 , then 1 - ( D / 2 R ) 2 can

be simplified using the 1 ± x  1 ± approximation:
G   2R (1 - (1 - ( D 2 / 8 R 2 ) ))× e -R 2R (D / 8 R )× e-R
2 2

x 2

Figure 2-16. Definition of parameters



 D × e-R 4 R
2

(2.3 - 14)

If the attenuation is low enough (e.g. propagation in water) then the term e -R in Eq. (2.314) will be close to unity and the well known G =

D 2 formula will be resulted. The 4 R

importance of this derivation is to emphasize that for a highly focused transducer, Eq. (2.3-14) is not accurate enough and one should use Eq. (2.3-9) instead. As most HIFU transducers are highly focused, therefore we will be mostly using Eq. (2.3-7) to estimate G throughout this thesis.

2.3.4 Full Diffraction vs. Phase Shift Method
In propagating the field from the surface of the transducer to an initial plane, two methods can be used. The first method is the full diffraction solution through

47

Chapter 2: Methodology _____________________________________________________________________ application of the Rayleigh diffraction integral which was discussed earlier in section 2.3.2. Another method which is particularly used in a case of a spherically concaved transducer (Christopher and Parker 1991, Filonenko and Khokhlova 2001, Averkiou and
Hamilton 1995) is the method of introducing a phase shift or a phase factor. In this method

the nearest point on the initial plane to a surface element on the source is found and the distance of a line connecting the two ( l1 , l 2 in Fig. 2-17) is used to introduce a phase to the normal particle velocity. The phase shift method only provides an approximate solution as we know the field at a point located on the initial plane is the result of contribution of all surface elements and not only the closest element That's why the full diffraction integral is a preferred method, although it's computationally more intensive.

l1
r v n1

r r v z 1 = v n1  k

Source surface

l2 r vn 2

r r v z 2 = vn 2  k

r k

z Z axis

Initial plane

Figure 2-17. Phase shift method

In the phase shift method, the premise is that if the initial plane lies close enough to the surface of the source, the particle velocity at any given point on the initial plane is dominated by the closest surface element and can be approximated as if a plane wave is emanating from this element alone. Based on this the particle velocity amplitude at the closest point (A on Fig. 2-18) on the initial plane is the same as the normal particle velocity at the surface. However it should be noted that the normal particle velocity

48

Chapter 2: Methodology _____________________________________________________________________ amplitude on the initial plane will be a dot product of vn1.k . In terms of the phase shift, the distance travelled by the plane wave is d = l1  cos (see Fig. 2-27). Replacing

r r

r r vn1 .k cos  = r , yields: vn1

 r

l1
A

v n1

r v n1

r r v z 1 = v n1  k

d
Source surface

r k
Initial plane
Figure 2-18. How to calculate phase shift

Z direction

r r vn1 .k d = l1  cos  = l1 × r vn1
r r v n1 .k and the corresponding phase shift will be  = -2  = -2  × r .   vn1
d l1

So the normal particle velocity phasor at the initial plane can be calculated as:
2 j (1 - d ) r r  v z1 = ( v n1 .k )  e ( 2.3 - 15) r r v 1 k where d = l1 × nr and  1 = arg(v n1 ) v n1

This method described above involves some error due to the fact that the particle velocity at each point is the result of interaction of all surface elements, not only the closest

49

Chapter 2: Methodology _____________________________________________________________________ element. However contributions of the surrounding elements diminishes as the distance between the field point and the source surface approaches zero. This can be shown on the basis of the Rayleigh integral. If we assume the normal particle velocity is v n1 in region delineated by the radius of R1 and v n 2 in region between R1 and R2 and so on so forth (see Fig. 2-19), the velocity potential at point F on the z axis can be written as (Cobbold 2007):

=

1 2

 v n
S

e - j kd dS d

(2.3-16)

where S in the total area of the source.

R2 R1
dr

r

d = r2 + z2

dS
z
F

z

v n1

vn 2

Figure 2-19. Calculation of the Rayleigh diffraction integral close to the source surface.

If z is the axial distance of point F (or the vertical distance of F to source), we can substitute d = r 2 + z 2 and dS = 2r  dr into Eq. (2.3-16) to obtain:

50

Chapter 2: Methodology _____________________________________________________________________
1 F = 2
R1

r =0

v

e- jk
n1

1 2rdr + 2 2 2 r +z

r2 +z2

R2

r = R1



vn2

e- jk

r2 + z2

r2 + z2

2rdr + ...

(2.3-17)

Changing the integrand variable to u = r 2 + z 2 , Eq. (2.3-17) can be simplified to:

 F = v n1

2 R1 +z2 - j ku

u= z

e

du + v n 2
u=

2 R2 +z2 - j ku 2 R1 +z2

e

du + ...

(2.3-18)

Noting that  e - j ku du =

j 1 - j ku e = e - j ku , Eq. (2.3-18) can be written as: - jk k (2.3-19)

2 2 - j k R1 + z2  j  - j k R12 + z 2 j - j k R2 +z2 - - e - j kz  + vn2  v n1 e e e + ...      k k    r Noting v = - , normal particle velocity at point F is:

F =

vz = -

  F z e- j k = - vn1  2 2 z   R1 + z  z - jk vn 2  e 2 2   R2 + z

2 R1 +z2

 - e- j k z  -   - z
2 R2 + z2

2 R2 +z2

e

2 - j k R1 +z2

  - ...  

(2.3 - 20)

Now it can be seen that when z  0 (or when the field point moves closer to the source surface), all terms on the right hand side of Eq. (2.3-20) become zero except the term

e - jkz which becomes unity. Thus in the limit of z  0 , Eq. (2.3-20) is simplified to:
lim v z
z 0

= v n1

(2.3-21)

In other words contributions from other elements ( v n 2 , v n 3 , etc. ) would disappear in the limit. Eq. (2.3-18) can be also used to establish criteria as how close is considered enough. Obviously this would be dependant on the spatial distribution of particle velocity on the source as well.

Based on this it can be hypothesized that this method should generate accurate field parameters in a case of a slightly curved radiator as the initial plane could be placed close
51

Chapter 2: Methodology _____________________________________________________________________ to the surface of the radiator. In Chapter 3 we will put this hypothesis into test by calculating the pressure field at different depths of a concave spherical source.

2.4 Enhanced Pressure
The numerical method presented in section 2.1, calculates the normal particle velocity
v z . In other words other acoustic parameters such as pressure should be calculated using

known v z values. An easy way to convert particle velocity to pressure (or vice versa), is through simple impedance relation between particle velocity and pressure:
p = c  v z

However, this formula is only accurate for a plane wave travelling along the z axis in an inviscid medium. In more general cases, such as spherical, cylindrical or focused beams, this relation is not valid anymore and a more general formula is required. In this section we will derive accurate formulas to calculate pressure from normal particle velocity (or vice versa), which are valid within small signal approximations in any acoustic beams as long as the medium is a homogenous viscous liquid. In the method of fractional steps, v z values are only known on certain planes perpendicular to the z axis. Not knowing v z values in entire spatial domain would limit our capability to calculate acoustic variables over all spatial locations. However as it will be shown later, it is possible to derive other acoustic variables such as pressure or lateral components of particle velocity ( v x , v y ), only on the propagation planes, using angular spectrum technique. This will serve as a perfect tool to obtain pressure across a propagation plane knowing only the z component of the particle velocity. The equations are initially derived assuming no dissipation (inviscid liquid) and then expanded to a more general case with viscous loss.

2.4.1 Enhanced Pressure in Lossless Liquid
We'll start off with linearized Navier-Stokes equation in viscous liquid (Cobbold 2007):
 2 4    o 2 =  2 +    B +   ( 2 ) (2.4-1) t 3  t 

52

Chapter 2: Methodology _____________________________________________________________________ 4 Assuming no dissipation, i.e.  B +  = 0 , the Eq. (2.4-1) can be simplified to: 3

 o

 2 =  2 2 t

(2.4-2)

We also know that:



r p + .v = 0 t

(2.4-3)

Which is obtained from combining linearized state and continuity equations (Cobbold
2007) .

r Substituting v = - into Eq. (2.4-3), yields:



p -  2 = 0 t

(2.4-4)

Substituting  2 from Eq. (2.4-2) into Eq. (2.4-4): p  2 -  o 2 = 0  t t Integrating both sides of Eq. (2.4-5) in time, yields: p = o  t (2.4-6) (2.4-5)

Eq. (2.4-6) is only valid when there's no energy loss in the medium. Assuming a sinusoidal excitation,  will be also sinusoidal in time and can be expressed as:

 ( x, y , z , t ) = Re{  s ( x, y , z )  e jt }

(2.4-7)

Where  s is a phasor presentation of  and it's a complex function in space. Using the expression of  in Eq. (2.4-7) and replace it into Eq. (2.4-6), yields: p = o     =  o Re{  s  e jt } =  o Re ( s  e jt ) t t   t

Since  s is only a function of space, it can be taken out of the partial derivative in time:
  (e jt ) p =  o Re s   s  je jt }= Re{j o s  e jt }  =  o Re{ t  

In other words, P = j o s is the phasor presentation of p . Consequently one can write:

53

Chapter 2: Methodology _____________________________________________________________________

s =

-j

 o

P

(2.4-8)

Similarly we can find a phasor relation between  s and V z as follows:

r  v = -  v z = - z

(2.4-9)

Substituting  from Eq. (2.4-7) into Eq. (2.4-9), yields: vz = -    Re{  s  e jt } = - Re ( s  e jt ) z  z 

Since e jt is only a function of time, it can be taken out of the partial derivative in space:       v z = - Ree jt  s  = Re- s  e jt  z    z  in other words, Vz = -  s z (2.4-10)

where V z is the phasor presentation of v z . Using the expression of  s obtained earlier in Eq. (2.4-8) and replace it into Eq. (2.4-10):
Vz = -  -j  j P  P =   z   o   o z

or

V z ( x, y , z ) =

 P( x, y , z )  o z j

(2.4-11)

Taking the 2D Fourier transform of both sides of Eq. (2.4-11) in respect to x, y : SVz ( k x , k y , z ) =  SP( k x , k y , z )  o z j (2.4-12)

On the other hand from the angular spectrum analysis we know (Liu and Waag 1997): SP( k x , k y , z ) = SP( k x , k y ,0) × H ( k x , k y , z )
2 2 ) + ky Where H ( k x , k y , z ) = exp jz k 2 - (k x

(2.4-13)

(

)

Differentiating both sides of Eq. (2.4-13) in respect to z, yields:
  SP( k x , k y , z ) = SP( k x , k y ,0) × H ( k x , k y , z ) z z

2 2 ) × H (k x , k y , z) = SP( k x , k y ,0) × j k 2 - (k x + ky

(2.4 - 14)

54

Chapter 2: Methodology _____________________________________________________________________ Substituting Eq. (2.4-14) into Eq. (2.4-12): SV z ( k x , k y , z ) = -1
2 2 ) × H (k x , k y , z ) SP( k x , k y ,0) × k 2 - (k x + ky

 o

(2.4-15)

Replacing z = 0 in Eq. (2.4-15) and noting H ( k x , k y , z = 0) = 1 : SP( k x , k y ,0) =
2 2 ) k 2 - (k x + ky

-  o

SVz ( k x , k y ,0)

(2.4-16)

Based on Eq. (2.4-16), knowing the normal particular velocity over a plane perpendicular to z axis, one can calculate the pressure over the same plane, as below:   -  o  -1  P( x, y ) =  2 { V ( x , y ) }    D 2D z 2 2 2 ( ) k k k - +   x y   where k x = 2f x , k y = 2f y are spatial frequency components. Going forward we call P( x, y ) derived using Eq. (2.4-17), "enhanced pressure". This terminology enables us to differentiate it from the pressure obtained using the impedance relation. The impedance formula of P =  o c oV is only accurate for a plane wave, nevertheless it's often used to derive the pressure in more general cases such as focused sources which is only an approximation. Eq. (2.4-17), however, is valid for any field distribution and source geometry. Thus it serves as an ideal tool in our program to calculate pressure where source geometry is arbitrarily defined by user. (2.4-17)

In a case of a plane wave, Eq. (2.4-17) reduces to the familiar impedance relation between pressure and velocity as below: For a plane wave V z ( x, y ) = Vo , where Vo is a constant. As a result 2D Fourier transform of Vz ( x, y ) is a Dirac impulse function: 2 D { Vz ( x, y )} = Vo ×  ( f x , f y ) = Vo ×  ( kx ky , ) = Vo × 4 2 ( k x , k y ) 2 2 (2.4-18)

Substituting Eq. (2.4-18) into Eq. (2.4-17) and noting that the  ( k x , k y ) is zero everywhere except at k x = k y = 0 :

55

Chapter 2: Methodology _____________________________________________________________________  -1  -  o P( x, y ) =  2 ×Vo × 4 2 ( k x , k y ) D 2   k  -1  -  o = 2 ×Vo × 4 2 ( k x , k y ) D   / co  -1 2 =  2 D {-  o c o ×Vo × 4  ( k x , k y )} Conversely, the inverse 2D Fourier transform of a delta function is a constant in space:
-1 P( x, y ) =  2 -  o c o × Vo ×  ( f x , f y )} D{

= -  o c o × Vo

(2.4 - 19)

which is the well known impedance relation. Negative sign in Eq. (2.4-19) originates from the assumption made in Eq. (2.4-7) where

 as a function of time was defined as:
 ( x, y , z , t ) = Re{  s ( x, y , z )  e jt }
If we choose  ( x, y , z , t ) = Re{  s ( x, y, z )  e - jt } (note the minus sign in the power of

e - jt ), the negative sign in (2.4-19) will disappear. Eq. (2.4-19) describes a plane wave
moving to the negative z direction. It appears that selecting

 ( x, y , z , t ) = Re{  s ( x, y, z )  e - jt } define a wave propagating toward the positive x,y,z
directions and selecting  ( x, y , z , t ) = Re{  s ( x, y , z )  e jt } would define a wave propagating towards the negative x,y,z directions. Another particularly interesting case to consider is when particle velocity distribution on a given plane is sinusoidal as below: Vz ( x, y ) = Vo cos(k1 x + k 2 y ) Assuming Vo is a constant, this will represent a phase cohered excitation throughout a given plane where the amplitude varies in a sinusoidal order. Fig. 2-20, illustrates how amplitude distribution along a given plane looks like:

56

Chapter 2: Methodology _____________________________________________________________________

Figure 2-20. Spatial distribution of the sinusoidal signal V z ( x, y ) = Vo sin( 2u o x + 2v o y ) ,

0  x, y  1 , for various spatial frequencies of uo , v o . Source: (Prince and Links 2006).
The 2D Fourier transform of Vz ( x, y ) will be: 2 D { V z ( x, y )} = Vo × 4 2 × 1 [ (k x - k1 , k y - k 2 ) +  (k x + k1 , k y + k 2 )] 2 (2.4-20)

Which includes two impulse functions at points ( k1 , k 2 ) and ( - k1 ,- k 2 ) on spatial frequency domain as shown in Fig. 2-21. Substituting Eq. (2.4-20) into Eq. (2.4-17) yields:   -  o 1  -1  2 [ ] × × - - + + + P( x, y ) =  2 V 4   ( k k , k k )  ( k k , k k )  D o x 1 y 2 x 1 y 2 2 2 2 2    k - (k x + k y )  Separating the two delta functions:   -  o 1  2 -1  [ ] × × - - P( x, y ) =  2 V 4   ( k k , k k ) + D o x 1 y 2 2 2 2 2 ( ) - + k k k   x y     -  o 1  -1  2 [ ] V 4   ( k k , k k ) 2 × × + + D o x 1 y 2  2 2 2 2    k - (k x + k y )  57

Chapter 2: Methodology _____________________________________________________________________

ky

( - k1 ,- k 2 )

U

r=k

U

kx

( k1 , k 2 )

Figure 2-21. Location of impulse functions in k space

Noting that the delta functions in expression of P( x, y ) above are zero everywhere except at points ( k1 , k 2 ) and ( - k1 ,- k 2 ) , one can write:
  -  o 1  -1  P( x, y ) =  2 Vo × 4 2 × [ ( k x - k1 , k y - k 2 )] + D 2 2 2 2     k - (k1 + k 2 )   -  o 1  2 -1  [ ] V 4   ( k k , k k ) 2 × × + + D o x 1 y 2  2 2 2 2     k - (- k1 ) + (- k 2 )

(

)

or
  -  o 1  -1  P( x, y ) =  2 Vo × 4 2 × [ ( k x - k1 , k y - k 2 ) +  ( k x + k1 , k y + k 2 )] D 2 2 2 2    k - (k1 + k 2 ) 

which yields

P( x, y ) =

2 ) k 2 - (k12 + k 2

-  o

Vo cos(k1 x + k 2 y ) =

2 ) k 2 - (k12 + k 2

-  o

V z ( x, y )

(2.4-21)

In other words pressure will have the same spatial distribution as particle velocity however with different amplitude than what simple impedance relation predicts. The maximum pressure amplitude can be written as:

58

Chapter 2: Methodology _____________________________________________________________________ Pm =
2 ) k 2 - (k12 + k 2

 oVo

=

co  oVo
2   k12 + k 2  1-  2   k  

(2.4-22)

For a plane wave k1 = k 2 = 0 and Eq. (2.4-22) reduces to the familiar impedance relation.
2 < k 2 , the maximum pressure amplitude is bigger than what However for 0 < k12 + k 2 2 > k 2 , it gradually decreases. Fig. 2results from the impedance formula, and for k12 + k 2

22 illustrates the actual pressure amplitude relative to the impedance pressure:

Figure 2-22. Deviation from plane wave approximations becomes obvious at higher spatial frequencies

This is a very good indicator as how impedance relation (to convert particle velocity to pressure) can be significantly in error for non planar fields. Note that if
2 k12 + k 2 = k , the pressure amplitude becomes infinity in theory. An example

which gives rise to infinite pressure amplitudes is V z ( x, y ) = Vo cos( kx ) which satisfies
2 k12 + k 2 = k relation. Noting k = 2 /  , it means if particle velocity amplitudes vary

with period of  in spatial domain then the pressure amplitudes will amplifies out of control. In practice, however, this will never happen as attenuation and nonlinearity processes suppress the pressure amplitude, but it still remains elevated.

59

Chapter 2: Methodology _____________________________________________________________________

2.4.2 Computational Noise in Enhanced Pressure
2 2 + ky = k 2 which constitutes a circle with radius k in Eq. (2.4-17) has a singularity at k x

the spatial frequency domain (k space). Following Zemp et al. terminology (Zemp et al.
2003), we will be referring to this as radiation circle in what follows (see Fig. 2-23).

ky
Radiation Circle
r=k

kx

Figure 2-23. Particle velocity to pressure transfer function has a singularity on the radiation circle

The presence of this singularity results in computational problems. In Matlab® it can cause the program to fail to generate the inverse Fourier transform specially if 2D Fourier transform of Vz ( x, y ) has large enough components around the radiation circle. Another issue is that it will create computational noise in the output (i.e. P( x, y ) ). This noise spreads all over the spatial domain, however its effect is more significant where the signal amplitude is weaker which results in lower SNR value. An example of this is far off-axis loci in a focused source where the pressure amplitude falls abruptly. There are two methods to eliminate the problems mentioned above associated with the singularity in the transfer function of V z to P . One way is to implement a filter around the radiation circle. The filter transfer function should drop to zero at the radiation circle. Another method (which will be discussed later) is to introduce a small attenuation within the medium. As we will see in section 2.4.3, the singularity disappears in the transfer

60

Chapter 2: Methodology _____________________________________________________________________ function of V z to P if the medium is dissipative. In other words the assumption of a lossless medium gives rise to this singularity. In real world where attenuation always exists, V z to P transfer function won't include a singularity.

Computational Noise and Distance from the Source:

It's noteworthy that the noise amplitude is more pronounced close to the transducer surface and gradually diminishes farther away. The reason is that field variations are much smoother farther away from the transducer. As a result the field spectrum in spatial frequency domain will form a narrow band around (0 , 0) as one move away from the transducer surface. This implies that spatial frequency components at or around radiation circle gradually decrease in amplitude and this will in turn subside the noise amplitude. To demonstrate this more fully, a transducer will seem like a spot for field points far away from its surface (see Fig. 2-24). Consequently the field will be similar on the surface of a sphere centered at the transducer as all points are located at the same distance from the transducer. This can be shown by applying the Rayleigh diffraction integral as below:
e - jkr vn dS  r S

=

1 2

1 e - jkr = 2 r

 v dS
n S

(2.4 - 23)

Where S is the surface of the source (i.e. transducer), v n is the normal particle velocity on the transducer surface and R is the radius of the sphere. Since  v n dS is constant (it's a property of the source), based on Eq. (2.4-23), the field
S

everywhere on the sphere is the same.

Now if we look at Plane 1 versus Plane 2 in Fig. 2-24, it's obvious the field on plane 2 will vary less than plane 1, as it falls closer to the corresponding sphere. To demonstrate this quantitatively, we'll use Eq. (2.4-23) to calculate the field at point A.

61

Chapter 2: Methodology _____________________________________________________________________

Plane 1

Plane 2 A

U

R +x
2

2

x

r

y
Tx

R

Figure 2-24. Field variations subside considerably father from the transducer surface

Substituting r = R 2 + x 2 in Eq. (2.4-23) yields: 1 e - jk R + x × So  ( A) = 2 R 2 + x 2
2 2

Calculating the derivative of  ( A) , with respect to x:
2x  e - jk - jk ×  2 2 d ( A) S o R +x  = dx 2  R2 + x2  
R2 + x2

+

(R

2x × e
2

- jk R 2 + x 2

+ x2 )

   R2 + x2   

Simplifying the above expression and noting R >> x :
2 x - jkR   jk e - × - jkR  2 d  ( A) S o  x e × R  +   3 dx R 2  R    S 2x  1 = o e - jkR × 2  - jk +  2 R R 

62

Chapter 2: Methodology _____________________________________________________________________ Since k = 2



>>

1 1 , - jk +  - jk and: R R (2.4-24)

jkS o - jkR x d ( A) e - × 2 dx  R

It can be seen from Eq. (2.4-24) that field variations drop by inverse square of R .

Reduction of Computational Noise by Filtering:

As mentioned earlier, an effective way to reduce the computational noise is by filtering the normal particle velocity spectrum ( V z ( k x , k y ) ) in spatial frequency domain around the radiation circle. The filter would depress the spatial frequency components of normal particle velocity around the radiation circle and hence reduces the amplitude of spikes generated due to the singularity in transfer function. This will translate into less amount of noise in spatial domain. The filter transfer function has shown in Fig. 2-25 below. This type of filter is normally referred to as a band stop or notch filter since it only blocks a certain band of frequencies. In this case it selectively filters out a band in vicinity of the radiation circle with radius of
k = 2 /  .

F ( )

bs
1

k

2 2  ( kx + ky )

k - b

k - bm

k + bm

k + b

Figure 2-25. Band stop filter

The filter has four distinct bands which are realized as below: 63

Chapter 2: Methodology _____________________________________________________________________ 1 + cos 2 ,   k - b or   k + b , k - b <  < k - bm , k - bm    k + bm , k + bm <  < k + b

F ( ) =

0   - ( k - b )  bs  where  =    ( k + b ) -   bs 

To calculate the pressure, 2D Fourier transform of the normal particle velocity is calculated and then multiplied by F ( k x , k y ) ×
2 2 ) k 2 - (k x + ky

- o

. The inverse 2D Fourier

transform of the product, would give us the spatial distribution of pressure as below:

  -  o  -1  ×  P( x, y ) =  2 F ( k , k ) { V ( x , y ) }  D x y 2D z 2 2 2 ( ) - + k k k   x y  

In Chapter 3, we will present the results of our simulations where examples of computational noise caused by singularity in Eq. (2.4-17) are provided. We will also demonstrate that noise amplitude is subsided as a result of filtering or by moving farther away from the transducer surface.

2.4.3 Enhanced Pressure In Viscous Liquid
To derive the transfer function for converting normal particle velocity to pressure in section 2.4.1, we assumed no attenuation. In this section we will be deriving a generalized equation to include viscous loss in the medium and then extend it to include propagation in tissue as well.

In a viscous liquid, the linear wave equation is:

64

Chapter 2: Methodology _____________________________________________________________________

 o

 2 4   =  2 +    B +   ( 2 ) 2 3  t t 

(2.4-25)

For a sinusoidal excitation, velocity potential  is sinusoidal too and can be written as:

 ( r , t ) = Re{  s ( r )  e jt }
r r r Where  s ( r ) is a complex function in space.

(2.4-26)

Substituting Eq. (2.4-26) into Eq. (2.4-25) yields:
 2  r  o Re 2 (s ( r )  e jt ) =  t  4   r r   Re{  2 (s ( r )  e jt )}+    B +   Re ( 2 (s ( r )  e jt ))  3   t   r 2 jt  o Re{ s ( r ) × - e }= 4   r r   Re{e jt ×  2 s ( r )}+    B +   Re (e jt ×  2s ( r ) )  3   t   r jt 2 Re{e × - o s ( r )}= 4  r r  Re{e jt ×  2 s ( r )}+    B +   Re{je jt ×  2s ( r )}  3   4   r r Re{e jt × (-  o 2s ( r ) )}= Ree jt ×  2s ( r )1 + j (  B +  )  3    (2.4 - 27)

For Eq. (2.4-27) to hold true for all values of t , complex expression of
r r 4  -  o 2 s ( r ) on the left hand side has to be equal to  2 s ( r )1 + j (  B +  )  on 3  

right hand side, for all points in space. To prove this point, lets assume there exists two complex numbers u and v such that for all values of t : Re{e jt × u} = Re{e jt × v} Substituting u = u x + ju y and v = v x + jv y , yields:

65

Chapter 2: Methodology _____________________________________________________________________ Re{e jt × (u x + ju y )} = Re{e jt × (v x + jv y )}  Re{(cos t + j sin t ) × (u x + ju y )} = Re{(cos t + j sin t ) × (v x + jv y )}  Re{(u x cos t - u y sin t ) + j (u y cos t + u x sin t )} =

Re{(v x cos t - v y sin t ) + j (v y cos t + v x sin t )} 

u x cos t - u y sin t = v x cos t - v y sin t 

(u x - v x ) cos t = (u y - v y )sin t (u x - v x ) - (u y - v y ) tan t = 0


(2.4 - 28)

For Eq. (2.4-28) to be valid for all times , both coefficients have to be zero: ux - vx = 0  ux = vx uy - vy = 0  uy = vy In other words u has to be equal to v . Thus Eq. (2.4-27) can be written as:

r r 4  -  o 2 s ( r ) =  2 s ( r )1 + j (  B +  )  3  
Which can be re-arranged as:

r  2 s ( r ) +

 o 2
4   1 + j (  B +  )  3  

s (r ) = 0

r

(2.4-29)

Using c o = 1 /  o formula for small signal speed of sound, where  o is ambient density
2 and substituting  = 1 /( co  o ) and k =  / co in Eq. (2.4-29), the following equation is

resulted:
r r 2  2s ( r ) + k s ( r ) = 0

(2.4-30)

66

Chapter 2: Methodology _____________________________________________________________________
4 This is the famous homogenous Helmholtz equation, where k = k / 1 + j (  B +  ) 3

is called complex wave number. In case of a lossless inviscid medium, k will be equal to
k (the regular scalar wave number).

For a plane wave propagating along z direction,  s is only a function of z and Eq. (2.430) can be immediately solved as below:

 2s 2 + k s = 0 2  z

 s = oe- j k z

(2.4-31)

4 Replacing 1 + j (  B +  ) = re j , in expression for k , one can find: 3 k = k /( re j )1 / 2 = k - j / 2 k (cos( / 2) - j sin( / 2)) e = r r (2.4-32)

Replacing k obtained in Eq. (2.4-32) into Eq. (2.4-31), yields:

 s = o e

-j

k r

cos( / 2 ) z

e

-

k r

sin( / 2 ) z

(2.4-33)

Using Eq. (2.4-33) and noting k =  / c o , one can calculate both the amplitude attenuation coefficient and the phase speed as below:

 ( ) =

 k sin( / 2) = sin( / 2) r co r

(2.4-34)

c( ) =


k cos( / 2) r

=

co r cos( / 2)

(2.4-35)

Both r and  increases by frequency. As a result, both quantities given in Eq. (2.4-34) and Eq. (2.4-35) increase by frequency. In other words a direct outcome of solving the Helmholtz equation is prediction of frequency dependant attenuation and phase speed. The phenomenon of phase speed variation with frequency is called dispersion and as it can be seen here it's a direct result of attenuation in the medium. In a lossless medium, r = 1 and  = 0 , which results in c( ) = c o (Eq. 2.4-35) or no dispersion.

67

Chapter 2: Methodology _____________________________________________________________________ Using Helmholtz equation (Eq. (2.4-30)) , and the linearized continuity and state equations, one can derive a relation between V z and P which accounts for viscous loss. It's worth noting that Eq. (2.4-11) which was derived earlier is only valid in a lossless medium. Here we would like to derive a more general relation between V z and P when viscous loss is present. The general relation which relates the pressure and particle velocity is derived by combining the equation of state and the continuity equation (Cobbold 2007). In small signal approximation, this will result in:
r p + .v = 0 t r Substituting v = - into Eq. (2.4-36), yields:



(2.4.36)



p -  2 = 0 t

(2.4-37)

Assuming a continuous sinusoidal excitation, Eq. (2.4-37) can be written as:

 Re{P  je jt }- Re{e jt   2  s } = 0 
Re{e jt ( jP )} = Re{e jt ( 2  s )}

 Re{P  e jt }-  2 Re{  s  e jt } = 0  t    2 ( s  e jt )} = 0   Re (P  e jt ) - Re{  t 



(2.4 - 38)

As mentioned earlier, for Eq. (2.4-38) to be valid for all values of t , one should have: jP =  2 s (2.4-39)

Using Helmholtz equation in viscous medium which was derived earlier (Eq. (2.4-30)):
 2 s + k  s = 0   2 s = - k  s
2 2

(2.4-40)

Substituting -  2s from Eq. (2.4-40) into Eq. (2.4-39), yields:
jP = - k s
2

68

Chapter 2: Methodology _____________________________________________________________________ or

s = - j


k
2

P

(2.4-41)

Note that for an inviscid liquid with no dissipation, k = k and Eq. (2.4-41) reduces to Eq. (2.4-8) as expected. Substituting  s from Eq. (2.4-41) into Eq. (2.4-10), yields:
s      P  Vz = -  - j 2 P = j 2    z z  k k z    Vz ( x, y , z ) = j 2 P( x, y , z ) k z
Vz = -

(2.4 - 42)

Taking the 2D Fourier transform of both sides of Eq. (2.4-42) in respect to x, y : SVz ( k x , k y , z ) = j

 
2 k z

SP( k x , k y , z )

(2.4-43)

On the other hand from the angular spectrum analysis we know:
SP( k x , k y , z ) = SP( k x , k y ,0) × H ( k x , k y , z )   2 2 2  + ky where H ( k x , k y , z ) = exp )  jz k - ( k x     (2.4 - 44)

Differentiating both sides of Eq. (2.4-44) in respect to z, yields:
  SP( k x , k y , z ) = SP( k x , k y ,0) × H ( k x , k y , z ) z z
2 2 = SP( k x , k y ,0) × j k - ( k x + ky ) × H (kx , k y , z) 2

(2.4 - 45)

Combining Eq. (2.4-43) and Eq. (2.4-45), one can obtain: SV z ( k x , k y , z ) =

-  2 2 2 SP( k x , k y ,0) × k - ( k x + ky ) × H (k x , k y , z) 2 k

(2.4-46)

Replacing z = 0 in Eq. (2.4-46) and noting H ( k x , k y , z = 0) = 1 :
SP( k x , k y ,0) = SVz ( k x , k y ,0) × -k
2 2 2 x 2 y

 k - ( k + k )

(2.4-47)

69

Chapter 2: Methodology _____________________________________________________________________ In a lossless liquid, k = k and Eq. (2.4-47) reduces to Eq. (2.4-16) which was derived earlier in section 2.4.1 for an inviscid liquid. It's interesting to note that Eq. (2.4-47) unlike Eq. (2.4-16) will not have a singularity if medium is dissipative. The reason is that in a viscous medium k has an imaginary part and the expression
2 2 k - (k x + ky ) in the denominator will not be zero. However the 2

transfer function of Eq. (2.4-47) still has the potential to create noise in numerical
2 2 + ky , the amplitude of the methods. When the real part of k is cancelled by k x

2

remainder is usually small enough to create high amplitude hikes around the radiation circle. As mentioned earlier for a plane wave propagating along z direction, homogenous Helmholtz equation yields:

 2s 2 + k s = 0 2  z

 s = oe- j k z

(2.4-48)

Since k is a complex number, it can be seen from Eq. (2.4-48) that
k = k - j

(2.4-49)

where k is the regular wave number and  is the attenuation coefficient of the medium. Utilizing Eq. (2.4-49) into Eq. (2.4-47), one can solve for SP( k x , k y ) and use the inverse Fourier transform to find the pressure distribution (i.e. P( x, y ) ).

Substituting Eq. (2.4-49) into the right hand side of Eq. (2.4-47), yields:
-k
2 2 2  k 2 - ( k x +ky )

=

- ( k - j ) 2
2  ( k - j ) 2 - ( k x2 + k y )

=

- ( k 2 -  2 - 2kj )
2 2 +ky  ( k 2 -  2 - 2kj ) - ( k x )

(2.4 - 50)

2 2 Assuming k 2 = k x (i.e. points on the radiation circle) and noting that for most + ky

liquids  << k , Eq. (2.4-50) can be simplified to:

70

Chapter 2: Methodology _____________________________________________________________________

-k

2

2 )  k 2 - ( k x2 + k y

=

- ( k 2 - 2kj )  - 2kj
1

(2.4-51) co  o , Eq. (2.4-51) can be further simplified to: k (2.4-52)

Noting that

- 2 j = -1 + j and



=

-k
2

2 2 x 2 y

 k - ( k + k )

= co  o

- ( k - 2 j ) k × ( -1 + j )

Multiplying (1 + j ) to both nominator and denominator of Eq. (2.4-52):

-k
2

2 2 x 2 y

 k - ( k + k )

= co  o

- ( k - 2 j )(1 + j ) k + 2 + j ( k - 2 ) = co  o 2 k k × -2

(2.4-53)

Reminding that for most liquids  << k , Eq. (2.4-53) can be written as:
-k
2 2

2 2 + ky )  k - ( k x

 c o  o (1 + j )
on radiation circle

k



(2.4-54)

Assuming Vz ( x, y ) = Vo cos(k1 x + k 2 y ) is the particle velocity distribution on a given plane. Having V z ( x, y ) , one can use Eq. (2.4-47) to calculate the pressure distribution on the same plane. In other words:
  2 -k  -1  { }  × P( x, y ) =  2 V x y ( , )  D  2D z 2 2 2 ( ) - +  k k k   x y  

(2.4-55)

Fourier transform of Vz ( x, y ) = Vo cos(k1 x + k 2 y ) consists of two impulse functions located at ( k1 , k 2 ) and ( - k1 ,- k 2 ) . Based on Eq. (2.4-55) the impulse function amplitudes are multiplied by
-k
2 2 2 1 2 2 2 . If we choose k1 and k 2 so that k12 + k 2 = k 2 , both

 k - ( k + k )

( k1 , k 2 ) and ( - k1 ,- k 2 ) will be located on the radiation circle and we can use Eq. (2.4-54)

to write:
-k
2 2 2 1 2 2

 k - ( k + k )

 co  o (1 + j )

k



(2.4-56)

71

Chapter 2: Methodology _____________________________________________________________________ Substituting Eq. (2.4-56) into Eq. (2.4-55) and taking the inverse Fourier transform yields:
P( x, y ) = Vo co  o (1 + j ) k



cos( k1 x + k 2 y )

(2.4-57)

Note that if a simple impedance approximation has been used we would have obtained: P( x, y ) = Vo co  o cos(k1 x + k 2 y ) In other words, a full diffraction solution predicts a gain of
2k



in pressure amplitude.

Since for many liquids k >>  , a significant pressure elevation is resulted. For instance in water k = 2 /  = 4188 m -1 and  = 0.02 np/m at 1 MHz, which will result in
2k



= 647 . However in tissue which is much more attenuative, this will result in lower

pressure gains. In kidney for example where k = 2 /  = 4027m -1 and  = 11.51 Np/m at 1 MHz,
2k



equals to 26.

The calculated gain of 647 in water is large enough to produce noise in numerical implementations of the enhanced pressure formula (Eq. (2.4-55)) due to sampling across k x , k y space. In Chapter 3, where results of our simulations using Eq. (2.4-54) is presented, higher noise levels in water compared to tissue will be demonstrated.

2.5 Source Presentation in Spatial Frequency Domain
As mentioned in section 2.3.1, the first step in calculating the field is to propagate the field from the surface of the transducer to a plane close-by which we called the initial plane. The reason behind this is that the angular spectrum method can be only applied to planes while the source geometry in general can presume any shape. This step is done using the Rayleigh diffraction integral as the phase shift methods produce inaccurate

72

Chapter 2: Methodology _____________________________________________________________________ results in near field specially for highly curved surfaces such as a typical HIFU transducer 1 .

2.5.1 Pressure Calculation Across Initial Plane
The pressure is calculated across the initial plane using the CW version of the Rayleigh diffraction integral: P= j o co e - ( + jk ) r  vn r dS Source



(2.5-1)

In Eq. (2.5-1)  o and c o are the equilibrium density and speed of sound,  is the wavelength,  is the medium attenuation coefficient, and k = 2 /  , which are all constants. The integral is done over all surface elements of transducer, where dS is the surface area of any given element, v n is the normal particle velocity phasor at that element and r is the distance between the element center and the field point where we're interested in calculating the pressure.

2.5.2 Spatial Extent of the Initial Plane
The spatial extent of the initial plane is set by the user via parameters "x_source" and "y_source" in the parameters file . Parameters file is a Matlab file (.m file) where all parameters used in the simulation are defined. The source spatial extent has to be selected so that the initial plane captures most of the energy emitted by the source. x_source and y_source are determined based on the distance of the initial plane to the transducer. For example in Fig. 2-26 below, if the initial plane is located at z = zmin (as close to the transducer as possible), the selection of x_source = y_source = D/2 would ensure most of the energy emitted by the source is captured.

1

See Chapter 3, section 3.2, for more details

73

Chapter 2: Methodology _____________________________________________________________________ Initial plane Source y
D/2

+y source

z
O

zmin

z0

Roc

-y source

Figure 2-26. Spatial extent of the initial plane

2.5.3 Spatial Sampling of the Initial Plane
The pressure is calculated using Eq. (2.5-1) at equally spaced discrete points on the initial plane. If initial plane is to be placed close to the transducer surface, the spacing should be done at least at the rate of  / 10 . This is due to variation of r in Eq. (2.5-1). Fig. 2-27 below illustrates how the pressure varies more rapidly in near filed. If we are to calculate the pressure due to surface element S1 at points P1 and P2 located very close to the transducers surface, then we can see that r1 - r2 = d . In other words P1 and P2 will have different pressures (due to S1) unless d <<  . However the pressure due to the surface element S1 at points P3 and P4 separated by the same distance in the far field ( l >> d ) is almost equal since it can be easily shown that lim(r1 - r2 ) l  = 0 .

74

Chapter 2: Methodology _____________________________________________________________________ Transducer surface
U

P1

U

P3

d

r1 r2

r1
U

d
P4

U

P2

S1

r2

l
Figure 2-27. Pressure variations are more rapid close to the transducer surface

The sampling interval across the initial plane is set by the user through a parameter called "Width" in the parameter file. For general non axi-symmetric sources, sampling should be done across the entire extent of the initial plane as shown in Fig. 2-28 below:

y

x
Width

Figure 2-28. Pressure is calculated at the intersection of solid lines

However, for axi-symmetric sources, it can be done only across the points along the x axis which is computationally less extensive and then based on the values of pressure

75

Chapter 2: Methodology _____________________________________________________________________ calculated along the x axis, pressure at other points on the plane can be estimated. In axisymmetry sources, the acoustic field would form equi-pressure circles as shown in Fig. 229. The pressure on these circles will be the same as what calculated at their x intersection. We will then use interpolation to find the pressure of any point falling in between these circles.

y

x

Figure 2-29. Equi-pressure circles in an axis-symmetric source

2.5.4 Pressure to Normal Particle Velocity Conversion
After calculating the pressure field on the initial plane, we need to find the normal particle velocity at the same points. This step is required because the NLP code propagates the normal particle velocity and not the pressure. There are two methods available to convert from pressure to normal particle velocity. The first method is to use the relation between pressure and the normal particle velocity in spatial domain as given in Eq. (2.5-2): Vz ( x, y , z ) = j

 
k z
2

P( x, y , z )

(2.5-2) 2

The second method is through angular spectrum approach where the conversion is done in spatial frequency domain:

2

Refer to section 2.4.3 for derivation.

76

Chapter 2: Methodology _____________________________________________________________________
SP( k x , k y ) = SVz ( k x , k y ) ×

 k - (k + k
2 2 x

-k

2 2 y

)

(2.5-3) 3

which results in: SV z ( k x , k y ) = SP( k x , k y ) × or
2 2 2   ) -  k - (k x + ky  V z ( x, y ) =   2 D {P( x, y )}×  2 k     -1 2D 2 2 ) -  k - (k x + ky 2

k

2

(2.5-4)

Eq. (2.5-2) can be applied to any single point in space to convert pressure to normal particle velocity, but Eq. (2.5-4) requires that pressure be known on an entire plane. In spite of this, Eq. (2.5-4) fits our problem better as it provides a faster way to make that conversion over the entire extent of the initial plane. Plus Eq. (2.5-2) requires that pressure be known on two adjacent planes (instead of one) which doubles the computational time. It's worth noting that the problem of computational noise is not an issue in implementation of Eq. (2.5-4) as the term
2 2 ) is no longer in the denominator k - (k x + ky 2

of the transfer function. In other words, the computational noise only appears in conversion of normal particle velocity to pressure and not vice versa.

2.5.5 Acoustic Source as a 2D Array
Once the conversion to normal particle velocity is done by making use of Eq. (2.5-4), the calculated values of v z is then expanded and assigned to the adjacent squares (dotted lines in Fig. 2-30 below) to create a 2D array. Since the value of v z across any given square (e.g. the shaded area shown in Fig. 2-30) is constant, it can be written in compact form as

3

Refer to section 2.4.3 for derivation.

77

Chapter 2: Methodology _____________________________________________________________________
 ( x - xc ) ( y - y c )  v z ( x, y, z0 ) = vo rect ,  w   w

(2.5-5)

where z 0 is the z coordinate of the initial plane, w is the width of the array element and
( xc , y c ) is the location of the element's centre.

The rect function has an analytical 2D Fourier transform as below:
 2 D (v z ( x, y , z 0 )) = vo w 2 sinc( w ky - j ( k x xc + k y yc ) kx ,w )× e 2 2

(2.5-6)

Eq. (2.5-6) is then discretized along k x and k y dimensions to create a 2D matrix. The same process is repeated across all array elements and then the resulting matrices are added up to produce the discrete Fourier transform of the entire initial plane.

y

x
w

( xc ,y yc )
w

Figure 2-30. Acoustic source as a 2D array

The result is then fed into Eq. (2.5-7) to perform the first half step diffraction (see section 2.1.2 for more details):

78

Chapter 2: Methodology _____________________________________________________________________
-1 v z ( x , y , z + ( z / 2 ) ) =  2  2 D {v z ( x , y , z )}× H (k x , k y , ( z / 2 ) )} D{

(2.5-7)

where H ( k x , k y , z / 2) = e

2 2 j ( z / 2 ) k 2 - ( k x +k y )

and z is the size of each propagation.

To implement Eq. (2.5-7) numerically, transfer function H ( k x , k y ) has to be sampled at the same intervals as Eq. (2.5-6). This sample interval is determined by the "Times_Nyquist_Rate" in the parameters file. The Nyquist rate is the number of samples acquired per wavelength. After finishing diffraction substep, the result is then converted back to spatial domain using inverse Fourier transform and a nonlinear substep is subsequently followed as shown in Fig. 2-1 in section 2.1.1. The process is then repeated to propagate the field along the z direction.

2.6 Temperature and Thermal Dose Calculations
As part of the enhancements implemented in the code is the capability to predict temperature and the associated thermal dose within the tissue. The code takes in the heat deposition rate, tissue parameters, boundary conditions, exposure on time (Ton) and the total simulation time (Tmax) and returns temperature, thermal dosage, lesion center and lesion size. The thermal dose is calculated based on the temperature results by applying the following formula (Sapareto and Dewey 1984):
TD =  R 43-T ( t ) dt
ti tf

(2.6-1)

Where TD is the accumulated thermal dose, T (t ) is the temperature in units of oC ,
R = 0.5 for T > 43o C and R = 0.25 for T  43o C .

79

Chapter 2: Methodology _____________________________________________________________________ The code will then uses the TD values of Eq. (2.6-1) to determine the lesion size and location. The lesion center is identified as a point in space where the maximum thermal dose has reached, and the lesion size is determined based on the experimentally obtained thermal dose of 240 minutes at 43 o C (Dewey 2009). This is the threshold for creation of an irreversible thermal lesion (i.e. coagulation necrosis). The volume of space with thermal doses above this threshold limit would indicate the lesion size.

2.6.1 Bio-heat Transfer Equation
Temperature field calculations are performed by solving the standard Bio-heat Transfer Equation (BHTE) which was originally proposed by Pennes in 1948. It provides a model to describe heat transport and temperature rise in perfused media. The equation assumes the general form of:

C

T = K 2T - wb Cb (T - Tb ) + Q t

(2.6-2)

where T is the tissue temperature in oC ,
Tb is the blood temperature that is assumed constant at 37 oC ,

 is the tissue mass density in kg / m 3 ,
C is the tissue specific heat capacity in J /( kg .o C ) ,

C b is the blood specific heat capacity in J /( kg .o C ) , K is the tissue thermal conductivity in W /( m.o C ) , wb is the blood perfusion rate in kg /( m 3 .s ) , and Q is the heat production rate per unit volume in W / m 3

Eq. (2.6-2) is solved numerically using a finite difference algorithm. 80

Chapter 2: Methodology _____________________________________________________________________

2.6.2 Enhanced Heat Deposition Rate
To solve the BHTE equation as given in Eq.(2.6-2), a knowledge of Q or heat deposition rate is needed. The beam propagation causes part of the acoustic energy to convert into thermal energy which is the source for Q. For a plane harmonic wave, the expression for Q is given by (Cobbold 2007):
Q ( z ) = 2I =

 | P | 2 =  o c o | v |2  o co

(2.6-3)

where  is the medium attenuation coefficient and | P | and | v | are the amplitudes of pressure and particle velocity respectively. Nyberg (Nyborg 1981) demonstrated that for a general case of a non-planar continuous wave, an equation similar to Eq.(2.6-3) in terms of the pressure amplitude is obtained providing the loss due to shear viscosity is negligible. In other words equation
Q =

 | P |2 is still applicable to calculate Q in a general nonplanar continuous sound  o co

field when there's no loss due to shear viscosity. In Chapter 4, however, we'll be showing that a more general equation which will include the effects of shear viscosity is r r Q ( z ) =  o c o o | V |2 , where | V |2 =| V x |2 + | V y |2 + | V z |2 . Nonlinearity produces harmonics of the fundamental which will attenuate at different rates. According to power law of attenuation in biological tissue, the attenuation coefficient of the nth harmonic can be written as:

 n =  ( f n / f o )b

(2.6-4)

where  is the attenuation coefficient of the fundamental, b is the power index which is around unity for biological tissues and f n is the frequency of the nth harmonic. As a result the general form for Q can be expressed as (Filonenko and Khokhlova 2001):

81

Chapter 2: Methodology _____________________________________________________________________
Q =

n   | p n |2 =  o co n =1  o c o
N

 n | p
n =1

N

n

|2

(2.6-5)

where N is the number of harmonics retained, and | p n | is the pressure amplitude of the nth harmonic.
Q calculated in Eq. (2.6-5) accounts for the excess heat deposition rate in tissue as a

result of nonlinearity induced harmonics.

2.6.3 Interpolation of Q Between Two Planes
Heat deposition rate or Q , has to be known at the entire volume where the temperature field is to be calculated. However, it's readily available only at propagation planes (dotted lines in Fig. 2-31) due to the method of fractional steps. In other words, values of Q are not known anywhere between the planes. However, since the field profile is continuous, a linear interpolation of Q between two adjacent planes can be used to estimate the Q anywhere in between as shown in Fig. 2-31. Based on this heat deposition rate at an intermediate plane (Qi ) with axial location of z i can be estimated as:
Qi = Q1 + (Q2 - Q1 )  d z

(2.6-6)

where d = z i - z1 , z = z 2 - z1 and z1 , z 2 are axial locations of the adjacent propagation planes. Eq. (2.6-6) can be performed in matrix form over the entire plane which is computationally very efficient.

82

Chapter 2: Methodology _____________________________________________________________________
Source plane

Concave source

z
Z0

Q
Q1

Qi Q2

d z1 zi Uz
Figure 2-31. Interpolation of Q between two propagation planes

z2

z

2.6.4 User Defined Parameters
A number of parameters should be set by the user before a temperature simulation is run. These include tissue thermal properties such as thermal conductivity, specific heat capacity and blood perfusion rate. The user also needs to define the domain where temperature is to be calculated. The calculation domain is determined by 6 parameters

83

Chapter 2: Methodology _____________________________________________________________________ which assign the max. and min. of x,y,z extents. Based on this the calculation domain forms a cuboid as shown in Fig. 2-32.

Source

S x
y_bhte_max

y

BHTE domain
y_bhte_min z_bhte_min z_bhte_max

z

Figure 2-32. BHTE calculation domain

After selecting the boundaries, the user needs to select the temperature at the boundaries. The temperature at the boundary marked by `S' in Fig 2-32 can be set separately to enable the user to simulate the skin temperature which is usually less than 37 o C . The temperatures of the other boundaries are set at a constant (typically 37 o C ). The user should also set the duration of the HIFU exposure (Ton) and the total simulation time (Tmax).

84

Chapter 3: Model Verification ________________________________________________________________________

Chapter 3: Model Verification
In this chapter we will present the results of our simulations based on the methods discussed in Chapter 2. This will serve as a verification point for formulas and methods discussed in the previous chapter.

3.1 Verification of the Diffraction Integral
To verify the acoustic field propagation from the surface of the transducer to the initial plane, the pressure field was calculated using our code (NLP-E) and a linear program (Field) 4 and the results were compared. The NLP-E code divides the surface of the transducer into small rectangular elements and calculates the pressure based on Eq. (2.3-3) as discussed in Chapter 2. The simulations were performed using the dimensions of an actual HIFU transducer in the therapeutic ultrasound lab with radius of curvature of 100mm and aperture diameter of 125mm (see Fig. 3-1). The source excitation was selected to be at f =1MHz and surface pressure of Po=100KPa.

Radiator surface f = 1MHz Po = 100KPa

R=100mm

D=125m

O

F

z

Figure 3-1. Spherical concave transducer used in simulations

4

Refer to Appendix-C for more details

85

Chapter 3: Model Verification ________________________________________________________________________ The surface of the transducer was simulated by breaking it down to 1mm × 1mm rectangular elements as shown in Fig. 3-2. The lateral pressure amplitude profiles were plotted at axial locations of z = 25mm, 50mm, 75mm and 100mm. Generally excellent agreements were observed. For z = 25mm, the difference was reduced by selecting nse=2 reduced by selecting nse = 2 instead of 1 which results in breaking of the 1mm × 1mm surface element down even further into four smaller sub-elements. This would only be needed when a field point is located relatively close to the surface of the transducer. That's why it can specially help increasing the accuracy for the case of z=25mm. The reason is that the distance of a field point located close to the surface of the transducer, could be different from point to point of a surface element as shown in Fig. 3-3 below. However as the distance between P and the transducer surface increases, which is the case in the far field of the transducer, they become almost equal (i.e. r1  r2  r3  r4 ).

P

r1

r4 r3

Figure 3-2. Transducer surface is broken down to 1mm x 1mm elements

r2

r1  r2  r3  r4

Figure 3-3. Variations of a field point distance from a surface element

86

Chapter 3: Model Verification ________________________________________________________________________ The result of simulations at four different axial locations are plotted in Figs. 3-4 to 3-9 below:
Lateral pressure profile @ z=25mm Source specs: Roc=100mm, D=125mm, f=1MHz 2.6 2.4 2.2
Field (f=40) NLP-E (nse=1)

|P|/Po

2 1.8 1.6 1.4 1.2 1 0.8 -40 -30 -20 -10 0 10 20 30 40

x (mm)
Figure 3-4. Closer to the transducer surface. A close match was obtained, however the NLPE code generates small pressure hikes at points of maxima or minima

Lateral pressure profile @ z=25mm Source specs: Roc=100mm, D=125mm, f=1MHz 2.6 2.4 2.2 2
Field (f=40) NLP-E (nse=2)

|P|/Po

1.8 1.6 1.4 1.2 1 0.8 -40 -30 -20 -10 0 10 20 30 40

x (mm)
Figure 3-5. A better match was achieved as a result of the introduction of sub-elements

87

Chapter 3: Model Verification ________________________________________________________________________
Lateral pressure profile @ z=50mm Source specs: Roc=100mm, D=125mm, f=1MHz 3 2.5 2
Field (f=40) NLP-E (nse=1)

|P|/Po

1.5 1 0.5 0 -40

-30

-20

-10

0

10

20

30

40

x (mm)
Figure 3-6. A close match was obtained at z=50mm plane without any extra sub-element divisions

Lateral pressure profile @ z=75mm Source specs: Roc=100mm, D=125mm, f=1MHz 6 5 4
Field (f=40) NLP-E (nse=1)

|P|/Po

3 2 1 0 -40

-30

-20

-10

0

10

20

30

40

x (mm)
Figure 3-7. Comparison of pressure profiles. Field vs. NLP-Enhanced

88

Chapter 3: Model Verification ________________________________________________________________________
Lateral pressure profile @ z=100mm Source specs: Roc=100mm, D=125mm, f=1MHz 80 70 60 50
Field NLP-E (nse=1)

|P|/Po

40 30 20 10 0 -40 -30 -20 -10 0 10 20 30 40

x (mm)
Figure 3-8. Comparison of pressure profiles. Field vs. NLP-Enhanced

10

2

Lateral pressure profile @ z=100mm Source specs: Roc=100mm, D=125mm, f=1MHz
Field NLP-E (nse=1)

10

1

|P|/Po

10

0

10

-1

10

-2

10 -40

-3

-30

-20

-10

0

10

20

30

40

x (mm)
Figure 3-9. Same graph as in Fig. 3-8 but in log scale to highlight the values close to zero

89

Chapter 3: Model Verification ________________________________________________________________________

3.2 Full Diffraction vs. Phase Shift Method
In this section the results obtained through application of several phase shift methods are compared with those obtained by full diffraction solution. The phase shift methods discussed here are based on Eq. (2.3-15) derived in Chapter 2 to estimate the normal particle velocity on the initial plane.

A concave spherical source was simulated with parameters shown in Fig. 3-10. The simulation was done for D = 25mm and 15mm. D = 15mm will result in less source curvature and thus more accurate results are expected using the phase-amplitude shift method. It's assumed that the concave source is uniformly excited at surface pressure of Po = 500KPa and f = 1MHz.
Radiator surface f = 1MHz Po = 500KPa
D

R=25mm

F

Figure 3-10. Simulation parameters

The pressure field is then determined at z = 15mm and 25mm planes using four different phase shift methods and the results are compared with full diffraction solution obtained through the Field 5 program.

Method 1: In this method the phase and amplitude at each point on a plane in front of the source is estimated by using Eq. 2.3-15 as discussed in Chapter 2 section 2.3.4. Once this is done
5

See Appendix-C for more details.

90

Chapter 3: Model Verification ________________________________________________________________________ the pressure field is calculated by Rayleigh diffraction integral using the normal particle velocities on this plane.

Method 2: The second method is similar to the first but the amplitude is kept constant at the source level and only a phase shift is implemented. This method is being studied here as well because it's often used in simulation of concave sources (Christopher and Parker 1991,
Filonenko and Khokhlova 2001, Averkiou and Hamilton 1995).

Method 3: The third method, which is used as a gold standard, calculates the pressure using the Rayleigh diffraction integral again but this time by integrating directly on the radiator surface. This method also yields approximate results in the case of a curved radiator surface, however it has been shown that the deviation from more accurate numerical methods is small even for highly focused sources (Coulouvrat 1993). In light of this, we'll consider the third method as a gold standard to compare the other methods with.

In the first method, the distance of each point (e.g. A) on the initial plane from the surface of the radiator (i.e. AB = l ) is calculated (see Fig. 3-11 below). Besides l , the angle  is also needed to estimate the normal particle velocity at point A. Once these two parameters are known, Eq. (2.3-13) above can be used to find the normal particle velocity at each point on the initial plane.

91

Chapter 3: Model Verification ________________________________________________________________________

Radiator surface f = 1MHz Po = 500KPa

B

A 

R=25mm r


h zd l

F
D/2

Initial plane

Figure 3-11. Application of the phase shift method on a spherically concave source

In the case of a spherically concaved radiator, l and  can be expressed in terms of r (the radial distance of each point located on the initial plane):
 l = h - z d , h = R - R 2 - ( D / 2) 2 , z d = R - R 2 - r 2    = arcsin( r / R )

(32.23-120)

Using Eqs. (32.23-120) and assuming even source excitation, the normal particle velocity at point A, can be estimated as:
v n ( A) = v no cos   e - jk ( l cos  )

(32.23-

21) Where v no is the normal velocity amplitude at the source and k = 2 /  is the wave number. The simulation was performed by dividing the initial plane into small rectangular elements and assigning a normal particle velocity to each element based on Eq. (2.3-21). What follows is the result of our simulations in two different cases: i , iii) For a highly focused source (F# 1.00) ( D = 25mm, R = 25mm  F # : 1.00 ) ii, iv) For a slightly focused source (F# 1.67)( D = 15mm, R = 25mm  F # : 1.67 )

92

Chapter 3: Model Verification ________________________________________________________________________ i) The first simulation was done for source parameters of:
D = 25mm, R = 25mm, po = 500 KPa, f = 1MHz (Highly focused, F# 1)

At axial locations of a) z = 15mm and b) z = 25mm
a) z = 15mm

Pressure lateral profile at z=15mm Source specs: Roc=D=25mm, f=1MHz
8 7 6 5 Method 1 (phase-amplitude adjusted) Method 2 (phase adjusted) Method 3 (Field)

|P|/P

o 4 3 2 1 0 -15 -10 -5 0 5 10 15

x (mm)

Figure 3-12. The difference is obvious for a highly focused source

Fig. 3-12 displays normalized pressure amplitude over lateral x dimension at
z = 15mm plane. As it can be seen, both methods 1 and 2 contain errors comparing to

method 3 shown by solid line. However method 1 seems to be following the solid line more closely than method 2 does. These discrepancies are expected as the source is highly curved in this simulation (F# 1). It's interesting to notice that methods 1 and 2 produce similar results far off the axis.

This plot clearly demonstrates that phase shift methods generate significant errors if used in conjunction with highly focused sources. That's why we chose to implement a full diffraction solution to calculate the acoustic field on the initial plane (see section 2.3.2). In addition, using the Rayleigh diffraction integral will enable us to virtually place the initial plane anywhere and not necessarily close to the source as it's the case in phase shift method. This capability helps us to reduce the computation time.

93

Chapter 3: Model Verification ________________________________________________________________________
b) z = 25mm
Pressure lateral profile at z=25mm (focal plane) Source specs: Roc=D=25mm, f=1MHz
20
Method 1 (phase amplitude adjusted) Method 2 (phase adjusted) Method 3 (Field)

15

|P|/P

o

10

5

0 -15

-10

-5

0

5

10

15

x (mm)
Figure 3-13. Pressure profile at the focal plane

At focal plane, the three methods generate more consistent results as shown in Fig. 3-13. However far off the axis they don't agree well as illustrated in Fig. 3-14 where y axis is scaled in log.
Pressure lateral profile at z=25mm (focal plane) Source specs: Roc=D=25mm, f=1MHz 10
2

Method 1 (phase-amplitude adjusted) Method 2 (phase adjusted) Method 3 (Field)

10

1

|P|/Po

10

0

10

-1

-15

-10

-5

0

5

10

15

x (mm)
Figure 3-14. Pressure profile at the focal plane (log scale)

94

Chapter 3: Model Verification ________________________________________________________________________ ii) The second simulation was done for source parameters of:
D = 15mm, R = 25mm, po = 500 KPa, f = 1MHz (Slightly focused, F# 1.67)

At axial locations of a) z = 15mm and b) z = 25mm
a) z = 15mm

Pressure lateral profile at z=15mm Source specs: Roc=25mm, D=15mm, f=1MHz
7 6 5
Method 1 (phase-amplitude adjusted) Method 2 (phase adjusted) Method 3 (Field)

|P|/P

4 3 2 1 0 -15 -10 -5 0 5 10 15

o

x (mm)

Figure 3-15. Pressure profiles coincide due to less curvature or higher F#

As it can been seen in this graph (Fig. 3-15), for the case of a slightly curved radiator (F# 1.66), all three methods yield almost similar results (as opposed to a highly focused source). This is expected as the distance between the initial plane and the source remains small throughout the source curvature which is an important assumption for the phase shift method to be accurate.
b) z = 25mm

At the focal plane all methods yield similar results as well, as shown in Fig. 3-16 below. This demonstrates further that for a slightly curved radiator, the phase shift method provides a very good approximation and produces accurate results.

95

Chapter 3: Model Verification ________________________________________________________________________
Pressure lateral profile at z=25mm Source specs: Roc=25mm, D=15mm, f=1MHz
7 6 5
o Method 1 (phase-amplitude adjusted) Method 2 (phase adjusted) Method 3 (Field)

|P|/P

4 3 2 1 0 -15

-10

-5

0

5

10

15

x (mm)
Figure 3-16. An overlap is maintained at the focal plane too

Methods 1 and 2 as described above can be applied to any source geometry. Another method, which is only applicable to a spherically concaved source, involves applying a focusing phase factor on a plane perpendicular to the acoustic axis so that all point sources on this plane interfere constructively at the geometrical focal point (Christopher
and Parker 1991, Averkiou and Hamilton 1995). This is virtually the case for a spherically

concaved source as all the point sources on the radiator surface interfere constructively at the geometrical focus, since they are all located at the same distance from the centre of the curvature. However, as it will be shown later, they don't necessarily produce similar acoustic field across spatial dimensions. The difference is more significant when the radiator is highly focused. Fig. 3-17 shows the geometry of the problem:

96

Chapter 3: Model Verification ________________________________________________________________________

Initial plane

A

r
D

d = r 2 + R2

O

F
R=25mm

rmax

Radiator surface f = 1MHz Po = 500KPa
Figure 3-17. Plane equivalent of a concave spherical source by introducing focusing phase

If radial distance of a point (e.g. A) on the initial plane from the origin (point O) is r , the distance between this point and the centre of curvature will be d = r 2 + R 2 as shown in Fig. 3-17 above. Adding a phase factor equal to + 2
d



to the phase at point A, makes the phase of the
d - 2 d = 0 . In other words all point sources

point source A at the focus to be + 2





located on the initial plane will reach the focus (point F in Fig. 3-17) with the same phase and hence interfere constructively. The normal particle velocity on the initial plane can then be expressed as:
v n ( r ) = v no  e j ( 2d /  ) = v no  e j ( k
r2 + R2 )

(3.2-3)

In the parabolic approximation (i.e. r << R ), the phase factor can be simplified as below:
2  1  r 2  r2 r k r 2 + R 2 = kR 1 +    kR1 +    = kR + k  2 R  2R R  

The term kR is constant and can be dropped which yields: v n ( r ) = v no  e jkr
2

/ 2R

(3.2-4)

97

Chapter 3: Model Verification ________________________________________________________________________ This is a parabolic form which is often used in simulations of spherically concaved transducers (Averkiou and Hamilton 1995). In parabolic approximation the radial extent of the initial plane is assumed to be equal to D / 2 or half the diameter of aperture. However it can be shown analytically that this selection will not yield accurate results in the case of a highly focused spherical source. Calculating the Rayleigh diffraction integral on the surface of the initial plane with focusing phase factor to the extent of rmax , yields:
rmax

dr

r dS

d = r2 + R2

R

F

Figure 3-18. Pressure calculation at the focal point of a radial source

PF = =

j o c o

   

 v n (r )
S

e - ( + jk ) d dS , v n ( r ) = v no  e j ( kd )  d (3.2 - 5)

j o c o

 v no
S

e -d dS d

PF = =

j o c o

e - ( + jk ) d dS , v n ( r ) = v no  e j ( kd )  vn (r )  d S e -d dS d

j o c o

 v no
S

We're going to assume here that  = 0 (lossless medium), nonetheless one can obtain an analytical expression for focal pressure, even without this assumption.

98

Chapter 3: Model Verification ________________________________________________________________________ If we break the surface area S into small radial rings with infinitesimal width dr (see Fig. 3-18 above), the surface integral of Eq. (3.2-5) can be converted to a line integral as below:
PF = = j o c o v no


rmax

 d dS
S

1

, d = r 2 + R 2 , dS = 2r  dr 

jp o



r =0



1 r + R2
2

×2r  dr

This integral can be easily solved with a change of variable: u = r2 + R2  du 1 = × 2r  r  dr = u  du dr 2u

Expressing PF in terms of new variable u , yields: PF = jpo
2 R 2 + rmax



u= R



jp 1 ×2u  du = o × 2  u

[R

2

2 + rmax -R

]

Focal pressure was also derived earlier in section 2.3.4 for the case of an evenly excited spherical cap transducer (see Eq. 2.3-9) :

) jp PF = o × S , S = 2Rh (for spherical cap), R ) jp  PF = o × 2h , h = R - R 2 - ( D / 2) 2 



) jp PF = o × 2 R - R 2 - ( D / 2) 2



[

]

Selecting rmax = D / 2 (which is a commonly used value), it can be easily shown ) PF > PF . However, for the case of D / 2 << R , the difference between the two diminishes and they yield almost the same values. Nonetheless rmax can be selected such ) that PF = PF :

99

Chapter 3: Model Verification ________________________________________________________________________
2 R 2 + rmax - R = R - R 2 - ( D / 2) 2  2 R 2 - ( D / 2) 2  R 2 + rma x = 2R - 2 R 2 + rmax = 4 R 2 + R 2 - ( D / 2) 2 - 4 R R 2 - ( D / 2) 2  2 rmax = 4 R 2 - ( D / 2) 2 - 4 R R 2 - ( D / 2) 2 

rmax = 4 R 2 - ( D / 2) 2 - 4 R R 2 - ( D / 2) 2

Method 4: In this method a focusing phase factor is introduced at the initial plane located at z = 0 . We'll selectively set rmax (based on the above equation) so that the pressure gain at focal point is equal to the equivalent spherical cap.

Method 5: In this method a focusing phase factor is introduced at the initial plane located at z = 0 . We'll set rmax = D / 2 , where D is the diameter of aperture.

iii) The third simulation was done for source parameters of: D = 25mm, R = 25mm, po = 500 KPa, f = 1MHz (Highly focused, F# 1) At axial locations of a) z = 15mm and b) z = 25mm
a) z = 15mm

100

Chapter 3: Model Verification ________________________________________________________________________
Pressure lateral profile at z=15mm Source specs: Roc=D=25mm, f=1MHz
7 6 5
M ethod 3 (Field) M ethod 4 (focusing phase factor with extended radius) M ethod 5 (focusing phase factor)

|P|/P o

4 3 2 1 0 -15 -10 -5 0 5 10 15

x (mm)
Figure 3-19. Pressure deviation appear in near field

Fig. 3-19 demonstrates that focusing phase factor will not produce accurate results compared to Method 3 (solid line) in pre-focal region.
b) z = 25mm
Pressure lateral profile at z=25mm (focal plane) Source specs: Roc=D=25mm, f=1MHz
20
Method 3 (Field) Method 4 (focusing phase with extended radius) Method 5 (focusing phase)

15

|P|/P

o 10 5 0 -15

-10

-5

0

5

10

15

x (mm)
Figure 3-20. A better match is maintained at the focal plane

Fig. 3-20 demonstrates how the focusing phase method with extended radius produces more accurate results in terms of the focal gain and locations of pressure nulls at the focal plane.

101

Chapter 3: Model Verification ________________________________________________________________________ iv) The forth simulation was done for source parameters of: D = 15mm, R = 25mm, po = 500 KPa, f = 1MHz (Slightly focused, F#=1.67) At axial locations of a) z = 15mm and b) z = 25mm
a) z = 15mm
Pressure lateral profile at z=15mm Source specs: Roc=25mm, D=15mm, f=1MHz
7 6 5
Method 3 (Field) Method 4 (focusing phase factor with extended radius) Method 5 (focusing phase factor)

|P|/P

o

4 3 2 1 0 -6 -4 -2 0 2 4 6

x (mm)

Figure 3-21. Phase shift methods generate satisfactory results for a source with higher F#

Comparing Fig. 3-21 with Fig. 3-19 in section iii, demonstrates how three methods converge and produce similar results when aperture diameter (D) is small compared to the radius of curvature (R).
b) z = 25mm
Pressure lateral profile at z=25mm Source specs: Roc=25mm, D=15mm, f=1MHz
6 5 4
Method 3 (Field) Method 4 (focusing phase factor with extended radius) Method 5 (focusing phase factor)

|P|/P

o

3 2 1 0 -15 -10 -5 0 5 10 15

x (mm)

Figure 3-22. An overlap is maintained at the focal plane too

102

Chapter 3: Model Verification ________________________________________________________________________ In summary our results show that phase shift methods produce better results when the spherical surface has a higher F# which means the radiator surface deviates slightly from a plane surface. In HIFU applications, where highly focused sources with low F# are normally used, phase shift methods fail to generate accurate results specially in pre-focal regions. Due to plane by plane propagation in the method of fractional steps, any error on the initial plane is propagated to other planes and can grow in an accumulative manner. Thus we have chosen to implement a full diffraction solution for the first propagation step from the surface of transducer to the initial plane. While it's computationally intensive, it's more accurate and has the capability to be applied to any source geometry.

3.3

Computational Noise in Enhanced Pressure
In this section we will present the results of our simulations for a flat rectangular

transducer where a low amplitude noise is generated due to computational implementations of the normal particle velocity to pressure transfer function.

3.3.1 In a Lossless Medium
As mentioned in Chapter 2, the relation which converts the normal particle velocity on a given plane to the pressure on the same plane in a lossless medium is given by:   -  o   P( x, y ) =   Vz ( x, y )} 2 D { 2 2 2     k - (k x + k y )
-1 2D

(3.3-1)

As mentioned in Chapter 2, Eq. (3.3-1) includes a singularity on spatial frequency domain which will cause problems in numerical implementation of the enhanced pressure. For instance it will cause the inverse 2D fast Fourier transform in the right hand side of Eq. (3.3-1) to fail in Matlab®. This problem can be overcome by implementing a band stop filter around the singularity (see section 2.4.2, in Chapter 2). Introducing a band stop filter, even with a very narrow bandwidth, would allow us to calculate the pressure using Eq. (3.3-1). Nevertheless a low amplitude noise in the

103

Chapter 3: Model Verification ________________________________________________________________________ pressure output is generated which is due to the discrete sampling of k x , k y in the spatial frequency domain in the vicinity of the singularity.

To illustrate the noise produced in the output pressure, as a result of singularity in Eq. (2.4-17), here we're simulating a 10mm × 20mm rectangular transducer which is uniformly derived at f o = 2MHz and Po = 500KPa (see Fig. 3-23). y
f o = 2 MHz Po = 500 KPa
Simulation parameters : c = 1500m/s ,  = 1000kg/m 3  = 0 ,  = 3.5 z = 3mm , Nz = 15 Sampling interval : /2

x

h = 20 mm

z

w = 10mm

Figure 3-23. Geometry and parameters used in the simulation

A very narrow band stop filter with transition band of k / 5000 was implemented around the singularity to allow the execution of the inverse 2D fast Fourier transform in Eq. (3.31). Fig. 3-24 illustrates the lateral pressure profile at depth of z=3mm in front of the transducer . The effect of noise is particularly visible where the signal level is low. A very narrow band stop filter with transition band of k / 5000 around the radiation circle was implemented to avoid instability caused by the singularity. For comparison, the plane wave approximation has been also plotted (dotted line) on the same graph:

104

Chapter 3: Model Verification ________________________________________________________________________

Lateral pressure profile at z=3mm
10
0

P Enhanced Plane wave approx.

P/P

o

10

-1

10

-2

10 -60

-3

-40

-20

0

20

40

60

x (mm)
Figure 3-24. Noise in pressure, caused by a singularity in the transfer function

As we move the observation plane along the z axis, the noise has less effect in altering the pressure amplitude as shown in Fig. 3-25 below.

Lateral pressure profile at z=15mm
10
0

P Enhanced Plane wave approx.

10

-1

P/Po
10
-2

10 -60

-3

-40

-20

0

20

40

60

x (mm)
Figure 3-25. The noise level is substantially subsided farther away from the transducer surface

105

Chapter 3: Model Verification ________________________________________________________________________ There are two reasons for the reduction of noise in far field. The main reason is that the field profile becomes smoother in far field and thus its spectrum becomes narrower in spatial frequency domain. In other words the components of field spectrum gradually concentrate around (0 , 0) and drop at radiation circle which will result in less noise. Another reason is that the pressure amplitude gradually spreads laterally and thus the pressure increases off the axis. This will increase the signal level at the off axis loci and improve the signal to noise ratio.

To confirm our hypothesis that at far field noise due to the presence of singularity is subsided, a signal to noise ratio analysis was performed. The signal was filtered using a 5 point moving average filter. The difference between the original signal and the filtered signal was considered to be noise. The power of noise was then calculated and averaged over the vicinity of each point. Fig. 3-26 below shows how noise to signal ratio varies over space.

Noise to Signal power
0.25 0.2 0.15 0.1 0.05 0 -60 z=3mm z=15mm

NSR

-40

-20

0

20

40

60

x (mm)
Figure 3-26. Quantitative demonstration of noise reduction at farther field points

The effect of computational noise is clearly less for a plane located farther from source. The signal to noise power spatial average was calculated to be 175.6 for a plane located at z=3mm and 1627.4 for a plane located at z=15mm. Notice that the hikes in plots of Fig. 3-26 correspond to pressure dips in Fig. 3-24,25 where signal level drops significantly.

106

Chapter 3: Model Verification ________________________________________________________________________
Reduction of noise by filtering:

To demonstrate the effectiveness of filtering in reduction of noise, a band stop filter as defined in section 2.4.2 in Chapter2, was applied to the transfer function of the output pressure. The side and middle margins of the filter were selected to be bm = k / 60 and bs = k / 40 (see Fig 2-25 in Chapter 2). The enhanced pressure versus impedance pressure along with the filtered enhanced pressure has been shown in Fig. 3-27 below.
Lateral pressure profile at z=3mm
10
0

P Enhanced P Impedance Filtered

10

-1

P/P

o

10

-2

10

-3

10 -60

-4

-40

-20

0

20

40

60

x (mm)
Figure 3-27. Effect of filtering in noise reduction

It's obvious that the noise pressure has subsided significantly, however the signal amplitude has decreased too due to filtering. To prove that the noise has really been reduced by filtering, we need to show the signal to noise ratio has improved. To do this, both signals (P Enhanced and the filtered P Enhanced) were filtered using a 5 point moving average filter. The difference between the filtered signal and the original signal was considered to be noise. The power of noise was then calculated and averaged and divided by the signal power at each location. Fig. 3-28 shows the ratio of noise to signal power of filtered vs. not-filtered.

107

Chapter 3: Model Verification ________________________________________________________________________

Ratio of Noise to Signal power at z=3mm
0.25 Not filtered Filtered 0.2

0.15

NSR
0.1 0.05 0 -60

-40

-20

0

20

40

60

x (mm)
Figure 3-28. Quantitative demonstration of noise reduction by filtering

It's obvious that the noise to signal ratio has subsided (or signal to noise has improved) when a filter has been used.

3.3.2 In a Viscous Medium
As derived in Chapter 2, the relation between normal particle velocity to pressure relation in a viscous medium can be expressed as:
  2 -k  -1  { } ( , ) P( x, y ) =  2 V x y  ×  D  2D z 2 2 2 ( )  k k k - +   x y  

(3.3-2)

Unlike Eq. (3.3-1), Eq. (3.3-2) doesn't contain a singularity, thus the need for filtering to calculate the inverse 2D Fourier transform is eliminated. However the noise in the output pressure is still present due to the fact that imaginary part of k is typically much smaller than the real part (i.e. k = k - j &  << k ). In view of this we expect that the noise level would be much higher in water compared to tissue sine  water <<  tissue (see sction 2.4.3 for more details).

108

Chapter 3: Model Verification ________________________________________________________________________ To test this hypothesis a simulation was performed in water and then in tissue and the enhanced lateral pressure was calculated at various z coordinates. The geometry and other parameters used in the simulations are shown in Fig. 3-29

y
f o = 2 MHz Po = 500 KPa

Simulation parameters : c = 1500m/s ,  = 1000kg/m 3  water = 0.09np/m ,  tissue = 24.7np/m z = 3mm , Nz = 15 Sampling interval : /2

x

h = 20 mm

z

w = 10mm

Figure 3-29. Geometry and parameters used in the simulation

Fig. 3-30 illustrates how the noise amplitude is much smaller compared to water as expected.

Lateral pressure profile at z=3mm
1.4 1.2 1 o water tissue

P/P

0.8 0.6 0.4 0.2 -60 -40 -20 0 20 40 60

x (mm)
Figure 3-30. Computational noise is more significant in water due to lower attenuation coefficient (no filtering applied)

109

Chapter 3: Model Verification ________________________________________________________________________ In case of simulation in water, applying a filter will significantly reduce the noise as shown in Fig. 3-31 below. The filter is a band stop filter with bm = bs = k / 1000 .

Lateral pressure profile at z=3mm
1.4 1.2 1 P Enhanced Filtered

o

P/P

0.8 0.6 0.4 0.2 -60 -40 -20 0 20 40 60

x (mm)
Figure 3-31. Effect of filtering in reduction of noise. Implementation of a very narrow band stop filter ( ( bs = bm = k / 1000 ) has resulted in significant reduction of noise

The noise reduction here is much more significant than that of the case of no attenuation performed in section 3.3.1. The reason is that in the case of no attenuation we had to implement a very narrow pre-filter to avoid the singularity which is putting a damp on the noise even before applying a wider band filter. But with inclusion of attenuation (even though it's very low for water) the singularity no longer exists, and there's no need to implement a pre-filter as required in previous section. The noise will decrease as one move father along the z axis, since the field profile becomes smoother which translates to narrower beam profile in spatial frequency domain and lower amplitude at radiation circle. This has been illustrated in Fig. 3-32 below for water at z=15mm vs. z=3mm planes. The noise at z=15mm has subsided by itself, even without applying a filter.

110

Chapter 3: Model Verification ________________________________________________________________________

Lateral pressure profile
1.4 1.2 1 o z = 3mm z = 15mm

P/P

0.8 0.6 0.4 0.2 -60 -40 -20 0 20 40 60

x (mm)
Figure 3-32. Reduction of noise in far field due to smoother field variations (no filter applied)

111

Chapter 4: Results ________________________________________________________________________

Chapter 4: Results
In this chapter, we will be presenting the results of our simulations and compare them with other programs, published data or experimental results. The latest version of the code has been used in simulations presented here which is referred to as NLP-E (short For Enhanced Non-Linear Propagation) for terminology purposes. NLP-E features the following enhancements:

1- Arbitrary source geometry and excitation definition. 2- Full diffraction solution. 3- A more accurate way to calculate pressure field which is referred to as "Enhanced Pressure" as defined in section 2.4. 4- Introduction of k or complex wave number to reduce computational noise and account for attenuation. 5- Nonlinear-derived temperature and thermal dose calculations.

4.1 Linear Simulations
The NLP-E code can be run in linear regime by setting the coefficient of nonlinearity to zero (  = 0) 6 . Since programs to simulate linear wave propagation are widely available, we can compare NLP-E results with well established linear codes. The source parameters were selected to replicate the existing Imasonic IFUS transducer available at Advanced Biomedical Ultrasound Imaging and Therapy Lab of the Dept. of Physics. This transducer has a concaved spherical geometry with a circular central hole to accommodate the imaging probe as shown in Fig. 4-1 (a).
6

The NLP-E code can be also run in linear mode by selecting small source excitation amplitudes. This method have been also tried and validated in separate simulations.

112

Chapter 4: Results ________________________________________________________________________

(a)

(b)

(c)

Radiator surface f = 1MHz Po = 222.9 KPa
DH=35mm

R=100mm D=125mm

F

Figure 4-1 Source specifications. (a) Actual picture of the Imasonic IFUS transducer in the lab (pointers 'A' and `B' indicate the imaging probe and the focused source respectively) (b) 3D source definition used for the simulation (blue area indicates the inactive area of the middle where the imaging probe is located). (c) Actual dimensions

The medium parameters were selected to be the same as published values for liver
(Cobbold 2007, Curra et al. 2000). The parameters used in this simulation include:

113

Chapter 4: Results ________________________________________________________________________ Radius of curvature (R) = 100 mm Diameter of aperture (D) = 125 mm Ambient medium density (  o ) = 1060 Kg/m3 Small signal peed of sound ( co ) = 1595 m/s Attenuation coefficient at 1MHz ( ) = 5.755 Np/m Power factor of power law of attenutaion ( ) =1.1 Initial plane axial location ( z0 ) = 70 mm Spatial sampling interval of the propagation plane =  / 20 Spatial sampling interval of the initial plane = 0.5 mm Spatial extent of the propagation plane = 80mm × 80mm Spatial extent of the initial plane = 80mm × 80mm Propagation steps ( z ) = 1mm Number of propagation planes: 60

Two simulations were performed using identical set of parameters as defined above. The first simulation was done using the "NLP_E" code and the second using the "Field" 7 program which is a linear code. The pressure, intensity and temperature profiles were plotted both in lateral and axial directions and compared. The power deposition rate was not plotted separately as it follows the same profile as intensity multiplied by the attenuation coefficient.

4.1.1 Pressure Profiles
The lateral pressure profiles have been plotted at axial locations of z = 75, 80, 85, 95, 100, 105, 115 mm in total of 7 graphs. In Fig. 4-2, each graph presents three pressure profiles calculated using different methods for the sake of comparison. The dottled line represents the pressure derived using the plane wave approximation which has been calculated using the impedance relation (i.e. P =  o c oV z )
7

See Appendix-C for more details

114

Chapter 4: Results ________________________________________________________________________
(a)
4 3 2 1 0 -40

Pressure lateral profile at z=75mm
Field NLP-E Plane wave approx.

(b) 6
5 4

Pressure lateral profile at z=80mm
Field NLP-E Plane wave approx.

|P|/Po

|P|/Po
-30 -20 -10 0 10 20 30 40

3 2 1 0 -40

-30

-20

-10

0

10

20

30

40

x (mm)

x (mm)

(c)

Pressure lateral profile at z=85mm
6 5 4
Field NLP-E Plane wave approx

(d)25
20 15 10 5 0 -40

Pressure lateral profile at z=95mm
Field NLP-E Plane wave approx.

|P|/Po

3 2 1 0 -40 -30 -20 -10 0 10 20 30 40

|P|/Po

-20

0

20

40

x (mm)

x (mm)

(e) 40
35 30 25

Pressure lateral profile at z=100mm (focal plane)
Field NLP-E plane wave approx.

(f) 25
20 15 10 5

Pressure lateral profile at z=105mm (post focal)
Field NLP-E Plane wave approx.

|P|/Po

20 15 10 5 0 -40 -30 -20 -10 0 10 20 30 40

|P|/Po

x (mm)

0 -40

-20

0

20

40

x (mm)

(g)
7 6 5

Pressure lateral profile at z=115mm (post focal)
Field NLP-E Plane wave approx.

|P|/Po

4 3 2 1 0 -40 -30 -20 -10 0 x (mm) 10 20 30 40

Figure 4-2. Lateral pressure profiles at various axial locations. Excellent agreement is observed between NLP_E and Field results in the linear regime.

115

Chapter 4: Results ________________________________________________________________________ The first point to note about the pressure profiles presented in Fig 4-2, is that the difference between the plane wave approximation and the enhanced pressure is obvious and can reach as high as 20% at some points. Therefore it lends support to the need of introducing enhanced pressure in our model. Fig. 4-3 is a close-up look at the pressure profile at z=75mm which illustrates this difference more clearly.

Pressure lateral profile at z=75mm
4.5 4 3.5 NLP-E Plane wave approx.

|P|/Po

3 2.5 2 1.5 1 0.5 0 -40 -30 -20 -10 0 10 20 30 40

x (mm)
Figure 4-3. Enhanced pressure is higher than what's predicted by plane wave approximation (or impedance relation) at most loci along the x axis.

It's worth noting that both profiles have been derived using the same normal particle velocity distribution data set, thus the difference is strictly due to the methods of calculations. The enhanced pressure is calculated using Eq. (2.4-55) as discussed in section 2.4:
  2 -k   P( x , y ) =   2 D { V z ( x, y )}×  2 2 2 ( )  k k k - +  x y   
-1 2D

(4.1-1)

versus the plane wave approximation in which the simple impedance formula is used as below: P( x, y ) = c o  oV z ( x, y ) (4.1-2)

116

Chapter 4: Results ________________________________________________________________________ The enhanced pressure formula of Eq. (4.1-1) is the solution of Helmholtz equation and hence is valid for any field configuration (planar or non-planar); but the impedance relation of Eq. (4.1-2) is only valid for plane waves. It's therefore expected that for a focused source, Eq. (4.1-1) result in more accurate pressure values than Eq. (4.1-2).

The second point to note about pressure profiles presented in Fig. 4-2, is that the enhanced pressure is almost always higher than the pressure calculated using the plane wave approximation. A close-up look at Fig 4-2(a) has been shown in Fig. 4-3 for illustration purposes. As it can be seen in Fig. 4-3 the solid line is almost always situated above the dotted line with exception of few points. This can be explained by noting that in plane wave approximation of Eq. (4.1-2), only normal component of particle velocity ( v z ) is used to estimate the pressure, but in a general non-planar field, lateral components of particle velocity (i.e. v x , v y ) are also present and could have substantial amplitudes. The presence of these components would give rise to pressure values which are more than what is predicted by Eq. (4.1-2).

The third point to note is that the results of the enhanced pressure model follow the result of the Field program more closely than the plane wave approximation. This fact has been illustrated in Fig. 4-4 below which is a close-up look at Fig. 4-2 (c). The dotted circle has been further magnified in Fig 4-4 (b) to display the details around x = 0 region. It's interesting to note how the enhanced pressure profile assumes a pressure hump around the axial point ( x = 0 ) consistent with the Field results. This would serve as a validation point for our model, only if we can demonstrate that the pressure calculated by the Field program is an exact solution and not obtained by an impedance relation approximation. In Appendix-C, we demonstrate that the pressure calculated in Field does not contain an impedance approximation and hence should yield similar results as NLP-E which is in agreement with our results.

.

117

Chapter 4: Results ________________________________________________________________________

(a)
5

Pressure lateral profile at z=85mm
Field NLP-E Plane wave approx

4

|P|/Po

3

2

1

0 -20

-10

0

10

20

x (mm)

(b)
3.1

Pressure lateral profile at z=85mm

3

2.9

|P|/Po
2.8 2.7 2.6 -2 -1 0 1 2

x (mm)

Figure 4-4. (a) Enhanced pressure tracks the results of the Field program more closely. (b) A closeup look at the dotted circle in (a) reveals how enhanced pressure deviates from the plane wave approximation to produce the same curvature as the Field program.

The lateral pressure around the focal plane quickly drops to close to zero as seen in Figs. 4-2 (d),(e),(f). As a result the details of pressures far off-axis would not be reflected in

118

Chapter 4: Results ________________________________________________________________________ these graphs. Fig. 4-5 is the same graph as in Fig. 4-2 (e) with the y-axis in log scale which makes the small off-axis pressure fluctuations viewable. As it can be seen in Fig. 4-5, our NLP-E model matches the Field results very well for lateral locations of around
x = [-30mm, 30mm]. Beyond this interval, they will not exactly follow the same

trajectory because of computational wrap-around errors which become observable at these very low pressure values off the axis. The wrap around errors are generated due to the limited spatial extent of the propagation plane.

Pressure lateral profile at z=100mm (focal plane)
Field NLP-E Plane wave approx.

10

1

10

0

|P|/P

o

10

-1

10

-2

-40

-30

-20

-10

0 x (mm)

10

20

30

40

Figure 4-5. Lateral pressure profile at focal plane in log scale

4.1.2 Intensity Profiles
Intensity profiles are important as they give us an idea of power deposition rates as, in linear regime, they are directly related through Eq. (4.1-3) below: Q = 2 × I (4.1-3)

Intensity profiles are derived using the pressure data presented in section 4.1.1, through the following formula:

119

Chapter 4: Results ________________________________________________________________________ I = 1 2 o co | P |2 (4.1-4)

Eq. (4.1-4) is only valid for a plane wave propagating in an inviscid medium, however it can be used in conjunction with Eq. (4.1-3) to calculate Q in general non-planar acoustic fields providing there's no shear viscosity (  = 0 ) in the medium (Nyborg 1981). 8 Fig 4-6 displays the lateral intensity profiles at axial locations of z = 75, 80, 85, 95, 100, 105, 115 mm for the total of 7 graphs. For comparison, each graph includes three plots which have been obtained through applying Eq. (4.1-4) to pressure values of section 4.1.1.
Intensity lateral profile at z=75mm

Intensity lateral profile at z=80mm

(a)

35 30 25 Field NLP-E Plane wave approx.

(b)
40 35 30

Field NLP-E Plane wave approx.

I (W/cm )

20 15 10 5

I (W/cm )

2

2

25 20 15 10 5

0 -40

-30

-20

-10

0

10

20

30

40

x (mm)

0 -40

-30

-20

-10

0

10

20

30

40

x (mm)

(c)

Intensity lateral profile at z=85mm
40 35 30
Field NLP-E Plane wave approx.

(d)700
600 500

Intensity lateral profile at z=95mm
Field NLP-E Plane wave approx.

I (W/cm )

2

25 20 15 10 5 0 -40 -30 -20 -10 0 10 20 30 40

I (W/cm )

2

400 300 200 100 0 -40 -30 -20 -10 0 10 20 30 40

x (mm)

x (mm)

Figure 4-6. (a,b,c,d) Lateral intensity profiles at various axial locations. Excellent agreements are observed between NLP-E and Field results

8

In the next chapter we will be proposing a more general formula for Q which will be applicable to any continuous wave field (planer or non-planar) in any viscous medium.

120

Chapter 4: Results ________________________________________________________________________
(f) 2000 Intensity lateral profile at z=100mm (focal plane)
1600
Field NLP-E Plane wave approx.

(g) 700
600 500

Intensity lateral profile at z=105mm
Field NLP-E Plane wave approx.

I (W/cm )

1200 800 400

I (W/cm )

2

2

400 300 200 100

0 -40

-30

-20

-10

0

10

20

30

40

0

x (mm)

-30

-20

-10

0

10

20

30

40

x (mm)

(h)

Intensity lateral profile at z=115mm
80 70 60 Field NLP-E Plane wave approx

I (W/cm )

2

50 40 30 20 10 0 -40 -30 -20 -10 0 10 20 30 40

x (mm)

Figure 4-6. Continued

It's worth noting how the wave front intensity is being concentrated around the focal point as shown in Fig. 4-6 (f). This induces a significant rate of heat deposition around the focal spot which would result in rapid temperature elevation and tissue coagulation. A close-up look of Fig. 4-6 (f) around the focal spot has been shown again in Fig. 4-7. The plane wave approximation of P = c o  oV z has resulted in intensity predictions which are significantly lower (dotted line vs. solid lines). At the focal point this difference is about 360 W/cm2 or 23%. Once again the importance of implementation of the enhanced pressure formula in the NLP-E code is demonstrated here as intensities around the focal spot are very important in calculations of the temperature response and thermal dose.

121

Chapter 4: Results ________________________________________________________________________
Intensity lateral profile at z=100mm (focal plane)
2000 Field NLP-E Plane wave approx. 1600

I (W/cm2)

1200

800

400

0 -5

-4

-3

-2

-1

0

1

2

3

4

5

x (mm)
Figure 4-7. The substantial difference between the results obtained using the impedance pressure (the dotted line) and the exact pressure (solid lines) around the focal spot, reflects the significance of the enhanced pressure implementation in the NLP-E code.

4.1.3 Temperature Profiles
Temperature response simulations were performed in the vicinity of the transducer focal point with the following boundaries: -5mm  x  5mm -5mm  y  5mm 85mm  z  115mm The temperature at these boundaries was set at 37 o C (boundary conditions). Thermal properties of liver were used to calculate the temperature which include (Curra et
al. 2000):

122

Chapter 4: Results ________________________________________________________________________ C b (tissue and blood specific heat capacity) = 4180 J /( Kg . o C ) , K (liver thermal conductivity) = 0.6 W /( m.o C ) , wb (blood perfusion rate) = 20.0 Kg /( m 3 .s )

Using identical set of parameters, the temperature was then calculated through NLP-E (with =0) and Field programs separately and the results were compared. In overall excellent agreement was observed. Fig. 4-8 displays temperature profiles after 0.5s of HIFU exposure with a focal time-average intensity of I = 1900 W/cm2. As it can be seen the temperature profiles almost overlap which reflects the validity of our model in linear regime as described in section 2.6.3 in Chapter 2. Fig 4-8 (a) shows the axial temperature profile and Fig. 4-8 (b) is the lateral temperature profile at the focal plane after 0.5s of HIFU exposure.

(a) 85
80 75 70

Temperature axial profile at t=0.5s
Field NLP-E

(b)Temperature lateral profile at z=100mm (focal plane)
80 70
Field NLP-E

T ( C)

65

55 50 45 40 35 85 90 95 100 105 110 115

o

60

z (mm)

T ( C)

60 50 40 30 -5

o

-4

-3

-2

-1

0

1

2

3

4

5

x (mm)

Figure 4-8. NLP-E code and Field yield similar results in linear regime. (a) Axial . (b) Lateral temperature profiles at t=0.5s

Graphs in Fig. 4-8 reflect the temperature along certain locations of the calculation domain. To make sure the temperature profiles are the same across the calculation domain, the temperature contour at the x-z plane was plotted as well. Since the source is axi-symmetric, the x-z plane also represents the temperature of the whole volume.

123

Chapter 4: Results ________________________________________________________________________
(a)
4 2

Temperature profile on x-z plane @ t=0.1s
37.5 37.5 38 37.5 42 48 37.5 Field (linear) NLP-E (beta=0)

x (mm)

0 -2 -4 85

90

95

100

105

110

115

z (mm)

Temperature profile on x-z plane @ t = 0.5s

(b)

4 2

39 40 39 50 80 70 60

Field (linear) NLP-E (beta=0)

x (mm)

0 -2 -4 85

90

95

100

105

110

115

z (mm)
Figure 4-9. Temperature contours around the focal spot after: (a) 0.1s, (b) 0.5s of HIFU exposure

As it can be seen in Fig 4-9, both programs yields almost similar contours. Both programs (NLP-E and Field), return the lesion size and its location at the conclusion of temperature simulations. Table 4-1 summarizes these data for exposure time of 0.5 s followed by a cooling period of 0.5s.

Table 4-1. Thermal lesion data Thermal treatment results
Highest temperature reached ( C) Location of the highest temperature (x,y,z) (mm) Lesion size (mm x mm x mm) Lesion center (x,y,z) (mm)
o

NLP-E
82.61 (0,0,99.77) 1.563x1.563x8.299 (0,0,100.02)

Field
82.79 (0,0,99.66) 1.577x1.577x8.174 (0,0,99.88)

124

Chapter 4: Results ________________________________________________________________________ In Table 4-1 above, the lesion center is defined as the point where the highest dosage has occurred and the lesion size is based on the volume of points accumulating a dose higher than 240 equivalent minutes at 43 oC 9 .

4.2 Nonlinear Simulations
In section 4.1 we noticed that the NLP-E code returns impressive results in linear mode. In this section the results of its performance in nonlinear mode is presented.

4.2.1 Comparison with the KZK
In order to validate our methodology and test the NLP-E performance in nonlinear mode, we'll be comparing the results obtained using the NLP-E with published KZK simulations and experimental results available in the literature. In their 1995 paper, Averkiou and Hamilton (Averkiou and Hamilton 1995) presented their simulation results obtained through the simulations of the KZK and compared them with experimental results. In this section we have been using the exact same source and medium parameters as used by Averkiou and Hamilton. Fig 4-10 displays the source geometry and excitation parameters.

Concave source fo = 2.25 MHz Po = 92.5 KPa D=37.6mm O

R=160mm

z
F

Medium: Water

Figure 4-10. Source and medium parameters used for comparison with the KZK nonlinear model.

9

Refer to section 2.6 for the definition of thermal dose

125

Chapter 4: Results ________________________________________________________________________

The parameters used in this simulation include: Radius of curvature (R) = 160 mm Diameter of aperture (D) = 37.6 mm Medium density (  o ) = 1000 Kg/m3 Small signal speed of sound ( co ) = 1486 m/s Source pressure (Po) = 92.5 Kpa Source frequency (fo) = 2.25 MHz Attenuation coefficient at 2.25MHz ( ) = 0.1645 Np/m Coefficient of nonlinearity (  ) = 3.5 Number of harmonics retained (Nf) = 10 Power factor of power law of attenutaion ( ) =2 Initial plane axial location ( z0 ) = 0 mm Spatial sampling interval of the propagation plane =  / 15 Spatial sampling interval of the initial plane = 0.3 mm Spatial extent of the propagation plane = 44mm × 44mm Spatial extent of the initial plane = 37.6mm × 37.6mm Propagation steps ( z ) = 5mm Number of propagation planes: 51

Fig. 4-11 below shows the pressure lateral profiles for fundamental and three harmonics at z = 85, 100, 120, 160 and 250mm. Results of the NLP-E code have been presented on the left hand side and the KZK + experiment results of Averkiou and Hamilton on the right hand side of Fig. 4-11. The results of Averkiou and Hamilton include both experiment (solid line) and theoretical (dotted line) results.

126

Chapter 4: Results ________________________________________________________________________

Lateral pressure profile at z=85mm
1000 100 10 1 0.1 -20 -10 0 10 20

Pressure [kPa]

x (mm)
Lateral pressure profile at z=100mm
1000 100 10 1 0.1 -20 -10 0 10 20

Pressur e [kPa ]

x (mm)
Lateral pressure profile at z=120mm
1000 100 10 1 0.1 -20 -10 0 10 20

Pressure [kPa]

x (mm)
Lateral pressure profile at z=160mm
1000

Pressure [kPa]

100

10

1

0.1 -10 -5 0 5 10

x (mm)

Figure 4-11. Lateral pressure profiles at various axial locations. Left column: NLP-E results, Right column: Experiment (solid line) and KZK results (dotted line) by Averkiou and Hamilton, 1995.

127

Chapter 4: Results ________________________________________________________________________
Lateral pressure profile at z=250mm
1000 100 10 1 0.1 -15 -7.5 0 7.5 15

Pressure [kPa]

x (mm)

Figure 4-11. Continued

As it can be seen in Fig. 4-11, a very good agreement exists between our results and those obtained from the KZK nonlinear model.

Generation of harmonics as shown in Fig. 4-11, causes distortion of the pressure waveforms from simple sinusoidal waveforms. Fig. 4-12 displays the normalized pressure waveform as a function of time at different axial locations. The linear gain at the focus can be calculated using Eq. (2.3-7) to be 10.27. As it can be seen in Fig. 4-12, the nonlinearity causes the peak pressure to be higher than what's predicted from the linear approximation. At the same time, the peak negative pressure decreases and the waveform becomes asymmetrical unlike nonlinear propagation of a plane wave where the symmetry of the waveform is maintained (see Fig. 2-21; on page 45).
Tem poral pressure waveform
25 20 15 10 5 0 -5 -10 0 z=160m m z=140m m z=120m m

p / po

0.25

0.5

0.75

1

1.25

1.5

1.75

2

t / To

Figure 4-12. Nonlinear distortion of the pressure wave at different axial locations.

128

Chapter 4: Results ________________________________________________________________________

4.2.2 Effect of Nonlinearity
Now that we have shown that the NLP-E yields accurate results both in linear and non-linear modes, we can compare the results between the two modes (linear vs. nonlinear) and investigate how nonlinearity effects affects the acoustic and thermal responses. A nonlinear code such as NLP-E enables us to quantify these differences and see how significant they could be. These differences will be more pronounced at higher source pressures, in media with lower attenuation coefficient such as water or in focused sources. That's why the study of nonlinearity effects is specially important in high intensity focused applications such as HIFU.

The simulations is this part are divided into two parts (i) (ii) In water In tissue

This would enable us to see and describe different aspects of the nonlinear propagation of ultrasound. In each section two simulations are run using NLP-E code. One in linear mode and another in nonlinear mode and the results are compared. The linear simulations are performed by setting the coefficient of nonlinearity to zero (  = 0 ) .

(i) In water:
Fig 4-13 displays the source geometry and excitation parameters which will be used in simulations of this section. The source pressure (Po) was selected such that it produces 2500 W/cm2 of focal intensity in water which is around the same range as used in a typical HIFU application.

129

Chapter 4: Results ________________________________________________________________________
D =20mm

Radiator surface fo = 1MHz Po = 1.2 MPa
Water

R =25mm

F

z

Figure 4-13. Source geometry and excitation parameterss.

Other simulation parameters include: Water density = 1000 Kg/m3 Small signal speed of sound in water = 1500 m/s Attenuation coefficient at 1MHz in water = 2.5 × 10 -2 Np/m Power factor of power law of attenuation (water) = 2 Coefficient of nonlinearity (water) = 3.5 Spatial sampling interval of the propagation plane =  / 15 Spatial sampling interval of the initial plane = 0.4 mm Spatial extent of the propagation plane = 26mm × 26mm Spatial extent of the initial plane = 20mm × 20mm Propagation steps = 1mm Number of propagation planes: 30 The simulation was repeated twice. Once it was run in linear mode by selecting  = 0 and the second time in nonlinear mode by selecting  = 3.5 . Nonlinearity produces harmonics with increasing amplitudes towards the focal spot where the pressure amplitude is elevated. This has been displayed in Fig. 4-14 (a) where the axial pressure profile for the fundamental and two more harmonics have been plotted.

130

Chapter 4: Results ________________________________________________________________________ For comparison the results of the linear simulations have been plotted on the same graph.

Lateral press ure profile at z=25mm (focal plane)
7 6
1st

5 4 3
2nd

|P|/P o

2
3rd

1 0

-10

-5

0

5

10

x (mm)

Figure 4-14. Harmonic generation at the focal plane. The dotted line is the linear approximation

As it can be seen in Fig. 4-14, the amplitude of the fundamental around the focal spot is lower than what's predicted by linear simulations. That's because part of the energy is transferred from the fundamental into higher harmonics.

Fig. 4-15 below displays pressure vs. time waveforms at different axial locations both in linear and nonlinear modes. Pressure values have been normalized to the amplitude of the source pressure (Po) to reflect the gain at each location and the time axis have been normalized to period of the fundamental (To ). As it can be seen in Fig. 4-15 (a), at z =18mm, both linear and nonlinear simulations yield almost similar results. But as we move along the z axis towards the focal point (z = 25mm), the difference becomes more obvious. It's worth noting that in Fig. 4-15 (a),(b) the pressure peak compression phase has shifted to left while the peak rarefaction phase has shifted to right which is in accordance with nonlinear propagation. The reason is that the peak compression propagates faster through the medium in contrast to the rarefaction phase. As the wave propagates forward, they gradually move closer to form a shock front. However due to attenuation there's a limit to the shock front rise time.

131

Chapter 4: Results ________________________________________________________________________
Temporal pressure waveform at z=18mm

(a)

6 4

Linear Nonlinear

p(t)/P

2 0

o

-2 -4 0 0.5

t/T

1

1.5

2

o

Temporal pressure waveforms at z=22mm

(b)

15
Linear Nonlinear

10

p(t)/P

o

5

0

-5

-10 0

0.5

1

1.5
o

2

t/T

(c)
15 10
o

temporal pressure waveform at z=25mm (focal point)
Linear Nonlinear

p(t)/P

5 0 -5

-10 0

0.5

1 t/T

1.5

2

o

Figure 4-15. Pressure waveforms at different axial locations (linear vs. nonlinear)

132

Chapter 4: Results ________________________________________________________________________

This fact can be seen more clearly in Fig 4-16 where pressure waveforms at different axial locations have been plotted in one graph. The gradual shift of the pressure peak compression phase to the left and the peak rarefaction phase to the right and formation of a rapid rise time is clearly seen in these waveforms.

Temporal pressure waveforms
12 10 8 6 z=18mm z=22mm z=25mm

p(t)/po

4 2 0 -2 -4 -6 -8 0 0.5 1 1.5 2

t / To

Figure 4-16. Waveform distortion at different axial locations of a focused source in water due to nonlinearity

(ii)

In tissue:
Simulations in tissue were performed to investigate the effect of nonlinearity in

high intensity focused treatments such as HIFU. Attenuation coefficient in tissue is typically 2 orders of magnitude higher than that in water. As a result the effect of nonlinearity will be suppressed in tissue by higher absorption. In this section we will use the same geometry and source excitation as in section (i). Since in an actual HIFU set-up, a layer of water exists between the transducer and the tissue (as a coupling medium), the medium properties were selected to be an average between those of water and the tissue. These averages were calculated based on 70% water and 30% tissue.

The parameters used in this section include: 133

Chapter 4: Results ________________________________________________________________________

Radius of curvature (R) = 25 mm Diameter of aperture (D) = 20 mm Tissue density = 1000 Kg/m3 Small signal peed of sound in tissue= 1500 m/s Small signal peed of sound in tissue = 1500 m/s Source pressure (Po) = 1.2 MPa Source frequency (fo) = 1 MHz Attenuation coefficient at 1MHz in tissue = 1.744 Np/m Power factor of power law of attenuation (tissue) = 1.73 Coefficient of nonlinearity (tissue) = 3.82 Spatial sampling interval of the initial plane = 0.4 mm Spatial extent of the propagation plane = 26mm × 26mm Spatial extent of the initial plane = 20mm × 20mm Propagation steps = 1mm Number of propagation planes: 60

The simulation was repeated twice. Once it was run in linear mode by selecting  = 0 and the second time in nonlinear mode by selecting  = 3.82 . By comparing the results of two simulations, we can observe and quantify the effect of nonlinearity. Fig. 4-17 displays the pressure waveform at the focal point in both linear and nonlinear modes. Nonlinearity distortion has slightly subsided compared to results of section (i) in water (see Fig. 4-16 (c)) as the peak pressure has dropped around 10%. This is expected due to higher absorption in tissue; however since the nonlinearity coefficient is slightly higher in tissue, the nonlinear distortion remains significant. Higher harmonics have higher attenuation coefficients due to the frequency power law and hence are absorbed by the medium faster. This will result in higher heat deposition rate in the focal region than what's predicted by the linear theory.

134

Chapter 4: Results ________________________________________________________________________
Pressure temporal waveform at focal point
15 Nonlinear Linear 10

p(t)/p o

5

0

-5

-10 0

0.5

1

1.5

2

t/To

Figure 4-17. Pressure waveform distortion due to nonlinearity in tissue

Fig. 4-18 illustrates the difference in the power deposition rate around the focal region in the linear and nonlinear simulations.
Lateral Q profile at z=25mm (focal point)
300 Linear Nonlinear 250

200

Q (W/cm3)

150

100

50

0 -10

-8

-6

-4

-2

0

2

4

6

8

10

x (mm)

Figure 4-18. Increase of the heat generation rate in the focal region as a result of nonlinear propagation.

The increase in heat deposition rate speeds up the onset of lesion creation in the focal region at the start of the treatment. However if the treatment is continued, this effect will not be as important in determining the overall size of the lesion (Curra et al. 2000).

135

Chapter 4: Results ________________________________________________________________________ To demonstrate this effect, temperature response for exposure time of 0.7 s (Ton ) was obtained. Fig. 4-19, shows temperature maps and lesion formation progress in 0.1s time intervals. The lesion boundaries are determined through accumulated dosage data which is calculated using Eq. 2.6-1 based on temperature data. Any point accumulating a thermal dose of 240 equivalent minutes at 43 oC or higher is considered to be part of the lesion.

(a)

Temperature contour at t=0.1s
5
T(oC)-linear T(oC)-nonlinear

x (mm)

0

45

45

40

40

-5 10

15

20

25

30

35

40

45

z (mm)

Temperature contour at t=0.2s

(b) 5
T(oC)-linear T(oC)-nonlinear

x (mm)

0

53

53

43

43

-5 10

15

20

25

30 z (mm)

35

40

45

(c)

Temperature and lesion contours at t=0.3s 2
T (oC)-linear

1 x (mm) 0 -1 -2 10 15 20 25 30 z (mm) 35 40
60 60

T(oC)-nonlinear Lesion-nonlinear

45

Figure 4-19. (a,b,c) Development of temperature and lesion contours (linear vs. nonlinear) over time.

136

Chapter 4: Results ________________________________________________________________________
(d)
Temperature and lesion contours at t=0.4s 2 1 x (mm) 0 -1 -2 10 15 20 25 30 z (mm) 35 40 45
67 67 T(oC)-linear Lesion-linear T(oC)-nonlinear Lesion-nonlinear

(e)

Temperature and lesion contours at t=0.5s 2
T(oC)-linear

1 x (mm) 0 -1 -2 10
74 74

Lesion-linear T(oC)-linear Lesion-nonlinear

15

20

25

30 z (mm)

35

40

45

(f)

Temperature and lesion contours at t=0.6s 2 1
T(oC)-linear Lesion-linear T(oC)-nonlinear Lesion-nonlinear

x (mm)

0 -1 -2 10

81

81

15

20

25

30 z (mm)

35

40

45

Temperature and lesion contours at t=0.7s

(g)
x (mm)

2 1 0 -1 -2 10
86 86
T(oC)-linear Lesion-linear T(oC)-linear Lesion-nonlinear

15

20

25

30

35

40

45

z (mm)

Figure 4-19. (d,e,f,g) -Continued

137

Chapter 4: Results ________________________________________________________________________ As it can be seen in Fig. 4-19 (a),(b) , no lesion is created prior to t=0.2s. At t=0.3s, lesion starts to form but only in nonlinear model (see Fig. 4-19 (c)). In other words the onset of lesion creation is earlier as a result of nonlinearity. However as time passes by, the ratio between the lesion volume predicted in linear mode versus that in nonlinear mode decreases. This is due to the fact that the increase in heat deposition rate is only limited to a small volume. As the lesion grows, the elevated heat absorption rate in the middle of lesion is no longer a big factor in the overall size of the lesion. It's also worth noting the expansion of high temperature contours in the middle of lesion as a result of excess heat deposition rate due to nonlinearity.

138

Chapter 5: Discussions and Conclusions ________________________________________________________________________

Chapter 5: Discussions and Conclusions
In this chapter we will provide discussions and draw conclusions from the results obtained and lay out a road map for future works.

5.1 Significance of the Work
In this section we will provide an overview of the enhancements implemented into NLP-E code and point out their significance in nonlinear simulations of the acoustic beam.

5.1.1 Arbitrary Excitation and 3D Source Geometry
Using the NLP-E code, user can now define any 3D source geometry and excitation as needed. This would enable simulations of variety of transducers in any shape or form. An example was demonstrated in Chapter 4 where an IFUS transducer with a hole in the middle (see Fig. 4-1(a)) was simulated. Many nonlinear codes are limited to simple source geometries such as spherical, circular or rectangular shapes. Thus this enhancement serves as an important step in the right direction.

5.1.2 Full Diffraction Solution

As discussed in section 2.3.4, phase shift methods offer a simple way to propagate the field from the source to a plane nearby. However they include errors which increase with the distance between the source and the plane. For a curved source this distance inherently exists and hence presents a source of error. A full diffraction solution using the

139

Chapter 5: Discussions and Conclusions ________________________________________________________________________ Rayleigh diffraction integral on the surface of the source eliminates such errors. This is particularly important in implementation of methods of fractional steps as the error is cumulative. In other words the error on the first plane will gradually grow as the results of the previous plane are used to find the field on the next plane and so on so forth. Thus a full diffraction solution is a great complement to our 3D arbitrary source geometry and excitation methodology.

5.1.3 Enhanced Pressure

The enhanced pressure formula enables calculation of the pressure in a given plane in terms of the normal particle velocity in the same plane (see Eq. (2.4-55)). A more simple way to calculate the pressure is through the impedance relation which is only exact for a plane wave propagating in an inviscid medium. We have demonstrated (see section 4.1.2 for example) that for a concave spherical source with dimensions and excitation frequencies around those of interest in biomedical ultrasound, the impedance relation based on the plane wave approximation yields substantially lower pressure values. A particular area of interest is the focal region where a significant difference between the two methods is observed. The difference in predicted pressure cause an even more disparity in intensity values percentage wise as the intensity is related to pressure by the power of two. Since the intensity values are directly proportional to heat generation rate, this will in turn effect temperature predictions as well. Thus implementation of the enhanced pressure formula in the NLP-E code serves as an important step towards providing more accurate predictions of both pressure and temperature as measurable physical quantities.

In implementation of the enhanced pressure formula we managed to resolve the singularity issue in the transfer function of normal particle velocity to pressure (Eq. (2.417) , section 2.4.1) by making use of k or a complex wave number. By using a complex wave number, the singularity in Eq. 2.4-17 is eliminated and calculating the inverse 2D

140

Chapter 5: Discussions and Conclusions ________________________________________________________________________ Fourier transform becomes a well posed problem. Alternatively the singularity in Eq. (2.4-17) can be avoided by implementing a narrow band stop filter around the singularity. However the complex wave number method offers three benefits over the filtering method: first the signal is not attenuated due to filtering. This attenuation can be significant regardless of how narrow the band stop filter might be. This is because the transfer function amplitude becomes increasingly larger as one moves closer to the singularity and a filter removes all those components. Second, a complex wave number intrinsically accounts for viscous absorption in the medium. And third it's computationally more efficient than filtering.

5.1.4 Temperature Simulations
The NLP-E code was coupled to a BHTE solver to perform simulations of temperature and thermal dose within the tissue. Temperature predictions are important in therapeutic applications of ultrasound as they will enable us to plan a thermal treatment. The program also accounts for excess heating due to nonlinearly-induced harmonics. As mentioned in section 4.2.2 in Chapter 4, it's important to account for nonlinearity as it plays an important role in the development of a thermal lesion specially in the initial phase of the treatment. For instance, in a HIFU treatment, an appropriate power, exposure on time, and cooling time can be planned to create a certain lesion size. A wide range of lesion sizes can be created with the right combination of total acoustic power, exposure and cooling times. In this regard, combination of the NLP-E and BHTE would take us one step further in comparison to a linear code. For example by taking advantage of nonlinearly induced excess heat in a confined area around the focal spot, smaller lesions can be formed for highly localized treatment sites such as neurological applications. Our novel approach in implementing BHTE within the NLP-E code has made it very efficient in terms of computational time. Interpolating Q between two adjacent planes along with exploiting matrix operations have cut down the computational burden significantly compared to other codes.

141

Chapter 5: Discussions and Conclusions ________________________________________________________________________

5.2 Future Work
In this section we will provide an overview of what needs to be done in future to make the NLP-E code even more versatile and efficient.

5.2.1 Pulsed Wave Model
NLP-E code simulates the continuous wave (CW) propagation of the ultrasound beam. A CW model is suitable for applications in which the duration of excitation signal is long enough compared to the period of the fundamental component. For example in a typical HIFU treatment, where power is delivered for a few seconds at frequencies of a few MHz, the input signal can be considered a continuous wave. However in modalities such as histotripsy and lithotripsy in which short pulses of ultrasound is applied, a continuous wave model is no longer valid. It's therefore desirable to develop a pulsed wave model to be able to simulate the propagation of short pulses of ultrasound.

5.2.2 Multilayer Medium
In the current version of the NLP-E code it's assumed that the medium is homogenous. However, as we know, the ultrasound beam generally passes through several layers of tissue such as skin, fat, muscle, etc. It's therefore necessary to expand its capability to be able to simulate multilayer tissue structures. This task is readily achievable considering the inherent layer-by-layer propagation scheme of the NLP-E code.

5.2.3 Enhanced Heat Deposition Rate
In the latest version of the NLP-E code, the heat deposition rate (Q) is calculated using the pressure amplitude of harmonics through the following formula (see Chapter 2, section 2.6.2):
Q =

n  | Pn | 2 n =1  o c o
N

(5.2-1)

142

Chapter 5: Discussions and Conclusions ________________________________________________________________________ where N is the total number of harmonics retained and | Pn | is the pressure amplitude of of the nth harmonic. However Eq. (5.2-1) is only valid when the coefficient of shear viscosity is zero. We have derived a more general formula for Q (see Appendix-D) which is valid in any viscous liquid without any restrictions on the shear viscosity. In this formula, Q is expressed in terms of the amplitudes of x,y,z components of the particle velocity instead of the amplitudes of pressure as stated in Eq. (5.2-2) below10 :
N

Q =  co o n  | Vx |2 + | Vy |2 + | Vz |2
n =1

[

]

(5.2-2)

Eq. (5.2-2) indicates that all components of the particle velocity should be known to be able to calculate the Q . However the NLP-E code calculates only the normal component of particle velocity on each propagation plane. In Appendix-D we've been also offering a method which enables calculation of x and y components of the particle velocity knowing only its normal component over the extent of an entire plane. Hence Eq. (5.2-2) can be alternatively used to calculate the Q in the NLP-E. Implementation of Eq. (5.2-2) into NLP-E will serve as another potential enhancement for future work.

5.2.4 Dynamic Medium
The addition of a BHTE module to the NLP-E code enables us to predict the temperature as a function of time. We also know that the medium properties change as function of temperature (Kolios et al. 1999). In view of this a dynamic model can be developed to change the medium properties accordingly. A table of acoustic and thermal properties of the medium at certain temperature levels should be defined as part of the parameters file. The program starts initially assuming room temperature and continues to
10

See Appendix-D for derivation

143

Chapter 5: Discussions and Conclusions ________________________________________________________________________ calculate the temperature as a function of time. As soon as a temperature threshold is crossed, another run of the acoustic part with new parameters is done followed by the temperature simulations until the second threshold is reached. The process is then repeated till the end of the treatment period. A dynamic medium model can be also used to address the creation of vapor bubbles in HIFU exposures. When the focal temperature reaches the boiling point and the vapor bubbles starts to appear, the acoustic and thermal properties can be changed drastically to reflect those effects.

5.2.5 Cavitation Model
Bubble activities play an important role in lesion formation during high intensity focused ultrasound applications. Enhanced heat deposition rate in the focal region due to nonlinear propagation of ultrasound and cavitation processes due to peak negative pressure cycle, create bubbles which can precede the lesion formation (Bailey et al. 2003). The Significance of bubbles in enhanced heating has been widely recognized (Holt and
Roy 2001, Khokhlova et al. 2006). Multiple scattering of the acoustic energy by bubbles

traps the acoustic energy within the volume where cavitation occurs and results in increased absorption (ter Haar and Coussios 2007). It's therefore necessary to take bubble activities into consideration in modalities such as HIFU or histotripsy where bubbles are often created within the focal region. Standard bubble dynamic models such as RayleighPlesset-Noltingk-Neppiras-Poritsky (RPNNT) (Akulichev 1971) and Gilmore-Akulichev
(Church 1989) can be coupled to the nonlinear acoustic model to account for bubble

activities.

144

Appendix-A ________________________________________________________________________

Appendix-A
Instructions to Run NLP-E

NLP-E should be run using Matlab® version 7.4 or later. NLP-E contains three principle m files and a series of functions which are called upon. The principle m files and their tasks include:
CW_NLP_E_2009.m which controls the flow of the program. The program starts by

running this file.
Parameters.m which stores all user definable parameters such as dimensions, medium

acoustic and thermal properties, etc.
Main2009_bhte.m which is the main body of the program.

The name of the functions and their tasks are:
truncsphshell.m creates a geometry matrix for a truncated sphere shell. bhte_2008.mexw32 performs BHTE temperature and thermal dose calculations calc_tr_fxn_H.m builds a matrix of the transfer function H by sampling it in spatial

frequency domain (see section 2.1.2 for definition of H)
sample_h.m builds a matrix of the transfer function H by sampling h in spatial domain

and calculating its 2D Fourier transform
modularFDSBE2002.m executes the nonlinear propagation step attenuation.m creates an attenuation matrix in spatial frequency domain to be applied to

H
circ_win.m builds a tapered circular window with radius r_cut around the observation

plane.

All above mentioned files (with exception of Parameters.m) should be stored in one directory. The path to this directory has to be indicated in CW_NLPE_2009.m file in

145

Appendix-A ________________________________________________________________________ `maindir'. Parameters.m file can be saved in a different directory for housekeeping purposes with an appropriate folder name (e.g. date of simulation, etc.). In Parameters.m file another directory for saving temporary files have to be indicated in `dirname'. When CW_NLPE_2009.m is run, the program initially asks for the location of the desired parameters file. It will then ask for a location and a name where you want to save the simulation results. The simulation results will be saved in .mat format which can then be retrieved using the load command. The variables which are saved and made available at the conclusion of NLP-E run include:

`axial' : Axial normal particle velocity for all harmonics in [m/s] `lateralx' : Lateral normal particle velocity along x direction for all harmonics in [m/s] `lateraly' : Lateral normal particle velocity along y direction for all harmonics in [m/s] `PE_axial' : Axial pressure for all harmonics in [Pa] `PE_lateralx': Lateral pressure along x direction for all harmonics in [Pa] `PE_lateraly': Lateral pressure along y direction for all harmonics in [Pa] `Po': Pressure at the source surface in [Pa] `x_obs': Observation points along x direction `y_obs': Observation points along y direction `I_axial': Total time-averaged axial intensity profile [W/m2] `I_lateralx': Total time-averaged lateral intensity profile along x direction [W/m2] `Q': Power deposition rate at all calculation planes [W/m3] `ZQ': z coordinates of calculation planes in BHTE domain where intensity and power deposition values were calculated

The results of the BHTE part of the program are saved in the main directory under the general name of `tmpl_x.mat' where x is the time stamp of the temperature and thermal dose readings.

146

Appendix-B ________________________________________________________________________

Appendix-B
Published Paper
Canadian Acoustics, Vol. 37 No. 3 (2009), p. 172-173

AN ENHANCED NUMERICAL MODEL TO SIMULATE NONLINEAR CONTINUOUS WAVE ULTRASOUND FIELD
Shahram Mashouf, Jahan Tavakkoli
Dept. of Physics, Ryerson University, Ontario, Canada, M5B 2K3 jtavakkoli@ryerson.ca

INTRODUCTION

Within the realm of therapeutic ultrasound, high intensity focused ultrasound (HIFU) is a rapidly expanding modality with applications in tumor necrosis, hemostasis and immunotherapy (Bailey et al. 2003). In this method of treatment highly focused ultrasound beams induce a rapid temperature rise around the focal spot due to conversion of acoustic energy to heat. Precise, well defined lesions can be created inside the tissue due to thermal coagulation. One advantage of HIFU over other similar treatment modalities is that it can be performed noninvasively. Selecting the right transducer and excitation parameters ensure that underlying tissue layers remain intact and tissue coagulation happen only around the focal spot. Due to high acoustic pressure amplitude and intensity produced in focal region, a significant nonlinear distortion can be observed and thus an accurate propagation model needs to include the effect of nonlinearity (Curra et al. 2000) The model that we present here is based on a second-order operator splitting method where the acoustic field is propagated over incremental steps taking into account the effects of diffraction, nonlinearity and attenuation. This model is in essence a modified version of the KZK

147

Appendix-B ________________________________________________________________________ model where the parabolic diffraction term is replaced by a more accurate full diffraction term. This method was first introduced by Christopher and Parker (Christopher and Parker
1991) for axi-symmetric sources and then improved by Tavakkoli et al. (Tavakkoli et al. 1998) via implementing larger propagation steps. It was then extended by Zemp et al. (Zemp et al. 2003) to general non axi-symmetric problems using angular spectrum method.

In this work, we'll be further refining this method by introducing arbitrary source geometry and excitation definition, full diffraction solution, enhanced pressure calculation, and enhanced power deposition rate and temperature prediction capabilities. The result is a particularly useful tool in carrying out simulations of HIFU beams in tissue including temperature rise predictions. Since a typical HIFU power is usually delivered for the duration of a few seconds at frequencies of a few MHz, a CW simulation will be suitable.
METHOD

The KZK equation, which accounts for combined effects of diffraction, attenuation and nonlinearity in propagation of acoustic beam, is given in Eq. (1) below:
 p co = z 2

-





2 

pd +

p 2  (1) 1  4  2 p  B +   2 +   3   2 c o  o  3   

The first term on the right hand side is the diffraction term in parabolic approximation, the second term reflects the effect of attenuation and the third term is due to nonlinearity. The pressure field can be calculated over propagations planes in incremental steps by bringing
p z

to the left side as in Eq. (1). Also based on the above equation, the effects of

diffraction, attenuation and nonlinearity can be applied independently over propagation planes and then added together. This is often referred to as operator splitting method. In the second-order operator splitting method, a certain propagation scheme is maintained which enable larger propagation steps and faster computational time (see Fig.1)
(Tavakkoli et al. 1998).

148

Appendix-B ________________________________________________________________________
D N+A D N+A

z
z
D

Figure 1. Second-order operator splitting method. D, N, and A represent operators for diffraction, nonlinearity and attenuation respectively.

Note that in this method, nonlinearity and attenuation are combined and propagated in one step. For a CW periodic waveform, the equations of propagations in each step shown in Figure 1 are presented here. For diffraction over the nth harmonic:
-1 v z ( x , y , z + z ) =  2  2 D {v z ( x , y , z )}× H (k x , k y , z )} (2) D{

where H ( k x , k y , z ) = e jz

2 2 k 2 -( k x +k y )

and

k = 2 ( nfo ) / co

and k x , k y

are spatial frequency

components. This will be repeated over N harmonics ( n = 1 to N). For
n

nonlinearity
n o 2 o

and

attenuation
(3)

over

the

nth

harmonic: v ( z + z ) = v ( z ) + j 2 f 2c over N harmonics as well.

N  n -1 b *  z   ivi vn -i +  nvi vn -i  -  o ( nf o ) vn z i = n +1  i =1 

which will be repeated

In the enhanced version of the algorithm, user has the capability to define an arbitrary source geometry and input excitation. Since the propagation is done plane by plane, this will require an extra initial step to propagate the field from the surface of transducer to an initial plane. This step is done using the Rayleigh diffraction integral which assumes linear propagation from the source to the first plane. Another method to accomplish this is to propagate the beam from the source onto the initial plane by introducing simple phase shifts. Phase shift methods, however, produce inaccurate results in near field specially when the source surface is highly focused The normal particle velocity is then calculated on equally spaced discrete points across the initial plane (intersection of solid lines in Fig. 2). The calculated values of v z is then expanded and assigned to the adjacent squares (dotted lines) to create a 2D array as

149

Appendix-B ________________________________________________________________________
y Figure 2. Initial plane as a 2D array.

x
w

( xc y , yc )
w

shown in Fig. 2.Since the value of v z across any given square (e.g. the shaded area shown
( x - xc ) ( y - y c )  in Fig. 2) is constant, it can be written in compact form as v z = vo rect ,    w w 

where w is the width of the array element and ( xc , y c ) is the location of the element's centre. The rect function has an analytical 2D Fourier transform as below:
 2 D ( v z ) = v o w 2 sinc( w
- j ( k x xc + k y yc ) ky kx ,w )× e 2 2

(4)

Eq. 4 is then added up across all array elements to calculate the Fourier transform of the entire plane. The result is then feed into Eq. 2 to perform the first half step diffraction as illustrated in Fig. 1. After finishing diffraction substep, the result is then converted back to spatial domain using inverse Fourier transform and a nonlinear substep is subsequently performed using Eq. 3. The process is then repeated to propagate the field along the z direction.
RESULTS

The results obtained using our method were compared with other methods both in linear and nonlinear regimes. In overall, excellent agreements were observed. Fig. 3 displays lateral pressure profiles for a concave spherical transducer with effective radius of curvature of 160 mm and aperture diameter of 37.6 mm working at a frequency of 2.25 MHz and with a source pressure of 92.5 KPa. Our results are in excellent agreement with those obtained by Averkiou and Hamilton (Averkiou and Hamilton 1995) using the KZK nonlinear model as shown in Fig. 3.

150

Appendix-B ________________________________________________________________________
1000 Pressure [kPa] 100 10 1 0.1 -20 -10
x (mm)

0

10

20

1000 Pressure [kPa] 100 10 1 0.1 -20 -10
x (mm)

0

10

20

Figure 3. Our simulation results (left column) vs. the KZK nonlinear model (solid and dashed lines represent measurement and simulation results, respectively), for the fundamental and first 3 harmonics.

ACKNOWLEDGEMENTS
This work was partially supported by the Dean's Start-up Fund from Ryerson University.

151

Appendix-C ________________________________________________________________________

Appendix-C
"Field" program
Field is a program which conducts linear simulation of continuous wave ultrasound in a homogenous medium. In this thesis we've made use of Field to conduct linear simulations of ultrasound for the sake of comparison with our results or validation of our methodology. In Field the pressure is calculated by dividing the source into small rectangular elements. The pressure at any given Field point is then calculated by summing up the contribution of each surface element over the entire surface area of the source. The pressure contribution of each surface element is calculated through an analytical formula originally proposed by Ocheltree and Frizzel (Ocheltree and Frizzell 1989) as below: P = j o c o wh v no exp(- ( + jk ) R )  ky h   kx w  sinc    sinc  R  2R   2R  (C-1)

where x  , y  and z  are the coordinates of the field point where the pressure is to be calculated in the coordinate system attached to the element (see Fig. C-1 and/or "List of Symbols" for definition of parameters used in Eq. (C-1)).

z

y

P

R

h
O

x

w
Figure C-1. Definition of parameter

152

Appendix-C ________________________________________________________________________ Ocheltree and Frizzel (Ocheltree and Frizzell 1989) have used the discrete format of the following surface integral to arrive at Eq. (C-1): P= j o c o e - ( - jk ) r dS vn  r S



(C-2)

Here we'd like to demonstrate that this equation provides the exact pressure term and is not based on an impedance relation between pressure and particle velocity. Starting from the Rayleigh integral in terms of the velocity potential, we can write (Cobbold 2007): e - j kr dS r

s =

1 2

 v n
S

(C-3)

where v n is the normal particle velocity at the source surface. We also derived in Chapter 2, section 2.4 (see Eq. 2.4-41), the following expression for pressure: P= -k s j
2

(C-4)

Substituting Eq. (C-3) into Eq. (C-4) yields:
P= jk
2

2

 vn
S

e - j kr dS r

(C-5)

Substituting k = k - j (see Eq. (2.4-49), Chapter 2, section 2.4)) into Eq. (C-5), yields: P= j ( k - j ) 2 2

 v n
S

j ( k 2 -  2 - 2 jk ) e - j ( k - j ) r e - j ( k - j ) r dS dS = v n  2 r r S

(C-6)

(3.1-7) Noting c o = 1 /  o (Cobbold 2007), we can write:
2  = 1 /( c o o )

(C-7)

Substituting Eq. (C-7) into Eq. (C-6) and noting  << k :
2 o jk ( k - 2 j )c o P= 2

e - j ( k - j ) r dS vn  r S

(C-8)

which can be simplified as:

153

Appendix-C ________________________________________________________________________ ( 2 - jk )c o  o P= 2 e - j ( k - j ) r vn dS  r S (C-9)

Since  << k for most biological tissues, the term 2 can be ignored to yield: P= - jco  o



 vn
S

e - ( + jk ) r dS r

(C-10)

which is the same formula as used by Ocheltree and Frizzell. In other words pressure calculated by the Field program does not have an impedance approximation.

154

Appendix-D ________________________________________________________________________

Appendix-D
Enhanced Q - An Imporved Formula

In the NLP-E code we use the pressure amplitude of harmonics to calculate the enhanced heat deposition rate (see Eq. (2.6-5), Chapter 2, section 2.6.2). As explained in that section, this equation is only valid when the coefficient of shear viscosity is zero. In this Appendix we'll present a more general formula which is valid in any viscous liquid without any restrictions on the shear viscosity. r We start from Q = -  I equation which is a conservation of energy relation (Nyborg
1981):

r   r   Q = -  I = -  ( p  v ) = -   x ( p  v x ) + y ( p  v y ) + z ( p  v z )    v y  v x v z p  p p  +  +  +  +  +  = -  v p v p v p z y x         z z y y x x  

.(D - 1)

In the case of a CW periodic excitation, each pair on the right hand side of Eq. (D-1) comprise of a product of two temporal waveforms (v and u) which can be written in a general form as below:  v =  vn cos(nt + vn )    n =1   u =  un cos(nt + un )  n =1    v . u =   v u cos(it +  ) cos( jt +  ) i j vi uj i =1 j =1 Using cos  cos  = 1 [cos( -  ) + cos( +  )] we can write : 2 (D-2)

155

Appendix-D ________________________________________________________________________
vi u j cos(it + vi ) cos( jt + uj ) = vi u j 2

(cos[(i - j )t + 
vi u j 2

vi

- uj ] + cos[(i + j )t + vi + uj ])

As a result temporal averages of the terms on the right hand side of Eq. (D-2) will be zero unless i = j , where in that case it equals to simplified as:  1 1   v.u =  u v cos( -  ) =  Re Vn  U n n n vn un 2n =1 n = 12
cos( vi -  uj ) . Hence Eq. (D-2) can be

{

}

(D-3)

Where Vn and U n are complex numbers representing the phasor of each harmonic. Using Eq. (D-3), the temporal average of Q as presented in Eq. (D-1), can be written as follow:
 V  V V 1    P P P  y    * * * * * * x z +V  +P  +V  +P  +V  Q = - Re  P     z y x 2 n = 1 x x y y z z    

(D-4) For a simple case of a plane linear wave propagating in z direction, all spatial derivatives with respect to x and y are zero and Eq. (D-4) can be simplified as: V 1  P    Q = - Re P *  z + V *   z 2  z  z   We also know that for a plane linear wave:
P = Po e -( + jk ) z  V z = V zo e -( + jk ) z P = cV z P  = Po e -( + jk ) z × -( + jk ) = -( + jk ) P  z  V z  - (  + jk ) z  = V zo e × -( + jk ) = -( + jk )V z  z    

(D-5)

(D-6)

where  is the medium attenuation coefficient and k = 2 /  is the wave number. Substituting Eqs. (D-6) into Eq. (D-5) yields:

156

Appendix-D ________________________________________________________________________
V 1  p  1   Q = - Re P *  z + V *   = - Re P * × -( + jk )V + V * × -( + jk ) P z z z 2  z z  2  

{

} }

1 = - Re ( cV )* × -( + jk )V + V * × -( + jk ) × ( cV ) z z z z 2 1 1 = - Re - ( + jk ) c | V |2 -( + jk ) c | V |2 = - Re - 2( + jk ) c | V |2 z z z 2 2

{ {

}

{

}

=  × c V z

2

=  × 2 I = 2I

(D - 7)

where I is the temporal average intensity at a field point where Q is to be calculated. Eq. (D-7) is a well known formula for heat rate generation in a plane wave and serves as a verification point for Eq. (D-4) as derived above. In a more general (non-planar) field formation we know (Eq. (2.4-42), Chapter 2): Vz = j

 P
k
2

z

(D-8)

Similarly and due to symmetry: Vx = j and Vy = j

 P
k
2

x

(D-9)

 P
k
2

y

(D-10)

These relations are linear approximations and hence are only valid when signal amplitude remains low. Assuming linearity, these equations are valid for all harmonics. Assuming - j
2

k

2



= a , Eqs. (D-8) , (D-9) & (D-10) can be re-arranged as:

P k =-j Vz = a Vz  z P k =-j Vx = a Vx  x
2

(D-11)

(D-12)

P k =-j V y = a V y  y
2

(D-13)

Substituting Eqs. (D-11) , (D-12) , (D-13) into Eq. (D-4) for Q , yields:

157

Appendix-D ________________________________________________________________________

 V  V V 1    y   * * * * * * x z + V  aV + P  + V  aV + P  + V  aV   Q = - Re  P    x x y y z z 2 n = 1 x y z    

(D-14) Noting V *  V =| V |2 , V *  V =| V |2 and V *  V =| V |2 , Eq. (D-14) can be x x x y y y z z z simplified as:
 V  V 1    y V z  ) + a | V |2 + | V |2 + | V |2   Q = - Re   P * ( x + +  y z   x   2 n = 1  z y x   

(D-15) V Noting V V r r x + y + z = .V and | V x |2 + | V y |2 + | V z |2 =| V |2 , Eq. (D-15) will be x y z

simplified to:

r r 2  1     * Q = - Re    P (.V ) + a | V |    2  n = 1  

(D-16)

The general relation which relates the pressure and particle velocity is derived by combining the equation of state and the continuity equation (Cobbold 2007). In small signal approximation, this will result in:



r p + .v = 0 t
p = Re{jP  e jt } t

(D-17)

For a single frequency excitation: p(t ) = Re{P  e jt }  (D-18)

Substituting Eq. (D-18) into Eq. (D-17): r .V = - j  P Substituting Eq. (D-19) into Eq. (D-16) and noting a = - j

(D-19) k
2



:

158

Appendix-D ________________________________________________________________________  k2 r 2  1      Q = - Re   P * ( - j  P ) - j  V   2 n = 1       k2 r 2  1      = - Re   - j P 2 - j  V    2 n = 1     (D - 20)

Noting that  P 2 is a real number, j P 2 real component is zero and can be ignored in Eq. (D-20). Substituting k = k - j into Eq. (D-20), yields:  1  ( k - j ) 2 r 2      Q = - Re   - j  V    2 n = 1      Expanding ( k - j ) 2 and noting 1 /  = c o  o / k yields: c  r 2  1      Q = - Re   - j o o ( k 2 -  2 - 2 jk )  V     2 n = 1  k    Carrying only real parts: c  r  1    Q = -   - o o × 2k  | V |2  k 2 n = 1     r =  c o  o   | V | 2 =  c o  o n  | V x | 2 + | V y | 2 + | V z2 | (D-22) (D-21)

[

]

(D - 23)

n =1

n =1

Eq. (D-23) indicates that all components of particle velocity should be known to be able to calculate the Q . However the NLP-E code calculates only the normal component of particle velocity on each propagation plane. In Chapter 2, section 2.4.3, we derived a formula to calculate the pressure from the particle velocity on a propagation plane which is repeated here:
  2 -k   V z ( x, y )}× P( x , y ) =   2 D {  2 2 2 ( )  k k k - +  x y   
-1 2D

(D-24)

Now we can use the pressure obtained by Eq. (D-24) and substitute into Eq. (D-25) below:

159

Appendix-D ________________________________________________________________________ V x ( x, y , z ) = j

 
2 k x

P( x, y , z )

(D-25)

to calculate the x component of the particle velocity or into Eq. (D-26): V y ( x, y , z ) = j

 
2 k y

P( x, y , z )

(D-26)

to calculate the y component of the particle velocity. Once x, y , z components of the particle velocity are known, we can then go ahead and calculate the Q using Eq. (D-23). In other words knowing the normal particle velocity distribution on a propagation plane, would be sufficient to accurately calculate the Q on the same plane.

160

References ________________________________________________________________________

References
Airy, G B 1849 On a difficulty in the problem of sound Phil. Mag. 34 401-5 Akulichev, V A 1971 Pulsations of cavitation voids High Intensity Ultrasonic Fields 20359 Averkiou, M A and Hamilton, M F 1995 Measurements of harmonic generation in a focused finite-amplitude sound beam J. Acoust. Soc. Am. 98 6 3439-42 Bailey, M R, Khokhlova, V A, Sapozhnikov, O A, Kargl, S G and Crum, L A 2003 Physical mechanisms of the therapeutic effect of ultrasound (a review) Acoustical Physics 49 4 369-88 Baker, A C 1998 Nonlinear Effects in Ultrasound Propagation, Ultrasound in Medicine ed F A Duck, A C Baker and H C Starritt pp 23 Baker, A C 1992 Nonlinear pressure fields due to focused circular apertures J. Acoust. Soc. Am. 91 2 713-7 Baker, A C, Anastasiadis, K and Humphrey, V F 1988 The nonlinear pressure field of a plane circular piston: theory and experiment.J. Acoust. Soc. Am. 84 4 , Oct. 1988 1483-7 Baker, A C, Berg, A M, Sahin, A and Tjotta, J N 1995 The nonlinear pressure field of plane, rectangular apertures: Experimental and theoretical results J. Acoust. Soc. Am. 97 6 3510-7 Blackstock, D T 1966 Connection between the Fay and Fubini solutions for plane sound waves of finite amplitude J. Acoust. Soc. Am. 39 6 1019-26 Burgers, J M 1948 A mathematical model illustrating the theory of turbulence Adv. Appl. Mech. 1 171-99 Carstensen, E L, Law, W K, McKay, N D and Muir, T G 1980 Demonstration of nonlinear acoustical effects at biomedical frequencies and intensities Ultrasound in Medicine and Biology 6 4 359-68 Cathignol, D, Tavakkoli, J, Birer, A and Arefiev, A 1998 Comparison between the effects of cavitation induced by two different pressure-time shock waveform pulses IEEE Trans. Ultrason. Ferroelectr. Freq. Control 45 3 788-99

161

References ________________________________________________________________________ Christopher, P T and Parker, K J 1991 New approaches to nonlinear diffractive field propagation J. Acoust. Soc. Am. 90 1 488-99 Church, C C 1989 A theoretical study of cavitation generated by an extracorporeal shock wave lithotripter.J. Acoust. Soc. Am. 86 1 215-27 Cobbold, R S C 2007 Foundations of Biomedical Ultrasound : Oxford University Press) Coleman, D J, Lizzi, F L and Driller, J 1985a Therapeutic ultrasound in the treatment of glaucoma. I. Experimental model Ophthalmology 92 3 339-46 Coleman, D J, Lizzi, F L and Driller, J 1985b Therapeutic ultrasound in the treatment of glaucoma. II. Clinical applications Ophthalmology 92 3 347-53 Coleman, D J, Lizzi, F L and Torpey, J H 1985c Treatment of experimental lens capsular tears with intense focused ultrasound Br. J. Ophthalmol. 69 9 645-9 Coulouvrat, F 1993 Continuous field radiated by a geometrically focused transducer: Numerical investigation and comparison with an approximate model J. Acoust. Soc. Am. 94 3 I 1663-75 Curra, K P, Mourad, P D, Khokhlova, V A, Cleveland, R O and Crum, L A 2000 Numerical simulations of heating patterns and tissue temperature response due to high-intensity focused ultrasound IEEE Trans. Ultrason. Ferroelectr. Freq. Control 47 4 1077-89 Delon-Martin, C, Vogt, C, Chignier, E, Guers, C, Chapelon, J Y and Cathignol, D 1995 Venous thrombosis generation by means of high-intensity focused ultrasound Ultrasound in Medicine and Biology 21 1 113-9 Dewey, W C 2009 Arrhenius relationships from the molecule and cell to the clinic International Journal of Hyperthermia 25 1 3-20 Duck, F A 2002 Nonlinear acoustics in diagnostic ultrasound Ultrasound in Medicine and Biology 28 1 1-18 Eberhart, R C, Shitzer, A and Hernandez, E J 1980 Thermal dilution methods: estimation of tissue blood flow and metabolism.Ann. N. Y. Acad. Sci. 335 107-32 Euler, L 1759 De la propagation du son Mém.Acad.Sci.Berlin 15 185 Fay, R D 1931 Plane sound waves of finite amplitude J. Acoust. Soc. Am. 3 222-41 Filonenko, E A and Khokhlova, V A 2001 Effect of acoustic nonlinearity on heating of biological tissue by high-intensity focused ultrasound Acoustical Physics 47 4 46875

162

References ________________________________________________________________________ Foley, J L, Vaezy, S and Crum, L A 2007 Applications of high-intensity focused ultrasound in medicine: Spotlight on neurological applications Appl. Acoust. 68 3 245-59 Fourier, J 1822 Théorie analytique de la chaleur Théorie Analytique de la Chaleur Fry, W J, Mosberg, W H, Barnard, J W and Fry, F J 1954 Production of focal destructive lesions in the central nervous system with ultrasound J. Neurosurg. 11 5 471-8 Fubini, E 1935 Anomalie nella propagazione di onde acustiche di grande ampiezza Alta Frequenza 4 530-81 Hall, T L, Fowlkes, J B and Cain, C A 2007 A real-time measure of cavitation induced tissue disruption by ultrasound imaging backscatter reduction IEEE Trans. Ultrason. Ferroelectr. Freq. Control 54 3 569-75 Hamilton, M Fand Blackstock, D T ed 1998 Nonlinear Acoustics Hanajiri, K et al. 2006 Microbubble-induced increase in ablation of liver tumors by highintensity focused ultrasound Hepatology Research 36 4 308-14 Haran, M E and Cook, B D 1983 DISTORTION OF FINITE AMPLITUDE ULTRASOUND IN LOSSY MEDIA.J. Acoust. Soc. Am. 73 3 774-9 Holt, R G and Roy, R A 2001 Measurements of bubble-enhanced heating from focused, MHz-frequency ultrasound in a tissue-mimicking material Ultrasound in Medicine and Biology 27 10 1399-412 Hugoniot, P H 1887 Sur la propagation du mouvement dans les corps et plus spécialement dans les gaz parfaits J.École Polytech. 57 3-97 Kennedy, J E, Ter Haar, G R, Wu, F, Gleeson, F V, Roberts, I S D, Middleton, M R and Cranston, D 2004 Contrast-enhanced ultrasound assessment of tissue response to high-intensity focused ultrasound Ultrasound in Medicine and Biology 30 6 851-4 Khokhlov, R V and Soluyan, S I 1964 Waves of moderate amplitudes in absorbing media Acustica 14 5 241-7 Khokhlova, V A, Bailey, M R, Reed, J A, Cunitz, B W, Kaczkowski, P J and Crum, L A 2006 Effects of nonlinear propagation, cavitation, and boiling in lesion formation by high intensity focused ultrasound in a gel phantom J. Acoust. Soc. Am. 119 3 183448 Kieran, K, Hall, T L, Parsons, J E, Wolf Jr., J S, Fowlkes, J B, Cain, C A and Roberts, W W 2007 Refining Histotripsy: Defining the Parameter Space for the Creation of

163

References ________________________________________________________________________ Nonthermal Lesions With High Intensity, Pulsed Focused Ultrasound of the In Vitro Kidney J. Urol. 178 2 672-6 Kolios, M C, Sherar, M D and Hunt, J W 1999 Temperature dependant tissue properties and ultrasonic lesion formation Advances in Heat and Mass Transfer in Biotechnology 44 113-8 Kuznetsov, V P 1971 Equations of nonlinear acoustics Sov. Phys. Acoust. 16 467-70 Lagrange, J 1760 Nouvelles recherches sur la nature et la propagation du son Miscellanea Taurinensis 2 42 11-172 Lee, C P and Wang, T G 1993 Acoustic radiation pressure J. Acoust. Soc. Am. 94 2 I 1099-109 Leslie, T A and Kennedy, J E 2006 High-intensity focused ultrasound principles, current uses, and potential for the future Ultrasound Quarterly 22 4 263-72 Lienhard, J Hand Lienhard V, J H 2008 A Heat Transfer Textbook Lighthill, M J 1956 Viscosity effects in sound waves of finite amplitude Surveys in Mechanics 250-351 Liu, D - and Waag, R C 1997 Propagation and backpropagation for ultrasonic wavefront design IEEE Trans. Ultrason. Ferroelectr. Freq. Control 44 1 1-13 Lizzi, F L, Coleman, D J and Driller, J 1978 Experimental, ultrasonically induced lesions in the retina, choroid, and sclera Invest. Ophthalmol. Visual Sci. 17 4 350-60 Lynn, J G and Putnam, T J 1944 Histology of cerebral lesions produced by focused ultrasound Am. J. Pathol. 20 637-49 Lynn, J G, Zwemer, R L, Chick, A J and Miller, A E 1942 A new method for the generation and use of focused ultrasound in experimental biology J. Gen. Physiol. 26 2 179-93 Maier, M et al. 2001 Impaired tensile strength after shock-wave application in an animal model of tendon calcification Ultrasound in Medicine and Biology 27 5 665-71 Nachef, S, Cathignol, D, Tjotta, J N, Berg, A M and Tjotta, S 1995 Investigation of a high intensity sound beam from a plane transducer. Experimental and theoretical results J. Acoust. Soc. Am. 98 4 2303-23 Newton, I 1701 Scala graduum Caloris. Calorum Descriptiones & Signa Philosophical Trans. 824-9

164

References ________________________________________________________________________ Nyborg, W L 1981 HEAT GENERATION BY ULTRASOUND IN A RELAXING MEDIUM.J. Acoust. Soc. Am. 70 2 310-2 Ocheltree, K B and Frizzell, L A 1989 Sound field calculation for rectangular sources.IEEE Trans. Ultrason. Ferroelectr. Freq. Control 36 2 242-8 Parsons, J E, Cain, C A and Fowlkes, J B 2007 Spatial variability in acoustic backscatter as an indicator of tissue homogenate production in pulsed cavitational ultrasound therapy IEEE Trans. Ultrason. Ferroelectr. Freq. Control 54 3 576-90 Pennes, H H 1948 Analysis of tissue and arterial blood temperatures in the resting human forearm J. Appl. Physiol. 1 2 93-122 Poisson, S D 1808 Mémoire sur la théorie du son Journal de l'École Polytechnique, 14 Ième Cahier 7 319-92 Prince, J Land Links, J M 2006 Medical Imaging: Signals and Systems pp 23 Rankine, W J M 1870 On the thermodynamic theory of waves of finite longitudinal disturbance Trans.R.Soc.Lond. 160 277-88 Rayleigh, L 1910 Aerial plane waves of finite amplitude Proc.R.Soc.London 84 247-84 Rivens, I H, Rowland, I J, Denbow, M, Fisk, N M, Ter Haar, G R and Leach, M O 1999 Vascular occlusion using focused ultrasound surgery for use in fetal medicine European Journal of Ultrasound 9 1 89-97 Roberts, W W, Hall, T L, Ives, K, Wolf Jr., J S, Fowlkes, J B and Cain, C A 2006 Pulsed cavitational ultrasound: A noninvasive technology for controlled tissue ablation (histotripsy) in the rabbit kidney J.Urology (in Press) Rudenko, O V and Sapozhnikov, O A 1991 High-power acoustic beams: Self-action of discontinuous waves, focusing of pulses, and extracorporeal lithotripsy Moscow Univ.Phys.Bull. 46 5-18 Sapareto, S A and Dewey, W C 1984 Thermal dose determination in cancer therapy International Journal of Radiation Oncology Biology Physics 10 6 787-800 Sokolov, D L, Bailey, M R and Crum, L A 2001 Use of a dual-pulse lithotripter to generate a localized and intensified cavitation field J. Acoust. Soc. Am. 110 3 I 1685-95 Stokes, G G 1848 On a difficulty in the theory of sound Phil.Mag. 33 349-56

165

References ________________________________________________________________________ Tavakkoli, Jand Sanghvi, N T 2009 Ultrasound-Guided HIFU and Thermal Ablation, Therapeutic Ultrasound: Mechanisms to Applications ed V Frenkel (Hauppauge, NY (in press): Nova Science Publishers) Tavakkoli, J, Cathignol, D, Souchon, R and Sapozhnikov, O A 1998 Modeling of pulsed finite-amplitude focused sound beams in time domain J. Acoust. Soc. Am. 104 4 2061-72 Taylor, G I 1910 The conditions necessary for discontinuous motion in gases Proc.R.Soc.Lond.A 84 371-7 TenCate, J A 1993 An experimental investigation of the nonlinear pressure field produced by a plane circular piston J. Acoust. Soc. Am. 94 2 I 1084-9 ter Haar, G R 1993 Safety of Diagnostic Ultrasound, Abdominal and General Ultrasound ed D Cosgrove, H Meire and K Dewbury pp 127-32 ter Haar, G 2007 Therapeutic applications of ultrasound Prog. Biophys. Mol. Biol. 93 1-3 111-29 ter Haar, G R 1995 Ultrasound focal beam surgery Ultrasound in Medicine and Biology 21 9 1089-100 ter Haar, G and Coussios, C 2007 High intensity focused ultrasound: Physical principles and devices International Journal of Hyperthermia 23 2 89-104 Thiel, M 2001 Clin.Orthop.Relat.Res. 387 18 Vaezy, S, Martin, R, Kaczkowski, P, Keilman, G, Goldman, B, Yaziji, H, Carter, S, Caps, M and Crum, L 1999 Use of high-intensity focused ultrasound to control bleeding Journal of Vascular Surgery 29 3 533-42 Westervelt, P J 1963 Parametric acoustic array J. Acoust. Soc. Am. 35 4 535-7 Williams, R, Cherin, R, Lam, T Y, Tavakkoli, J, Zemp, R J and Foster, F S 2006 Nonlinear ultrasound propagation through layered liquid and tissue-equivalent media: computational and experimental results at high frequency Physics in Medicine and Biology 51 5809-24 Wissler, E H 1998 Pennes' 1948 paper revisited J. Appl. Physiol. 85 1 35-41 Wu, F, Wang, Z and Lu, P 2004 Activated anti-tumour immunity in cancer patients after high intensity focused ultrasound ablation Ultrasound Med. Biol. 30 1217-22

166

References ________________________________________________________________________ Xu, Z, Fowlkes, J B, Rothman, E D, Levin, A M and Cain, C A 2005 Controlled ultrasound tissue erosion: The role of dynamic interaction between insonation and microbubble activity J. Acoust. Soc. Am. 117 1 424-35 Xu, Z, Raghavan, M, Hall, T L, Chang, C -, Mycek, M -, Fowlkes, J B and Cain, C A 2007 High speed imaging of bubble clouds generated in pulsed ultrasound cavitational therapy - Histotripsy IEEE Trans. Ultrason. Ferroelectr. Freq. Control 54 10 2091-101 Zabolotskaya, E A and Khokhlov, R V 1969 QUASI-PLANE WAVES IN NONLINEAR ACOUSTICS OF CONFINED SOUND BEAMS Akusticheskij Zhurnal 15 1 40-7 Zemp, R J 2000 Modeling nonlinear ulltrasound in tissue MSc Institute of Biomaterials and Biomedical Engineering Zemp, R J, Tavakkoli, J and Cobbold, R S C 2003 Modeling of nonlinear ultrasound propagation in tissue from array transducers J. Acoust. Soc. Am. 113 1 139-52

167


